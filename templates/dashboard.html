<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="timestamp" content="2025-08-11-01-05">
    <meta name="version" content="bulk-delete-v2.1">
    <script>
        // ìºì‹œ ë¬´íš¨í™”ë¥¼ ìœ„í•œ ê°•ì œ ìƒˆë¡œê³ ì¹¨
        if (performance.navigation.type !== 1) {
            console.log("ê°•ì œ ìºì‹œ ìƒˆë¡œê³ ì¹¨ ì‹¤í–‰");
        }
    </script>
    <title>ë¸”ë¡œê·¸ ìë™í™” ëŒ€ì‹œë³´ë“œ v2.1 (ì„ íƒì‚­ì œ ê¸°ëŠ¥ ì¶”ê°€)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .navbar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.08);
            transition: transform 0.3s;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        .stat-card {
            padding: 20px;
            border-radius: 10px;
            color: white;
            position: relative;
            overflow: hidden;
        }
        .stat-card::after {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: rgba(255,255,255,0.1);
            transform: rotate(45deg);
        }
        .stat-card h3 {
            font-size: 2.5rem;
            font-weight: bold;
        }
        .stat-card p {
            margin: 0;
            opacity: 0.9;
        }
        .bg-gradient-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .bg-gradient-success {
            background: linear-gradient(135deg, #48c774 0%, #3ec46d 100%);
        }
        .bg-gradient-info {
            background: linear-gradient(135deg, #4fc3f7 0%, #29b6f6 100%);
        }
        .bg-gradient-warning {
            background: linear-gradient(135deg, #ffb74d 0%, #ffa726 100%);
        }
        .site-badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin: 2px;
        }
        .site-unpre { background-color: #e3f2fd; color: #1976d2; }
        .site-untab { background-color: #e8f5e9; color: #388e3c; }
        .site-skewese { background-color: #fff3e0; color: #f57c00; }
        .site-tistory { background-color: #fce4ec; color: #c2185b; }
        
        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 5px;
        }
        .status-online { background-color: #4caf50; }
        .status-offline { background-color: #f44336; }
        
        .log-entry {
            padding: 10px;
            border-left: 3px solid #667eea;
            margin-bottom: 10px;
            background: white;
            border-radius: 5px;
        }
        
        .schedule-item {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            background: white;
            border-left: 4px solid #667eea;
        }
        
        #loader {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: none;
        }
        
        .spinner-border {
            width: 3rem;
            height: 3rem;
        }
        
        .tistory-file {
            padding: 15px;
            margin-bottom: 10px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #ff6b6b;
        }
        
        .refresh-btn {
            animation: rotate 2s linear infinite;
        }
        
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        
        /* ìŠ¤í•€ ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€ */
        .spin {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        /* ì¤‘ì•™ ì§„í–‰ ê³¼ì • ì˜¤ë²„ë ˆì´ */
        .progress-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .progress-container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            text-align: center;
            min-width: 400px;
            max-width: 500px;
        }
        
        .progress-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 30px;
        }
        
        .progress-steps-list {
            list-style: none;
            padding: 0;
            margin: 20px 0;
        }
        
        .progress-step-item {
            display: flex;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #f0f0f0;
            transition: all 0.3s ease;
        }
        
        .progress-step-item:last-child {
            border-bottom: none;
        }
        
        .progress-step-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            transition: all 0.3s ease;
        }
        
        .progress-step-icon.waiting {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            color: #6c757d;
        }
        
        .progress-step-icon.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            animation: pulse 2s infinite;
        }
        
        .progress-step-icon.completed {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
        }
        
        .progress-step-text {
            flex: 1;
            text-align: left;
            font-size: 1rem;
        }
        
        .progress-step-text.active {
            color: #667eea;
            font-weight: 600;
        }
        
        .progress-step-text.completed {
            color: #28a745;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.7); }
            70% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(102, 126, 234, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(102, 126, 234, 0); }
        }
        
        /* ë¡œë”© ìŠ¤í”¼ë„ˆ ê°œì„  */
        .loading-spinner {
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        
        /* ì—…ë°ì´íŠ¸ ì¸ë””ì¼€ì´í„° ê°œì„  */
        .update-indicator {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 15px;
            padding: 15px 20px;
            margin: 10px 0;
            font-size: 1rem;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .update-indicator .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        
        /* ì„ íƒì‚­ì œ ê¸°ëŠ¥ ìŠ¤íƒ€ì¼ */
        .bulk-actions {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            display: none;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .bulk-actions.show {
            display: flex;
        }
        
        .bulk-info {
            display: flex;
            align-items: center;
        }
        
        .bulk-count {
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 10px;
            border-radius: 15px;
            margin-right: 15px;
            font-weight: bold;
        }
        
        .content-item {
            transition: all 0.3s ease;
        }
        
        .content-item.selected {
            background-color: #f8f9ff !important;
            border-color: #667eea !important;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
        }
        
        .content-checkbox {
            transform: scale(1.2);
            margin-right: 10px;
            display: inline-block !important;
            visibility: visible !important;
            opacity: 1 !important;
            width: 16px !important;
            height: 16px !important;
        }
        
        .select-all-checkbox {
            transform: scale(1.3);
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            width: 20px !important;
            height: 20px !important;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-dark">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1">
                <i class="bi bi-robot"></i> ë¸”ë¡œê·¸ ìë™í™” ëŒ€ì‹œë³´ë“œ
            </span>
            <div class="text-white">
                <a href="/trending" class="btn btn-outline-light btn-sm me-3">
                    <i class="bi bi-graph-up"></i> íŠ¸ë Œë”©
                </a>
                <span id="current-time"></span>
                <button class="btn btn-light btn-sm ms-3" onclick="refreshData()">
                    <i class="bi bi-arrow-clockwise"></i> ìƒˆë¡œê³ ì¹¨
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container-fluid mt-4">
        <!-- Stats Cards -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="stat-card bg-gradient-primary">
                    <h3 id="total-posts">0</h3>
                    <p>ì „ì²´ í¬ìŠ¤íŠ¸</p>
                    <i class="bi bi-file-text" style="position: absolute; right: 20px; top: 20px; font-size: 2rem; opacity: 0.3;"></i>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card bg-gradient-success">
                    <h3 id="today-posts">0</h3>
                    <p>ì˜¤ëŠ˜ ë°œí–‰</p>
                    <i class="bi bi-calendar-check" style="position: absolute; right: 20px; top: 20px; font-size: 2rem; opacity: 0.3;"></i>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card bg-gradient-info">
                    <h3 id="total-views">0</h3>
                    <p>ì´ ì¡°íšŒìˆ˜</p>
                    <i class="bi bi-eye" style="position: absolute; right: 20px; top: 20px; font-size: 2rem; opacity: 0.3;"></i>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card bg-gradient-warning">
                    <h3 id="total-revenue">â‚©0</h3>
                    <p>ì˜ˆìƒ ìˆ˜ìµ</p>
                    <i class="bi bi-currency-dollar" style="position: absolute; right: 20px; top: 20px; font-size: 2rem; opacity: 0.3;"></i>
                </div>
            </div>
        </div>

        <!-- System Status -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-light">
                        <h5 class="mb-0"><i class="bi bi-activity"></i> ì‹œìŠ¤í…œ ìƒíƒœ</h5>
                    </div>
                    <div class="card-body">
                        <div class="row" id="system-status">
                            <div class="col-md-3">
                                <span class="status-indicator status-offline"></span> unpre.co.kr
                            </div>
                            <div class="col-md-3">
                                <span class="status-indicator status-offline"></span> untab.co.kr
                            </div>
                            <div class="col-md-3">
                                <span class="status-indicator status-offline"></span> skewese.com
                            </div>
                            <div class="col-md-3">
                                <span class="status-indicator status-offline"></span> Database
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts -->
        <div class="row mb-4">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header bg-light">
                        <h5 class="mb-0"><i class="bi bi-graph-up"></i> ì¼ë³„ ë°œí–‰ í˜„í™©</h5>
                    </div>
                    <div class="card-body">
                        <canvas id="dailyChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header bg-light">
                        <h5 class="mb-0"><i class="bi bi-pie-chart"></i> ì‚¬ì´íŠ¸ë³„ í†µê³„</h5>
                    </div>
                    <div class="card-body">
                        <canvas id="siteChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Posts & Schedule -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-light">
                        <h5 class="mb-0"><i class="bi bi-clock-history"></i> ìµœê·¼ í¬ìŠ¤íŠ¸</h5>
                    </div>
                    <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                        <div id="recent-posts"></div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-light d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="bi bi-calendar-week"></i> ìë™ ë°œí–‰ ê³„íš (ìƒˆë²½ 3ì‹œ ì‹¤í–‰)</h5>
                        <div>
                            <button class="btn btn-sm btn-info" onclick="showScheduleOverview()">
                                <i class="bi bi-eye"></i> ì „ì²´ ê³„íš ë³´ê¸°
                            </button>
                            <button class="btn btn-sm btn-warning" onclick="triggerManualPublish()">
                                <i class="bi bi-lightning"></i> ìˆ˜ë™ ë°œí–‰
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="showSystemStatus()">
                                <i class="bi bi-exclamation-triangle"></i> ì‹œìŠ¤í…œ ìƒíƒœ
                            </button>
                        </div>
                    </div>
                    <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                        <div class="mb-3 text-center">
                            <div class="auto-schedule-info bg-light p-3 rounded">
                                <h6 class="mb-1"><i class="bi bi-clock"></i> ìë™ ë°œí–‰ ì‹œê°„</h6>
                                <div class="text-primary fw-bold">ë§¤ì¼ ìƒˆë²½ 3:00</div>
                                <small class="text-muted">3ê°œ ì‚¬ì´íŠ¸ ë™ì‹œ ë°œí–‰</small>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label small">ì£¼ì°¨ ì„ íƒ:</label>
                            <input type="date" id="schedule-week-picker" class="form-control form-control-sm" 
                                   onchange="loadWeeklySchedule()">
                        </div>
                        <div id="weekly-schedule-content"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Content Management -->
        <div class="row mb-4">
            <!-- WordPress Files -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-light d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center">
                            <input type="checkbox" class="form-check-input select-all-checkbox me-2" 
                                   id="select-all-wordpress" onchange="toggleSelectAll('wordpress')">
                            <h5 class="mb-0"><i class="bi bi-wordpress"></i> WordPress ì½˜í…ì¸ </h5>
                        </div>
                        <div class="dropdown">
                            <button class="btn btn-sm btn-success dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                <i class="bi bi-plus-circle"></i> ìƒˆ ì½˜í…ì¸ 
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#" onclick="showWordPressModal('unpre')">unpre ì½˜í…ì¸  ìƒì„±</a></li>
                                <li><a class="dropdown-item" href="#" onclick="showWordPressModal('untab')">untab ì½˜í…ì¸  ìƒì„±</a></li>
                                <li><a class="dropdown-item" href="#" onclick="showWordPressModal('skewese')">skewese ì½˜í…ì¸  ìƒì„±</a></li>
                            </ul>
                        </div>
                    </div>
                    
                    <!-- WordPress ì„ íƒì‚­ì œ ì•¡ì…˜ ë°” -->
                    <div id="wordpress-bulk-actions" class="bulk-actions">
                        <div class="bulk-info">
                            <div class="bulk-count" id="wordpress-selected-count">0ê°œ ì„ íƒë¨</div>
                            <span>ì„ íƒëœ WordPress ì½˜í…ì¸ ë¥¼ ê´€ë¦¬í•˜ì„¸ìš”</span>
                        </div>
                        <div>
                            <button class="btn btn-light btn-sm me-2" onclick="deselectAll('wordpress')">
                                <i class="bi bi-x"></i> ì„ íƒ í•´ì œ
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="bulkDelete('wordpress')">
                                <i class="bi bi-trash"></i> ì„ íƒ ì‚­ì œ
                            </button>
                        </div>
                    </div>
                    <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                        <div id="wordpress-files"></div>
                    </div>
                </div>
            </div>
            
            <!-- Tistory Files -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-light d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center">
                            <input type="checkbox" class="form-check-input select-all-checkbox me-2" 
                                   id="select-all-tistory" onchange="toggleSelectAll('tistory')">
                            <h5 class="mb-0"><i class="bi bi-file-earmark-text"></i> Tistory ì½˜í…ì¸ </h5>
                        </div>
                        <button class="btn btn-sm btn-primary" onclick="showTistoryModal()">
                            <i class="bi bi-plus-circle"></i> ìƒˆ ì½˜í…ì¸  ìƒì„±
                        </button>
                    </div>
                    
                    <!-- Tistory ì„ íƒì‚­ì œ ì•¡ì…˜ ë°” -->
                    <div id="tistory-bulk-actions" class="bulk-actions">
                        <div class="bulk-info">
                            <div class="bulk-count" id="tistory-selected-count">0ê°œ ì„ íƒë¨</div>
                            <span>ì„ íƒëœ Tistory ì½˜í…ì¸ ë¥¼ ê´€ë¦¬í•˜ì„¸ìš”</span>
                        </div>
                        <div>
                            <button class="btn btn-light btn-sm me-2" onclick="deselectAll('tistory')">
                                <i class="bi bi-x"></i> ì„ íƒ í•´ì œ
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="bulkDelete('tistory')">
                                <i class="bi bi-trash"></i> ì„ íƒ ì‚­ì œ
                            </button>
                        </div>
                    </div>
                    <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                        <div id="tistory-files"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Topic Pool Status -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-light">
                        <h5 class="mb-0"><i class="bi bi-collection"></i> ì£¼ì œ í’€ ìƒíƒœ</h5>
                    </div>
                    <div class="card-body">
                        <div id="topic-stats" class="row"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ì „ì²´ ìŠ¤ì¼€ì¤„ ë³´ê¸° ëª¨ë‹¬ -->
    <div class="modal fade" id="scheduleOverviewModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="bi bi-calendar3"></i> ìë™ ë°œí–‰ ê³„íš ì „ì²´ë³´ê¸°
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="alert alert-info">
                                <h6><i class="bi bi-info-circle"></i> ìë™ ë°œí–‰ ì‹œìŠ¤í…œ</h6>
                                <ul class="mb-0">
                                    <li>ë§¤ì¼ ìƒˆë²½ 3ì‹œ ìë™ ì‹¤í–‰</li>
                                    <li>3ê°œ ì‚¬ì´íŠ¸ (unpre, untab, skewese) ë™ì‹œ ë°œí–‰</li>
                                    <li>ê³ í’ˆì§ˆ Pexels ì´ë¯¸ì§€ ìë™ ìƒì„±</li>
                                    <li>ì£¼ì œë³„ ë‹¤ì–‘í•œ ì½˜í…ì¸  ìë™ ìƒì„±</li>
                                </ul>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="auto-schedule-next bg-light p-3 rounded">
                                <h6><i class="bi bi-clock-history"></i> ë‹¤ìŒ ì‹¤í–‰ ì˜ˆì •</h6>
                                <div id="next-run-time" class="fw-bold text-primary">ê³„ì‚° ì¤‘...</div>
                                <small class="text-muted">ìë™ìœ¼ë¡œ ì½˜í…ì¸ ê°€ ìƒì„±ë©ë‹ˆë‹¤</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="schedule-overview-controls mb-3 text-center">
                        <h5 class="text-primary">ğŸ“… ë‹¹ì›” ì „ì²´ ê³„íší‘œ</h5>
                        <p class="text-muted small">ì‹¤ì‹œê°„ íŠ¸ë Œë“œê°€ ë°˜ì˜ëœ 9ì›” ì „ì²´ ìŠ¤ì¼€ì¤„</p>
                    </div>
                    
                    <div id="schedule-overview-content">
                        <!-- ìŠ¤ì¼€ì¤„ ë‚´ìš©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loader -->
    <div id="loader">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <script>
        // ì°¨íŠ¸ ë³€ìˆ˜
        let dailyChart = null;
        let siteChart = null;

        // ì‹œê°„ ì—…ë°ì´íŠ¸
        function updateTime() {
            const now = new Date();
            document.getElementById('current-time').innerText = now.toLocaleString('ko-KR');
        }
        setInterval(updateTime, 1000);
        updateTime();

        // ë°ì´í„° ìƒˆë¡œê³ ì¹¨
        async function refreshData() {
            const loader = document.getElementById('loader');
            if (loader) {
                loader.style.display = 'block';
            }
            
            try {
                // í†µê³„ ë°ì´í„°
                const statsRes = await fetch('/api/stats');
                const stats = await statsRes.json();
                
                document.getElementById('total-posts').innerText = stats.total_posts;
                document.getElementById('today-posts').innerText = stats.today_posts;
                document.getElementById('total-views').innerText = (stats.revenue?.total_views || 0).toLocaleString();
                document.getElementById('total-revenue').innerText = 'â‚©' + ((stats.revenue?.total_revenue || 0) * 1400).toLocaleString();
                
                // ì£¼ì œ í’€ ìƒíƒœ ê°€ì ¸ì˜¤ê¸°
                const topicRes = await fetch('/api/topic_stats');
                const topicStats = await topicRes.json();
                updateTopicStats(topicStats);
                
                // ì‹œìŠ¤í…œ ìƒíƒœ
                const statusRes = await fetch('/api/system_status');
                const status = await statusRes.json();
                updateSystemStatus(status);
                
                // ìµœê·¼ í¬ìŠ¤íŠ¸
                const postsRes = await fetch('/api/recent_posts');
                const posts = await postsRes.json();
                updateRecentPosts(posts);
                
                // ë°œí–‰ ì¼ì •
                const scheduleRes = await fetch('/api/schedule');
                if (scheduleRes.ok) {
                    const schedule = await scheduleRes.json();
                    updateSchedule(schedule);
                } else {
                    console.warn('ë°œí–‰ ì¼ì • ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨');
                }
                
                // WordPress íŒŒì¼
                const wordpressRes = await fetch('/api/wordpress_files');
                const wordpressFiles = await wordpressRes.json();
                updateWordPressFiles(wordpressFiles);
                
                // Tistory íŒŒì¼
                const tistoryRes = await fetch('/api/tistory_files');
                const tistoryFiles = await tistoryRes.json();
                updateTistoryFiles(tistoryFiles);
                
                // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
                await updateCharts();
                
            } catch (error) {
                console.error('Error refreshing data:', error);
                // ì˜¤ë¥˜ ë°œìƒì‹œì—ë„ ë¡œë”ëŠ” ìˆ¨ê¸°ê¸°
            } finally {
                const loader = document.getElementById('loader');
                if (loader) {
                    loader.style.display = 'none';
                }
            }
        }

        // ì‹œìŠ¤í…œ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateSystemStatus(status) {
            let html = '';
            
            try {
                // API ì‘ë‹µ êµ¬ì¡° í™•ì¸
                if (!status || typeof status !== 'object') {
                    console.warn('Invalid status object:', status);
                    status = {
                        sites: { unpre: {status: 'offline'}, untab: {status: 'offline'}, skewese: {status: 'offline'} },
                        database: {status: 'offline'},
                        api: { openai: {status: 'offline'}, claude: {status: 'offline'} }
                    };
                }
                
                // ì‚¬ì´íŠ¸ ìƒíƒœ
                if (status.sites && typeof status.sites === 'object') {
                    for (const [site, info] of Object.entries(status.sites)) {
                        const isOnline = info && info.status === 'online';
                        const statusClass = isOnline ? 'status-online' : 'status-offline';
                        const statusText = isOnline ? 'ì •ìƒ' : 'ì˜¤í”„ë¼ì¸';
                        html += `
                            <div class="col-md-3 mb-2">
                                <span class="status-indicator ${statusClass}"></span>
                                ${site}.co.kr <small class="text-muted">(${statusText})</small>
                            </div>
                        `;
                    }
                }
                
                // ë°ì´í„°ë² ì´ìŠ¤
                const dbStatus = status.database && status.database.status;
                const dbClass = dbStatus === 'online' ? 'status-online' : 'status-offline';
                const dbText = dbStatus === 'online' ? 'ì •ìƒ' : 'ì˜¤í”„ë¼ì¸';
                html += `
                    <div class="col-md-3 mb-2">
                        <span class="status-indicator ${dbClass}"></span>
                        Database <small class="text-muted">(${dbText})</small>
                    </div>
                `;
                
                // API ìƒíƒœ
                if (status.api && typeof status.api === 'object') {
                    for (const [api, info] of Object.entries(status.api)) {
                        const isOnline = info && info.status === 'online';
                        const statusClass = isOnline ? 'status-online' : 'status-offline';
                        const statusText = isOnline ? 'ì •ìƒ' : 'ì˜¤í”„ë¼ì¸';
                        html += `
                            <div class="col-md-3 mb-2">
                                <span class="status-indicator ${statusClass}"></span>
                                ${api.toUpperCase()} API <small class="text-muted">(${statusText})</small>
                            </div>
                        `;
                    }
                }
                
            } catch (error) {
                console.error('Error updating system status:', error);
                html = `
                    <div class="col-12">
                        <span class="status-indicator status-offline"></span>
                        ì‹œìŠ¤í…œ ìƒíƒœ ë¡œë”© ì‹¤íŒ¨
                    </div>
                `;
            }
            
            const statusElement = document.getElementById('system-status');
            if (statusElement) {
                statusElement.innerHTML = html;
            }
        }

        // ìµœê·¼ í¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        function updateRecentPosts(posts) {
            let html = '';
            
            posts.forEach(post => {
                const siteClass = `site-${post.site}`;
                const date = new Date(post.published_date).toLocaleDateString('ko-KR');
                
                html += `
                    <div class="log-entry">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <span class="site-badge ${siteClass}">${post.site}</span>
                                <strong>${post.title}</strong>
                                <div class="text-muted small mt-1">
                                    <i class="bi bi-calendar"></i> ${date}
                                    <span class="ms-2"><i class="bi bi-folder"></i> ${post.category}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            const recentPostsElement = document.getElementById('recent-posts');
            if (recentPostsElement) {
                recentPostsElement.innerHTML = html || '<p class="text-muted">í¬ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            }
        }

        // ë°œí–‰ ì¼ì • ì—…ë°ì´íŠ¸
        function updateSchedule(schedule) {
            let html = '';
            
            if (!schedule || !Array.isArray(schedule)) {
                const scheduleElement = document.getElementById('weekly-schedule-content');
                if (scheduleElement) {
                    scheduleElement.innerHTML = '<p class="text-muted">ì¼ì • ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
                }
                return;
            }
            
            schedule.forEach(item => {
                if (!item || !item.site) return;
                
                const siteClass = `site-${item.site}`;
                const daysKor = (item.days && Array.isArray(item.days)) ? item.days.map(d => {
                    const dayMap = {mon: 'ì›”', tue: 'í™”', wed: 'ìˆ˜', thu: 'ëª©', fri: 'ê¸ˆ', sat: 'í† ', sun: 'ì¼'};
                    return dayMap[d] || d;
                }).join(', ') : 'ì¼ì • ì—†ìŒ';
                
                html += `
                    <div class="schedule-item">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <span class="site-badge ${siteClass}">${item.site}</span>
                                <strong class="ms-2">${item.time}</strong>
                            </div>
                            <span class="text-muted">${daysKor}</span>
                        </div>
                    </div>
                `;
            });
            
            const scheduleElement = document.getElementById('weekly-schedule-content');
            if (scheduleElement) {
                scheduleElement.innerHTML = html;
            }
        }

        // WordPress íŒŒì¼ ì—…ë°ì´íŠ¸
        function updateWordPressFiles(files) {
            let html = '';
            
            if (!files || files.length === 0) {
                html = '<p class="text-muted">ìƒì„±ëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            } else {
                files.forEach(file => {
                    const site = file.site || 'unknown';
                    const siteClass = `site-${site}`;
                    const title = file.title || 'ì œëª© ì—†ìŒ';
                    
                    // ì‹¤ì œ ìƒì„±ì¼ ì‚¬ìš©
                    let date;
                    if (file.created_at) {
                        const dateObj = new Date(file.created_at);
                        const year = dateObj.getFullYear();
                        const month = dateObj.getMonth() + 1;
                        const day = dateObj.getDate();
                        const hours = String(dateObj.getHours()).padStart(2, '0');
                        const minutes = String(dateObj.getMinutes()).padStart(2, '0');
                        date = `${year}. ${month}. ${day}. ${hours}:${minutes}`;
                    } else {
                        date = new Date().toLocaleString();
                    }
                    
                    const size = file.file_size ? `${Math.round(file.file_size / 1024)}KB` : '0KB';
                    const status = file.status || 'draft';
                    const actions = file.actions || ['view', 'edit', 'download', 'delete'];
                    
                    // ìƒíƒœë³„ ë°°ì§€ ìƒ‰ìƒ
                    const statusBadge = status === 'published' ? 
                        '<span class="badge bg-success">ë°œí–‰ë¨</span>' : 
                        '<span class="badge bg-warning">ì„ì‹œì €ì¥</span>';
                    
                    // ì•¡ì…˜ ë²„íŠ¼ë“¤ ìƒì„±
                    let actionButtons = '';
                    
                    if (actions.includes('view') && file.url) {
                        actionButtons += `<a href="${file.url}" target="_blank" class="btn btn-outline-info btn-sm me-1" title="ë³´ê¸°">
                            <i class="bi bi-eye"></i> ë³´ê¸°
                        </a>`;
                    }
                    
                    if (actions.includes('edit')) {
                        actionButtons += `<button class="btn btn-outline-primary btn-sm me-1" onclick="editContent('${file.id}', 'wordpress')" title="í¸ì§‘">
                            <i class="bi bi-pencil"></i> í¸ì§‘
                        </button>`;
                    }
                    
                    if (actions.includes('publish') && status === 'draft') {
                        actionButtons += `<button class="btn btn-outline-success btn-sm me-1" onclick="publishContent('${file.id}', '${site}', this)" title="ë°œí–‰">
                            <i class="bi bi-upload"></i> ë°œí–‰
                        </button>`;
                    }
                    
                    // WordPress ì‚¬ì´íŠ¸ ì‹¤ì œ ë°œí–‰ ë²„íŠ¼ (draftì´ ì•„ë‹Œ ê²½ìš°ì—ë„ í‘œì‹œ)
                    if (site !== 'tistory' && status !== 'processing') {
                        actionButtons += `<button class="btn btn-outline-warning btn-sm me-1" onclick="publishToWordPressSite('${file.id}', '${site}', this)" title="WordPress ì‚¬ì´íŠ¸ ë°œí–‰">
                            <i class="bi bi-globe"></i> ì‚¬ì´íŠ¸ ë°œí–‰
                        </button>`;
                    }
                    
                    if (actions.includes('download')) {
                        actionButtons += `<button class="btn btn-outline-secondary btn-sm me-1" onclick="downloadContent('${file.id}', 'wordpress')" title="ë‹¤ìš´ë¡œë“œ">
                            <i class="bi bi-download"></i> ë‹¤ìš´ë¡œë“œ
                        </button>`;
                        actionButtons += `<button class="btn btn-outline-info btn-sm me-1" onclick="previewContent('${file.id}')" title="ë¯¸ë¦¬ë³´ê¸°">
                            <i class="bi bi-eye"></i> ë¯¸ë¦¬ë³´ê¸°
                        </button>`;
                    }
                    
                    if (actions.includes('delete')) {
                        actionButtons += `<button class="btn btn-outline-danger btn-sm" onclick="deleteContent('${file.id}', 'wordpress')" title="ì‚­ì œ">
                            <i class="bi bi-trash"></i> ì‚­ì œ
                        </button>`;
                    }
                    
                    html += `
                        <div class="content-item mb-3 p-3 border rounded" data-file-id="${file.id}">
                            <div class="d-flex justify-content-between align-items-start">
                                <div class="d-flex align-items-start flex-grow-1">
                                    <input type="checkbox" class="form-check-input content-checkbox me-3" 
                                           onchange="toggleItemSelection('wordpress', '${file.id}')" data-file-id="${file.id}">
                                    <div class="flex-grow-1">
                                        <div class="d-flex align-items-center mb-2">
                                            <span class="site-badge ${siteClass}">${site.toUpperCase()}</span>
                                            ${statusBadge}
                                        </div>
                                        <h6 class="mb-1">${title}</h6>
                                        <div class="text-muted small">
                                            <i class="bi bi-calendar"></i> ${date}
                                            <span class="ms-3"><i class="bi bi-file-text"></i> ${size}</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="btn-group-sm">
                                    ${actionButtons}
                                </div>
                            </div>
                        </div>
                    `;
                });
            }
            
            const wordpressElement = document.getElementById('wordpress-files');
            if (wordpressElement) {
                wordpressElement.innerHTML = html || '<p class="text-muted">ìƒì„±ëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            }
        }

        // Tistory íŒŒì¼ ì—…ë°ì´íŠ¸
        function updateTistoryFiles(files) {
            let html = '';
            
            if (!files || files.length === 0) {
                html = '<p class="text-muted">ìƒì„±ëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            } else {
                files.forEach(file => {
                    const title = file.title || 'ì œëª© ì—†ìŒ';
                    
                    // ì‹¤ì œ ìƒì„±ì¼ ì‚¬ìš©
                    let date;
                    if (file.created_at) {
                        const dateObj = new Date(file.created_at);
                        const year = dateObj.getFullYear();
                        const month = dateObj.getMonth() + 1;
                        const day = dateObj.getDate();
                        const hours = String(dateObj.getHours()).padStart(2, '0');
                        const minutes = String(dateObj.getMinutes()).padStart(2, '0');
                        date = `${year}. ${month}. ${day}. ${hours}:${minutes}`;
                    } else {
                        date = new Date().toLocaleString();
                    }
                    
                    const size = file.file_size ? `${Math.round(file.file_size / 1024)}KB` : '0KB';
                    const status = file.status || 'draft';
                    const category = file.category || 'ì¹´í…Œê³ ë¦¬ ì—†ìŒ';
                    const tags = file.tags || [];
                    const actions = file.actions || ['view', 'download', 'delete'];
                    
                    // ìƒíƒœë³„ ë°°ì§€ ìƒ‰ìƒ
                    const statusBadge = status === 'published' ? 
                        '<span class="badge bg-success">ë°œí–‰ë¨</span>' : 
                        '<span class="badge bg-warning">ì„ì‹œì €ì¥</span>';
                    
                    // íƒœê·¸ í‘œì‹œ
                    const tagHtml = tags.slice(0, 3).map(tag => 
                        `<span class="badge bg-secondary me-1">${tag}</span>`
                    ).join('');
                    
                    // ì•¡ì…˜ ë²„íŠ¼ë“¤ ìƒì„±
                    let actionButtons = '';
                    
                    if (actions.includes('view') && file.url) {
                        actionButtons += `<a href="${file.url}" target="_blank" class="btn btn-outline-info btn-sm me-1" title="ë³´ê¸°">
                            <i class="bi bi-eye"></i> ë³´ê¸°
                        </a>`;
                    }
                    
                    if (actions.includes('edit')) {
                        actionButtons += `<button class="btn btn-outline-primary btn-sm me-1" onclick="editContent('${file.id}', 'tistory')" title="í¸ì§‘">
                            <i class="bi bi-pencil"></i> í¸ì§‘
                        </button>`;
                    }
                    
                    if (actions.includes('publish') && status === 'draft') {
                        actionButtons += `<button class="btn btn-outline-success btn-sm me-1" onclick="publishToTistory('${file.id}', this)" title="ë°œí–‰">
                            <i class="bi bi-upload"></i> ë°œí–‰
                        </button>`;
                    }
                    
                    if (actions.includes('download')) {
                        actionButtons += `<button class="btn btn-outline-secondary btn-sm me-1" onclick="downloadContent('${file.id}', 'tistory')" title="ë‹¤ìš´ë¡œë“œ">
                            <i class="bi bi-download"></i> ë‹¤ìš´ë¡œë“œ
                        </button>`;
                        actionButtons += `<button class="btn btn-outline-info btn-sm me-1" onclick="previewContent('${file.id}')" title="ë¯¸ë¦¬ë³´ê¸°">
                            <i class="bi bi-eye"></i> ë¯¸ë¦¬ë³´ê¸°
                        </button>`;
                    }
                    
                    if (actions.includes('delete')) {
                        actionButtons += `<button class="btn btn-outline-danger btn-sm" onclick="deleteContent('${file.id}', 'tistory')" title="ì‚­ì œ">
                            <i class="bi bi-trash"></i> ì‚­ì œ
                        </button>`;
                    }
                    
                    html += `
                        <div class="content-item mb-3 p-3 border rounded" data-file-id="${file.id}">
                            <div class="d-flex justify-content-between align-items-start">
                                <div class="d-flex align-items-start flex-grow-1">
                                    <input type="checkbox" class="form-check-input content-checkbox me-3" 
                                           onchange="toggleItemSelection('tistory', '${file.id}')" data-file-id="${file.id}">
                                    <div class="flex-grow-1">
                                        <div class="d-flex align-items-center mb-2">
                                            <span class="badge bg-info me-2">TISTORY</span>
                                            <span class="badge bg-secondary me-2">${category}</span>
                                            ${statusBadge}
                                        </div>
                                        <h6 class="mb-1">${title}</h6>
                                        ${tagHtml ? `<div class="mb-2">${tagHtml}</div>` : ''}
                                        <div class="text-muted small">
                                            <i class="bi bi-calendar"></i> ${date}
                                            <span class="ms-3"><i class="bi bi-file-text"></i> ${size}</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="btn-group-sm">
                                    ${actionButtons}
                                </div>
                            </div>
                        </div>
                    `;
                });
            }
            
            const tistoryElement = document.getElementById('tistory-files');
            if (tistoryElement) {
                tistoryElement.innerHTML = html;
            }
        }

        // ì£¼ì œ í’€ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateTopicStats(topicStats) {
            let html = '';
            
            if (!topicStats || typeof topicStats !== 'object') {
                html = '<div class="col-12"><p class="text-muted">ì£¼ì œ í’€ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p></div>';
            } else {
                for (const [site, stats] of Object.entries(topicStats)) {
                    if (!stats || typeof stats !== 'object') continue;
                    
                    const total = (stats.total || 0);
                    const used = (stats.used || 0);
                    const available = (stats.available || 0);
                    const percentage = total > 0 ? Math.round((used / total) * 100) : 0;
                    
                    html += `
                        <div class="col-md-4 mb-3">
                            <h6 class="text-uppercase">${site}</h6>
                            <div class="progress" style="height: 25px;">
                                <div class="progress-bar bg-success" style="width: ${percentage}%">
                                    ì‚¬ìš©: ${used}
                                </div>
                                <div class="progress-bar bg-info" style="width: ${100-percentage}%">
                                    ê°€ëŠ¥: ${available}
                                </div>
                            </div>
                            <small class="text-muted">ì´ ${total}ê°œ ì¤‘ ${used}ê°œ ì‚¬ìš©</small>
                        </div>
                    `;
                }
            }
            
            const topicStatsElement = document.getElementById('topic-stats');
            if (topicStatsElement) {
                topicStatsElement.innerHTML = html;
            }
        }

        // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        async function updateCharts() {
            try {
                // ì¼ë³„ ì°¨íŠ¸ ë°ì´í„° API í˜¸ì¶œ
                const dailyRes = await fetch('/api/chart/daily');
                if (!dailyRes.ok) {
                    throw new Error(`HTTP ${dailyRes.status}`);
                }
                const dailyData = await dailyRes.json();
            
                // ì¼ë³„ ì°¨íŠ¸ ë°ì´í„° ì¤€ë¹„
                const dailyLabels = dailyData.labels || [];
                const dailyValues = dailyData.data || [];
                
                const ctx1 = document.getElementById('dailyChart').getContext('2d');
                if (dailyChart) dailyChart.destroy();
                
                dailyChart = new Chart(ctx1, {
                    type: 'line',
                    data: {
                        labels: dailyLabels,
                        datasets: [{
                            label: 'ë°œí–‰ í¬ìŠ¤íŠ¸',
                            data: dailyValues,
                            borderColor: 'rgb(102, 126, 234)',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            tension: 0.3
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        }
                    }
                });
                
                // ì‚¬ì´íŠ¸ë³„ ì°¨íŠ¸ ë°ì´í„° API í˜¸ì¶œ
                const siteRes = await fetch('/api/chart/site');
                if (!siteRes.ok) {
                    throw new Error(`HTTP ${siteRes.status}`);
                }
                const siteData = await siteRes.json();
                
                // ì‚¬ì´íŠ¸ë³„ ì°¨íŠ¸ ë°ì´í„° ì¤€ë¹„
                const siteLabels = siteData.labels || [];
                const siteValues = siteData.data || [];
                
                const ctx2 = document.getElementById('siteChart').getContext('2d');
                if (siteChart) siteChart.destroy();
                
                siteChart = new Chart(ctx2, {
                    type: 'doughnut',
                    data: {
                        labels: siteLabels,
                        datasets: [{
                            data: siteValues,
                            backgroundColor: [
                                'rgba(102, 126, 234, 0.8)',
                                'rgba(72, 199, 116, 0.8)',
                                'rgba(255, 183, 77, 0.8)',
                                'rgba(255, 107, 107, 0.8)'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            } catch (error) {
                console.error('ì°¨íŠ¸ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
            }
        }

        // WordPress ì½˜í…ì¸  ìƒì„±
        async function generateWordPressContent() {
            // ëª¨ë‹¬ì—ì„œ ì…ë ¥ê°’ ê°€ì ¸ì˜¤ê¸°
            const site = selectedWpSite;
            const topic = document.getElementById('wpContentTopic').value.trim();
            const keywordsInput = document.getElementById('wpContentKeywords').value.trim();
            const contentLength = document.getElementById('wpContentLength').value;
            let category = document.getElementById('wpContentCategory').value;
            
            if (!topic) {
                showNotification('ì£¼ì œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            // ì§ì ‘ì…ë ¥ ì¹´í…Œê³ ë¦¬ ì²˜ë¦¬
            if (category === 'ì§ì ‘ì…ë ¥') {
                const customCategory = document.getElementById('wpCustomCategory').value.trim();
                if (!customCategory) {
                    showNotification('ì§ì ‘ì…ë ¥ ì¹´í…Œê³ ë¦¬ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                    return;
                }
                category = customCategory;
            }
            
            // í‚¤ì›Œë“œ ì²˜ë¦¬ (ì½¤ë§ˆë¡œ ë¶„ë¦¬)
            const keywords = keywordsInput ? 
                keywordsInput.split(',').map(k => k.trim()).filter(k => k.length > 0) : 
                getDefaultKeywordsByCategory(category);
            
            // ëª¨ë‹¬ ë‹«ê¸°
            const modal = bootstrap.Modal.getInstance(document.getElementById('wordpressModal'));
            modal.hide();
            
            // ì§„í–‰ ìƒí™© ìƒì„¸ í‘œì‹œ
            showNotification(`ğŸš€ ${site.toUpperCase()} ì½˜í…ì¸  ìƒì„± ì‹œì‘...`, 'info');
            showProgressSteps([
                'âœ¨ AIê°€ ì½˜í…ì¸ ë¥¼ ì‘ì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...',
                'ğŸ” SEO ìµœì í™” ì§„í–‰ ì¤‘...',
                'ğŸ“ íŒŒì¼ ì €ì¥ ì¤‘...',
                'ğŸ’¾ ë°ì´í„°ë² ì´ìŠ¤ ë“±ë¡ ì¤‘...'
            ]);
            
            try {
                console.log('Sending WordPress generation request...');
                const res = await fetch('/api/generate_wordpress', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        site: site, 
                        topic: topic,
                        keywords: keywords,
                        category: category,
                        content_length: contentLength
                    })
                });
                
                console.log('Response received, status:', res.status);
                
                if (!res.ok) {
                    throw new Error(`HTTP ${res.status}: ${res.statusText}`);
                }
                
                const result = await res.json();
                console.log('Generation result:', result);
                hideProgressSteps();
                
                if (result.success) {
                    showNotification(`âœ… ${site.toUpperCase()} ì½˜í…ì¸  ìƒì„± ì™„ë£Œ!`, 'success');
                    
                    // ì—…ë°ì´íŠ¸ ì¤‘ í‘œì‹œ (ìƒˆë¡œìš´ ë””ìì¸)
                    const wpFilesContainer = document.getElementById('wordpress-files');
                    wpFilesContainer.insertAdjacentHTML('afterbegin', 
                        `<div id="updating-indicator" class="update-indicator">
                            <div class="spinner"></div>
                            ëª©ë¡ì„ ì—…ë°ì´íŠ¸í•˜ê³  ìˆìŠµë‹ˆë‹¤...
                            <small style="display: block; margin-top: 5px; opacity: 0.8;">
                                ìƒˆë¡œ ìƒì„±ëœ ì½˜í…ì¸ ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ (ìµœëŒ€ 5ì´ˆ)
                            </small>
                        </div>`
                    );
                    
                    // ì¦‰ì‹œ ëª©ë¡ì— ìƒˆ ì½˜í…ì¸  í‘œì‹œ (ì„ì‹œ)
                    addTemporaryContent('wordpress', {
                        title: result.title || topic,
                        site: site,
                        category: category,
                        keywords: keywords.slice(0, 3),
                        created_at: new Date().toISOString(),
                        isNew: true
                    });
                    
                    // ì—¬ëŸ¬ ë²ˆ ì‹œë„í•´ì„œ ëª©ë¡ ê°±ì‹  ë³´ì¥
                    let retryCount = 0;
                    const maxRetries = 5;
                    
                    const updateList = async () => {
                        try {
                            const wordpressRes = await fetch('/api/wordpress_files');
                            const wordpressFiles = await wordpressRes.json();
                            
                            // ìƒˆë¡œ ìƒì„±ëœ ì½˜í…ì¸ ê°€ ëª©ë¡ì— ìˆëŠ”ì§€ í™•ì¸
                            const resultTitle = result.title || result.post?.title || topic;
                            const hasNewContent = wordpressFiles.some(f => 
                                (f.title && resultTitle && f.title.includes(resultTitle.substring(0, 10))) ||
                                (f.id && result.id && f.id === result.id) ||
                                new Date(f.created_at).getTime() > Date.now() - 60000 // 1ë¶„ ì´ë‚´ ìƒì„±
                            );
                            
                            updateWordPressFiles(wordpressFiles);
                            
                            if (hasNewContent || retryCount >= maxRetries) {
                                // ì—…ë°ì´íŠ¸ ì¤‘ ì¸ë””ì¼€ì´í„° ì œê±°
                                const indicator = document.getElementById('updating-indicator');
                                if (indicator) indicator.remove();
                                
                                showNotification(`ğŸ‰ ëª©ë¡ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤! ìƒˆ ì½˜í…ì¸ ë¥¼ í™•ì¸í•˜ì„¸ìš”.`, 'info');
                                // ì „ì²´ ë°ì´í„°ë„ ê°±ì‹ 
                                refreshData();
                            } else {
                                retryCount++;
                                setTimeout(updateList, 1000); // 1ì´ˆ í›„ ì¬ì‹œë„
                            }
                        } catch (error) {
                            if (retryCount < maxRetries) {
                                retryCount++;
                                setTimeout(updateList, 1000);
                            } else {
                                // ì—…ë°ì´íŠ¸ ì¤‘ ì¸ë””ì¼€ì´í„° ì œê±°
                                const indicator = document.getElementById('updating-indicator');
                                if (indicator) indicator.remove();
                                
                                showNotification('ëª©ë¡ ê°±ì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.', 'error');
                            }
                        }
                    };
                    
                    // ì¦‰ì‹œ ì²« ë²ˆì§¸ ê°±ì‹  ì‹œë„
                    setTimeout(updateList, 500);
                    
                    // í¼ ë¦¬ì…‹
                    document.getElementById('wordpressForm').reset();
                } else {
                    showNotification(`âŒ ìƒì„± ì‹¤íŒ¨: ${result.error}`, 'error');
                }
            } catch (error) {
                hideProgressSteps();
                showNotification(`âŒ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }
        
        // ì¹´í…Œê³ ë¦¬ë³„ ê¸°ë³¸ í‚¤ì›Œë“œ ë°˜í™˜
        function getDefaultKeywordsByCategory(category) {
            const defaultKeywords = {
                'í”„ë¡œê·¸ë˜ë°': ['í”„ë¡œê·¸ë˜ë°', 'ì½”ë”©', 'ê°œë°œ', 'ì•Œê³ ë¦¬ì¦˜', 'ìë£Œêµ¬ì¡°'],
                'ì›¹ê°œë°œ': ['ì›¹ê°œë°œ', 'HTML', 'CSS', 'JavaScript', 'í”„ë¡ íŠ¸ì—”ë“œ'],
                'ë°ì´í„°ì‚¬ì´ì–¸ìŠ¤': ['ë°ì´í„°ë¶„ì„', 'Python', 'ë¨¸ì‹ ëŸ¬ë‹', 'í†µê³„', 'ë¹…ë°ì´í„°'],
                'AI/ML': ['ì¸ê³µì§€ëŠ¥', 'ë¨¸ì‹ ëŸ¬ë‹', 'ë”¥ëŸ¬ë‹', 'AI', 'ì‹ ê²½ë§'],
                'DevOps': ['DevOps', 'ë°°í¬', 'CI/CD', 'Docker', 'Kubernetes'],
                'ëª¨ë°”ì¼ê°œë°œ': ['ëª¨ë°”ì¼', 'ì•±ê°œë°œ', 'React Native', 'Flutter', 'iOS'],
                'ê²Œì„ê°œë°œ': ['ê²Œì„ê°œë°œ', 'Unity', 'ê²Œì„ì—”ì§„', '3D', 'ê²Œì„ë””ìì¸'],
                'ê¸°íƒ€': ['ê°œë°œ', 'í”„ë¡œê·¸ë˜ë°', 'ê¸°ìˆ ', 'IT', 'ì†Œí”„íŠ¸ì›¨ì–´']
            };
            return defaultKeywords[category] || defaultKeywords['ê¸°íƒ€'];
        }

        // WordPress ë°œí–‰
        async function publishToWordPress(fileId, site) {
            if (!confirm(`${site}ì— ì´ ì½˜í…ì¸ ë¥¼ ë°œí–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            
            showNotification('ë°œí–‰ ì¤‘...', 'info');
            
            try {
                const res = await fetch('/api/publish_to_wordpress', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({file_id: fileId, site: site})
                });
                
                const result = await res.json();
                
                if (result.success) {
                    showNotification('ë°œí–‰ ì™„ë£Œ!', 'success');
                    refreshData();
                } else {
                    showNotification(`ë°œí–‰ ì‹¤íŒ¨: ${result.error}`, 'error');
                }
            } catch (error) {
                showNotification(`ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        // íŒŒì¼ ì‚­ì œ
        async function deleteFile(fileId) {
            if (!confirm('ì´ íŒŒì¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            console.log('Deleting file with ID:', fileId);
            showNotification('íŒŒì¼ ì‚­ì œ ì¤‘...', 'info');
            
            try {
                const response = await fetch('/api/delete_file', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({file_id: fileId})
                });
                
                console.log('Delete response status:', response.status);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('Delete failed with status:', response.status, 'Error:', errorText);
                    showNotification(`ì‚­ì œ ì‹¤íŒ¨ (${response.status}): ${errorText}`, 'error');
                    return;
                }
                
                const result = await response.json();
                console.log('Delete result:', result);
                
                if (result.success) {
                    showNotification('íŒŒì¼ì´ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    await refreshData(); // ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ëŒ€ê¸°
                } else {
                    showNotification(`ì‚­ì œ ì‹¤íŒ¨: ${result.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`, 'error');
                }
            } catch (error) {
                console.error('Delete error:', error);
                showNotification(`ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        // Tistory ì½˜í…ì¸  ìƒì„±
        async function generateTistoryContent() {
            // ëª¨ë‹¬ì—ì„œ ì…ë ¥ê°’ ê°€ì ¸ì˜¤ê¸°
            const topic = document.getElementById('contentTopic').value.trim();
            const keywordsInput = document.getElementById('contentKeywords').value.trim();
            const contentLength = document.getElementById('contentLength').value;
            const category = document.getElementById('contentCategory').value;
            
            if (!topic) {
                showNotification('ì£¼ì œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            // í‚¤ì›Œë“œ ì²˜ë¦¬ (ì½¤ë§ˆë¡œ ë¶„ë¦¬)
            const keywords = keywordsInput ? 
                keywordsInput.split(',').map(k => k.trim()).filter(k => k.length > 0) : 
                ['í† ìµ', 'ì˜ì–´í•™ìŠµ', 'ì–´í•™ì‹œí—˜', 'ê³ ë“ì ', 'í•™ìŠµë²•'];
            
            // ëª¨ë‹¬ ë‹«ê¸°
            const modal = bootstrap.Modal.getInstance(document.getElementById('tistoryModal'));
            modal.hide();
            
            // Tistory ì§„í–‰ ìƒí™© í‘œì‹œ
            showNotification('ğŸš€ Tistory ì½˜í…ì¸  ìƒì„± ì‹œì‘...', 'info');
            showProgressSteps([
                'âœ¨ AIê°€ Tistory ì½˜í…ì¸ ë¥¼ ì‘ì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...',
                'ğŸ¨ HTML í˜•ì‹ìœ¼ë¡œ ë³€í™˜ ì¤‘...',
                'ğŸ“ íŒŒì¼ ì €ì¥ ì¤‘...',
                'ğŸ’¾ ë°ì´í„°ë² ì´ìŠ¤ ë“±ë¡ ì¤‘...'
            ]);
            
            try {
                const res = await fetch('/api/generate_tistory', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        topic: topic,
                        keywords: keywords,
                        category: category,
                        content_length: contentLength
                    })
                });
                
                const result = await res.json();
                hideProgressSteps();
                
                if (result.success) {
                    showNotification(`âœ… Tistory ì½˜í…ì¸  ìƒì„± ì™„ë£Œ!`, 'success');
                    
                    // ì—…ë°ì´íŠ¸ ì¤‘ í‘œì‹œ
                    const tistoryFilesContainer = document.getElementById('tistory-files');
                    tistoryFilesContainer.insertAdjacentHTML('afterbegin', 
                        `<div id="tistory-updating-indicator" class="update-indicator">
                            <div class="spinner"></div>
                            ëª©ë¡ì„ ì—…ë°ì´íŠ¸í•˜ê³  ìˆìŠµë‹ˆë‹¤...
                            <small style="display: block; margin-top: 5px; opacity: 0.8;">
                                ìƒˆë¡œ ìƒì„±ëœ ì½˜í…ì¸ ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ (ìµœëŒ€ 5ì´ˆ)
                            </small>
                        </div>`
                    );
                    
                    // ì¦‰ì‹œ ëª©ë¡ì— ìƒˆ ì½˜í…ì¸  í‘œì‹œ (ì„ì‹œ)
                    addTemporaryContent('tistory', {
                        title: result.title || topic,
                        category: category,
                        keywords: keywords.slice(0, 3),
                        created_at: new Date().toISOString(),
                        isNew: true
                    });
                    
                    // ì—¬ëŸ¬ ë²ˆ ì‹œë„í•´ì„œ ëª©ë¡ ê°±ì‹  ë³´ì¥
                    let retryCount = 0;
                    const maxRetries = 5;
                    
                    const updateList = async () => {
                        try {
                            const tistoryRes = await fetch('/api/tistory_files');
                            const tistoryFiles = await tistoryRes.json();
                            
                            // ìƒˆë¡œ ìƒì„±ëœ ì½˜í…ì¸ ê°€ ëª©ë¡ì— ìˆëŠ”ì§€ í™•ì¸
                            const resultTitle = result.title || result.post?.title || topic;
                            const hasNewContent = tistoryFiles.some(f => 
                                (f.title && resultTitle && f.title.includes(resultTitle.substring(0, 10))) ||
                                (f.id && result.id && f.id === result.id) ||
                                new Date(f.created_at).getTime() > Date.now() - 60000 // 1ë¶„ ì´ë‚´ ìƒì„±
                            );
                            
                            updateTistoryFiles(tistoryFiles);
                            
                            if (hasNewContent || retryCount >= maxRetries) {
                                // ì—…ë°ì´íŠ¸ ì¤‘ ì¸ë””ì¼€ì´í„° ì œê±°
                                const indicator = document.getElementById('tistory-updating-indicator');
                                if (indicator) indicator.remove();
                                
                                showNotification(`ğŸ‰ ëª©ë¡ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤! ìƒˆ ì½˜í…ì¸ ë¥¼ í™•ì¸í•˜ì„¸ìš”.`, 'info');
                                // ì „ì²´ ë°ì´í„°ë„ ê°±ì‹ 
                                refreshData();
                            } else {
                                retryCount++;
                                setTimeout(updateList, 1000); // 1ì´ˆ í›„ ì¬ì‹œë„
                            }
                        } catch (error) {
                            if (retryCount < maxRetries) {
                                retryCount++;
                                setTimeout(updateList, 1000);
                            } else {
                                // ì—…ë°ì´íŠ¸ ì¤‘ ì¸ë””ì¼€ì´í„° ì œê±°
                                const indicator = document.getElementById('tistory-updating-indicator');
                                if (indicator) indicator.remove();
                                
                                showNotification('ëª©ë¡ ê°±ì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.', 'error');
                            }
                        }
                    };
                    
                    // ì¦‰ì‹œ ì²« ë²ˆì§¸ ê°±ì‹  ì‹œë„
                    setTimeout(updateList, 500);
                    
                    // í¼ ë¦¬ì…‹
                    document.getElementById('tistoryForm').reset();
                } else {
                    if (result.error && result.error.includes('API key')) {
                        showNotification(`âŒ Claude API í‚¤ ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤!\n\n1. https://console.anthropic.com ì—ì„œ API í‚¤ ë°œê¸‰\n2. .env íŒŒì¼ì˜ ANTHROPIC_API_KEY ì„¤ì •\n3. ì„œë²„ ì¬ì‹œì‘\n\nì˜¤ë¥˜: ${result.error}`, 'error');
                    } else {
                        showNotification(`âŒ ìƒì„± ì‹¤íŒ¨: ${result.error}`, 'error');
                    }
                }
            } catch (error) {
                hideProgressSteps();
                showNotification(`âŒ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        // ì•Œë¦¼ í‘œì‹œ
        function showNotification(message, type = 'info') {
            // ê¸°ì¡´ ì•Œë¦¼ ì œê±°
            const existing = document.querySelector('.notification-toast');
            if (existing) existing.remove();
            
            const colors = {
                success: '#28a745',
                error: '#dc3545', 
                info: '#17a2b8',
                warning: '#ffc107'
            };
            
            const toast = document.createElement('div');
            toast.className = 'notification-toast';
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${colors[type] || colors.info};
                color: white;
                padding: 15px 20px;
                border-radius: 5px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                z-index: 9999;
                max-width: 300px;
                font-weight: 500;
                animation: slideIn 0.3s ease-out;
            `;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            // 3ì´ˆ í›„ ìë™ ì œê±°
            setTimeout(() => {
                toast.style.animation = 'slideOut 0.3s ease-in forwards';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // ì¡°ìš©í•œ ìƒˆë¡œê³ ì¹¨ (ë¡œë”© ìŠ¤í”¼ë„ˆ ì—†ì´)
        async function refreshDataQuietly() {
            try {
                // í†µê³„ ë°ì´í„°
                const statsRes = await fetch('/api/stats');
                const stats = await statsRes.json();
                
                document.getElementById('total-posts').innerText = stats.total_posts;
                document.getElementById('today-posts').innerText = stats.today_posts;
                document.getElementById('total-views').innerText = (stats.revenue?.total_views || 0).toLocaleString();
                document.getElementById('total-revenue').innerText = 'â‚©' + ((stats.revenue?.total_revenue || 0) * 1400).toLocaleString();
                
                // WordPress íŒŒì¼ (ê°€ì¥ ì¤‘ìš”í•œ ë°ì´í„°ë§Œ)
                const wordpressRes = await fetch('/api/wordpress_files');
                const wordpressFiles = await wordpressRes.json();
                updateWordPressFiles(wordpressFiles);
                
                // Tistory íŒŒì¼
                const tistoryRes = await fetch('/api/tistory_files');
                const tistoryFiles = await tistoryRes.json();
                updateTistoryFiles(tistoryFiles);
                
            } catch (error) {
                console.log('ì¡°ìš©í•œ ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨:', error);
            }
        }

        // ì´ˆê¸° ë¡œë“œ
        refreshData();
        
        // 2ë¶„ë§ˆë‹¤ ìë™ ìƒˆë¡œê³ ì¹¨ (ì¡°ìš©í•œ ì—…ë°ì´íŠ¸)
        setInterval(() => {
            refreshDataQuietly();
        }, 120000);
    </script>

    <!-- ì‹œìŠ¤í…œ ìƒíƒœ ëª¨ë‹¬ -->
    <div class="modal fade" id="systemStatusModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="bi bi-gear"></i> ì‹œìŠ¤í…œ ìƒíƒœ & ì§„ë‹¨
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <!-- ì‹œìŠ¤í…œ ìƒíƒœ ê°œìš” -->
                        <div class="col-md-6 mb-4">
                            <div class="card">
                                <div class="card-header bg-primary text-white">
                                    <h6 class="mb-0"><i class="bi bi-server"></i> ì‹œìŠ¤í…œ ìƒíƒœ ê°œìš”</h6>
                                </div>
                                <div class="card-body">
                                    <div id="system-status-overview">
                                        <div class="d-flex justify-content-center">
                                            <div class="spinner-border text-primary" role="status">
                                                <span class="visually-hidden">ìƒíƒœ í™•ì¸ ì¤‘...</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- DB ì—°ê²° ìƒíƒœ -->
                        <div class="col-md-6 mb-4">
                            <div class="card">
                                <div class="card-header bg-info text-white">
                                    <h6 class="mb-0"><i class="bi bi-database"></i> ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°</h6>
                                </div>
                                <div class="card-body">
                                    <div id="db-status">
                                        <div class="d-flex justify-content-center">
                                            <div class="spinner-border text-info" role="status">
                                                <span class="visually-hidden">DB ìƒíƒœ í™•ì¸ ì¤‘...</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ìë™ë°œí–‰ ìŠ¤ì¼€ì¤„ëŸ¬ ìƒíƒœ -->
                        <div class="col-md-6 mb-4">
                            <div class="card">
                                <div class="card-header bg-warning text-dark">
                                    <h6 class="mb-0"><i class="bi bi-clock"></i> ìë™ë°œí–‰ ìŠ¤ì¼€ì¤„ëŸ¬</h6>
                                </div>
                                <div class="card-body">
                                    <div id="scheduler-status">
                                        <div class="d-flex justify-content-center">
                                            <div class="spinner-border text-warning" role="status">
                                                <span class="visually-hidden">ìŠ¤ì¼€ì¤„ëŸ¬ ìƒíƒœ í™•ì¸ ì¤‘...</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- í™˜ê²½ë³€ìˆ˜ ìƒíƒœ -->
                        <div class="col-md-6 mb-4">
                            <div class="card">
                                <div class="card-header bg-success text-white">
                                    <h6 class="mb-0"><i class="bi bi-key"></i> í™˜ê²½ë³€ìˆ˜ ìƒíƒœ</h6>
                                </div>
                                <div class="card-body">
                                    <div id="env-status">
                                        <div class="d-flex justify-content-center">
                                            <div class="spinner-border text-success" role="status">
                                                <span class="visually-hidden">í™˜ê²½ë³€ìˆ˜ í™•ì¸ ì¤‘...</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ì‹œìŠ¤í…œ ë¡œê·¸ -->
                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
                                    <h6 class="mb-0"><i class="bi bi-list-ul"></i> ìµœê·¼ ì‹œìŠ¤í…œ ë¡œê·¸</h6>
                                    <button class="btn btn-sm btn-outline-light" onclick="refreshSystemLogs()">
                                        <i class="bi bi-arrow-clockwise"></i> ìƒˆë¡œê³ ì¹¨
                                    </button>
                                </div>
                                <div class="card-body" style="max-height: 300px; overflow-y: auto;">
                                    <div id="system-logs">
                                        <div class="d-flex justify-content-center">
                                            <div class="spinner-border text-dark" role="status">
                                                <span class="visually-hidden">ë¡œê·¸ ë¡œë”© ì¤‘...</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- í•´ê²° ë°©ì•ˆ -->
                    <div class="row mt-4">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header bg-secondary text-white">
                                    <h6 class="mb-0"><i class="bi bi-lightbulb"></i> ë¬¸ì œ í•´ê²° ê°€ì´ë“œ</h6>
                                </div>
                                <div class="card-body">
                                    <div id="troubleshooting-guide">
                                        <div class="accordion" id="troubleshootingAccordion">
                                            <div class="accordion-item">
                                                <h2 class="accordion-header">
                                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#dbTrouble">
                                                        <i class="bi bi-database-exclamation text-danger me-2"></i>
                                                        DB ì—°ê²° ì‹¤íŒ¨ í•´ê²°ë°©ë²•
                                                    </button>
                                                </h2>
                                                <div id="dbTrouble" class="accordion-collapse collapse">
                                                    <div class="accordion-body">
                                                        <strong>ì£¼ìš” ì›ì¸:</strong>
                                                        <ul>
                                                            <li>í™˜ê²½ë³€ìˆ˜ ëˆ„ë½: PG_USER, PG_PASSWORD ë¯¸ì„¤ì •</li>
                                                            <li>ì˜ëª»ëœ DB ìê²©ì¦ëª…</li>
                                                            <li>ë„¤íŠ¸ì›Œí¬ ì—°ê²° ë¬¸ì œ</li>
                                                            <li>Supabase ì„œë¹„ìŠ¤ ì¤‘ë‹¨</li>
                                                        </ul>
                                                        <strong>í•´ê²°ë°©ë²•:</strong>
                                                        <ul>
                                                            <li>Koyeb Settings â†’ Environment variables í™•ì¸</li>
                                                            <li>Supabase Dashboardì—ì„œ DB ì—°ê²° ì •ë³´ ì¬í™•ì¸</li>
                                                            <li>ì•± ì¬ë°°í¬ í›„ ë‹¤ì‹œ ì‹œë„</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="accordion-item">
                                                <h2 class="accordion-header">
                                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#schedulerTrouble">
                                                        <i class="bi bi-clock-history text-warning me-2"></i>
                                                        ìë™ë°œí–‰ ì‹¤íŒ¨ í•´ê²°ë°©ë²•
                                                    </button>
                                                </h2>
                                                <div id="schedulerTrouble" class="accordion-collapse collapse">
                                                    <div class="accordion-body">
                                                        <strong>ì£¼ìš” ì›ì¸:</strong>
                                                        <ul>
                                                            <li>ìŠ¤ì¼€ì¤„ëŸ¬ ì„œë¹„ìŠ¤ ì¤‘ë‹¨</li>
                                                            <li>ì›”ë³„ ê³„íší‘œ ë°ì´í„° ì—†ìŒ</li>
                                                            <li>ì½˜í…ì¸  ìƒì„± API ì˜¤ë¥˜</li>
                                                            <li>íŒŒì¼ ì €ì¥ ê¶Œí•œ ë¬¸ì œ</li>
                                                        </ul>
                                                        <strong>í•´ê²°ë°©ë²•:</strong>
                                                        <ul>
                                                            <li>ìˆ˜ë™ ë°œí–‰ìœ¼ë¡œ ìš°ì„  í…ŒìŠ¤íŠ¸</li>
                                                            <li>ì›”ë³„ ê³„íší‘œ ë°ì´í„° í™•ì¸</li>
                                                            <li>ì‹œìŠ¤í…œ ë¡œê·¸ì—ì„œ ìƒì„¸ ì˜¤ë¥˜ í™•ì¸</li>
                                                            <li>ì•± ì¬ì‹œì‘ í›„ ë‹¤ì‹œ ì‹œë„</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="accordion-item">
                                                <h2 class="accordion-header">
                                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#apiTrouble">
                                                        <i class="bi bi-cloud-exclamation text-info me-2"></i>
                                                        API ì—°ê²° ì˜¤ë¥˜ í•´ê²°ë°©ë²•
                                                    </button>
                                                </h2>
                                                <div id="apiTrouble" class="accordion-collapse collapse">
                                                    <div class="accordion-body">
                                                        <strong>ì£¼ìš” ì›ì¸:</strong>
                                                        <ul>
                                                            <li>AI API í‚¤ ë§Œë£Œ/í•œë„ ì´ˆê³¼</li>
                                                            <li>WordPress API ì¸ì¦ ì‹¤íŒ¨</li>
                                                            <li>ì´ë¯¸ì§€ API ì—°ê²° ì˜¤ë¥˜</li>
                                                            <li>ë„¤íŠ¸ì›Œí¬ íƒ€ì„ì•„ì›ƒ</li>
                                                        </ul>
                                                        <strong>í•´ê²°ë°©ë²•:</strong>
                                                        <ul>
                                                            <li>API í‚¤ ìœ íš¨ì„± ë° ì‚¬ìš©ëŸ‰ í™•ì¸</li>
                                                            <li>WordPress App Password ì¬ìƒì„±</li>
                                                            <li>ë„¤íŠ¸ì›Œí¬ ì—°ê²° ìƒíƒœ í™•ì¸</li>
                                                            <li>API ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="refreshSystemStatus()">
                        <i class="bi bi-arrow-clockwise"></i> ì „ì²´ ìƒˆë¡œê³ ì¹¨
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Tistory ì½˜í…ì¸  ìƒì„± ëª¨ë‹¬ -->
    <div class="modal fade" id="tistoryModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-file-earmark-text"></i> Tistory ì½˜í…ì¸  ìƒì„±</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="tistoryForm">
                        <div class="mb-3">
                            <label for="contentTopic" class="form-label">ì½˜í…ì¸  ì£¼ì œ *</label>
                            <input type="text" class="form-control" id="contentTopic" 
                                   placeholder="ì˜ˆ: í† ìµ 900ì  ë‹¬ì„± ì „ëµ" required>
                            <div class="form-text">ìƒì„±í•  ì½˜í…ì¸ ì˜ ì£¼ìš” ì£¼ì œë¥¼ ì…ë ¥í•˜ì„¸ìš”</div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="contentKeywords" class="form-label">í•„ìˆ˜ í‚¤ì›Œë“œ</label>
                            <input type="text" class="form-control" id="contentKeywords" 
                                   placeholder="ì˜ˆ: í† ìµ, ì˜ì–´í•™ìŠµ, ê³ ë“ì , ì‹œí—˜ì¤€ë¹„">
                            <div class="form-text">ì½¤ë§ˆ(,)ë¡œ êµ¬ë¶„í•˜ì—¬ ì…ë ¥ (ìµœëŒ€ 10ê°œ)</div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="contentLength" class="form-label">ì½˜í…ì¸  ê¸¸ì´</label>
                            <select class="form-select" id="contentLength">
                                <option value="short">ì§§ìŒ (1,500-2,000ì)</option>
                                <option value="medium" selected>ë³´í†µ (2,500-3,500ì)</option>
                                <option value="long">ê¸¸ê²Œ (4,000-5,500ì)</option>
                                <option value="very_long">ë§¤ìš° ê¸¸ê²Œ (6,000-8,000ì)</option>
                            </select>
                            <div class="form-text">ì½˜í…ì¸ ì˜ ê¸¸ì´ë¥¼ ì„ íƒí•˜ì„¸ìš”</div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="contentCategory" class="form-label">ì¹´í…Œê³ ë¦¬</label>
                            <select class="form-select" id="contentCategory">
                                <option value="ì–¸ì–´í•™ìŠµ">ì–¸ì–´í•™ìŠµ</option>
                                <option value="ìê²©ì¦">ìê²©ì¦</option>
                                <option value="ì·¨ì—…">ì·¨ì—…</option>
                                <option value="ì—¬í–‰">ì—¬í–‰</option>
                                <option value="ë¼ì´í”„ìŠ¤íƒ€ì¼">ë¼ì´í”„ìŠ¤íƒ€ì¼</option>
                                <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
                    <button type="button" class="btn btn-primary" onclick="generateTistoryContent()">
                        <i class="bi bi-magic"></i> ì½˜í…ì¸  ìƒì„±
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- WordPress ì½˜í…ì¸  ìƒì„± ëª¨ë‹¬ -->
    <div class="modal fade" id="wordpressModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-wordpress"></i> <span id="wpSiteName">WordPress</span> ì½˜í…ì¸  ìƒì„±</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="wordpressForm">
                        <div class="mb-3">
                            <label for="wpSite" class="form-label">ì‚¬ì´íŠ¸ ì„ íƒ</label>
                            <input type="text" class="form-control" id="wpSite" readonly>
                        </div>
                        
                        <div class="mb-3">
                            <label for="wpContentTopic" class="form-label">ì½˜í…ì¸  ì£¼ì œ *</label>
                            <input type="text" class="form-control" id="wpContentTopic" 
                                   placeholder="ì˜ˆ: React í”„ë¡œê·¸ë˜ë° ì™„ì „ì •ë³µ" required>
                            <div class="form-text">ìƒì„±í•  ì½˜í…ì¸ ì˜ ì£¼ìš” ì£¼ì œë¥¼ ì…ë ¥í•˜ì„¸ìš”</div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="wpContentKeywords" class="form-label">í•„ìˆ˜ í‚¤ì›Œë“œ</label>
                            <input type="text" class="form-control" id="wpContentKeywords" 
                                   placeholder="ì˜ˆ: React, JavaScript, í”„ë¡ íŠ¸ì—”ë“œ, ì›¹ê°œë°œ">
                            <div class="form-text">ì½¤ë§ˆ(,)ë¡œ êµ¬ë¶„í•˜ì—¬ ì…ë ¥ (ìµœëŒ€ 10ê°œ)</div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="wpContentLength" class="form-label">ì½˜í…ì¸  ê¸¸ì´</label>
                            <select class="form-select" id="wpContentLength">
                                <option value="short">ì§§ìŒ (1,500-2,000ì)</option>
                                <option value="medium" selected>ë³´í†µ (2,500-3,500ì)</option>
                                <option value="long">ê¸¸ê²Œ (4,000-5,500ì)</option>
                                <option value="very_long">ë§¤ìš° ê¸¸ê²Œ (6,000-8,000ì)</option>
                            </select>
                            <div class="form-text">ì½˜í…ì¸ ì˜ ê¸¸ì´ë¥¼ ì„ íƒí•˜ì„¸ìš”</div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="wpContentCategory" class="form-label">ì¹´í…Œê³ ë¦¬</label>
                            <select class="form-select" id="wpContentCategory" onchange="toggleCustomCategory()">
                                <!-- ì‚¬ì´íŠ¸ë³„ ì¹´í…Œê³ ë¦¬ê°€ JavaScriptë¡œ ë™ì  ìƒì„±ë©ë‹ˆë‹¤ -->
                            </select>
                        </div>
                        
                        <div class="mb-3" id="customCategoryDiv" style="display: none;">
                            <label for="wpCustomCategory" class="form-label">ì§ì ‘ ì…ë ¥ ì¹´í…Œê³ ë¦¬</label>
                            <input type="text" class="form-control" id="wpCustomCategory" 
                                   placeholder="ì¹´í…Œê³ ë¦¬ë¥¼ ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”">
                            <div class="form-text">ì§ì ‘ ì¹´í…Œê³ ë¦¬ë¥¼ ì…ë ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
                    <button type="button" class="btn btn-success" onclick="generateWordPressContent()">
                        <i class="bi bi-magic"></i> ì½˜í…ì¸  ìƒì„±
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // WordPress ëª¨ë‹¬ í‘œì‹œ
        let selectedWpSite = '';
        
        // ì‚¬ì´íŠ¸ë³„ ì¹´í…Œê³ ë¦¬ ì •ì˜
        const siteCategories = {
            'unpre': [
                'ê°œë°œ', 'IT', 'í”„ë¡œê·¸ë˜ë°', 'JavaScript', 'Python', 'React', 'Node.js',
                'ë°ì´í„°ë² ì´ìŠ¤', 'ì›¹ê°œë°œ', 'DevOps', 'AI/ML', 'ì •ë³´ì²˜ë¦¬ê¸°ì‚¬', 'ì–¸ì–´í•™ìŠµ',
                'í† ìµ', 'JLPT', 'ì˜ì–´íšŒí™”', 'ì§ì ‘ì…ë ¥'
            ],
            'untab': [
                'ë¶€ë™ì‚°', 'ê²½ë§¤', 'ê³µë§¤', 'ì •ì±…/ì œë„', 'íˆ¬ìì „ëµ', 'ì‹œì¥ë¶„ì„',
                'ê¶Œë¦¬ë¶„ì„', 'ì„ëŒ€ìˆ˜ìµ', 'ì¬ê°œë°œ', 'ì¬ê±´ì¶•', 'ë²•ë¥ ì •ë³´', 'ì„¸ê¸ˆ',
                'ëŒ€ì¶œ', 'íˆ¬ìë¦¬ìŠ¤í¬', 'ì§ì ‘ì…ë ¥'
            ],
            'skewese': [
                'ì„¸ê³„ì‚¬', 'í•œêµ­ì‚¬', 'ê³ ëŒ€ì‚¬', 'ê·¼í˜„ëŒ€ì‚¬', 'ì—­ì‚¬ì¸ë¬¼', 'ë¬¸í™”ì‚¬',
                'ì „ìŸì‚¬', 'ì •ì¹˜ì‚¬', 'ì‚¬íšŒì‚¬', 'ë¬¸í™”ì¬', 'ë°•ë¬¼ê´€', 'ì—­ì‚¬ì—¬í–‰',
                'ì—­ì‚¬ë“œë¼ë§ˆ', 'ë¬¸í™”ìœ ì‚°', 'ì§ì ‘ì…ë ¥'
            ]
        };
        
        function showWordPressModal(site) {
            selectedWpSite = site;
            document.getElementById('wpSite').value = site;
            document.getElementById('wpSiteName').textContent = site.toUpperCase();
            
            // ì‚¬ì´íŠ¸ë³„ ì¹´í…Œê³ ë¦¬ ì—…ë°ì´íŠ¸
            updateCategoriesForSite(site);
            
            // ì»¤ìŠ¤í…€ ì¹´í…Œê³ ë¦¬ ì…ë ¥ì°½ ìˆ¨ê¸°ê¸°
            document.getElementById('customCategoryDiv').style.display = 'none';
            document.getElementById('wpCustomCategory').value = '';
            
            const modal = new bootstrap.Modal(document.getElementById('wordpressModal'));
            modal.show();
        }
        
        function updateCategoriesForSite(site) {
            const categorySelect = document.getElementById('wpContentCategory');
            const categories = siteCategories[site] || ['ê¸°íƒ€', 'ì§ì ‘ì…ë ¥'];
            
            // ê¸°ì¡´ ì˜µì…˜ ì œê±°
            categorySelect.innerHTML = '';
            
            // ì‚¬ì´íŠ¸ë³„ ì¹´í…Œê³ ë¦¬ ì¶”ê°€
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categorySelect.appendChild(option);
            });
        }
        
        function toggleCustomCategory() {
            const categorySelect = document.getElementById('wpContentCategory');
            const customDiv = document.getElementById('customCategoryDiv');
            
            if (categorySelect.value === 'ì§ì ‘ì…ë ¥') {
                customDiv.style.display = 'block';
                document.getElementById('wpCustomCategory').focus();
            } else {
                customDiv.style.display = 'none';
                document.getElementById('wpCustomCategory').value = '';
            }
        }
        
        // Tistory ëª¨ë‹¬ í‘œì‹œ
        function showTistoryModal() {
            const modal = new bootstrap.Modal(document.getElementById('tistoryModal'));
            modal.show();
        }
        
        // ì§„í–‰ ë‹¨ê³„ í‘œì‹œ (ì¤‘ì•™ ì˜¤ë²„ë ˆì´)
        function showProgressSteps(steps) {
            console.log('ğŸ¬ ì¤‘ì•™ ì§„í–‰ ì˜¤ë²„ë ˆì´ ì‹œì‘:', steps);
            
            // ê¸°ì¡´ ì˜¤ë²„ë ˆì´ ì œê±°
            const existingOverlay = document.getElementById('progress-overlay');
            if (existingOverlay) {
                existingOverlay.remove();
            }
            
            // ì¤‘ì•™ ì˜¤ë²„ë ˆì´ ìƒì„±
            const overlay = document.createElement('div');
            overlay.className = 'progress-overlay';
            overlay.id = 'progress-overlay';
            
            const container = document.createElement('div');
            container.className = 'progress-container';
            
            container.innerHTML = `
                <div class="progress-title">
                    <i class="bi bi-magic" style="color: #667eea; margin-right: 10px;"></i>
                    ì½˜í…ì¸  ìƒì„± ì¤‘
                </div>
                <ul class="progress-steps-list" id="progress-steps-list">
                    ${steps.map((step, index) => `
                        <li class="progress-step-item" id="step-${index}">
                            <div class="progress-step-icon waiting" id="icon-${index}">
                                <i class="bi bi-circle"></i>
                            </div>
                            <div class="progress-step-text" id="text-${index}">
                                ${step}
                            </div>
                        </li>
                    `).join('')}
                </ul>
                <div style="margin-top: 20px; color: #6c757d;">
                    <small>ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...</small>
                </div>
            `;
            
            overlay.appendChild(container);
            document.body.appendChild(overlay);
            
            // ë‹¨ê³„ë³„ ì§„í–‰ ì• ë‹ˆë©”ì´ì…˜
            let currentStep = 0;
            const progressInterval = setInterval(() => {
                if (currentStep < steps.length) {
                    // í˜„ì¬ ë‹¨ê³„ í™œì„±í™”
                    const icon = document.getElementById(`icon-${currentStep}`);
                    const text = document.getElementById(`text-${currentStep}`);
                    
                    if (icon && text) {
                        icon.className = 'progress-step-icon active';
                        icon.innerHTML = '<div class="loading-spinner" style="width: 20px; height: 20px; border-width: 2px;"></div>';
                        text.className = 'progress-step-text active';
                    }
                    
                    // ì´ì „ ë‹¨ê³„ë“¤ ì™„ë£Œ í‘œì‹œ
                    for (let i = 0; i < currentStep; i++) {
                        const prevIcon = document.getElementById(`icon-${i}`);
                        const prevText = document.getElementById(`text-${i}`);
                        if (prevIcon && prevText) {
                            prevIcon.className = 'progress-step-icon completed';
                            prevIcon.innerHTML = '<i class="bi bi-check-lg"></i>';
                            prevText.className = 'progress-step-text completed';
                        }
                    }
                    
                    currentStep++;
                } else {
                    // ëª¨ë“  ë‹¨ê³„ ì™„ë£Œ
                    for (let i = 0; i < steps.length; i++) {
                        const icon = document.getElementById(`icon-${i}`);
                        const text = document.getElementById(`text-${i}`);
                        if (icon && text) {
                            icon.className = 'progress-step-icon completed';
                            icon.innerHTML = '<i class="bi bi-check-lg"></i>';
                            text.className = 'progress-step-text completed';
                        }
                    }
                    clearInterval(progressInterval);
                }
            }, 1200); // 1.2ì´ˆë§ˆë‹¤ ë‹¤ìŒ ë‹¨ê³„
            
            window.currentProgressInterval = progressInterval;
        }
        
        function hideProgressSteps() {
            const overlay = document.getElementById('progress-overlay');
            if (overlay) {
                overlay.remove();
            }
            
            if (window.currentProgressInterval) {
                clearInterval(window.currentProgressInterval);
                window.currentProgressInterval = null;
            }
        }
        
        // íŒŒì¼ ì‚­ì œ ê¸°ëŠ¥
        async function deleteFile(fileId, type) {
            if (!confirm('ì´ íŒŒì¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) return;
            
            showNotification('íŒŒì¼ ì‚­ì œ ì¤‘...', 'info');
            
            try {
                const res = await fetch('/api/delete_file', {
                    method: 'DELETE',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({file_id: fileId, type: type})
                });
                
                const result = await res.json();
                
                if (result.success) {
                    showNotification('âœ… íŒŒì¼ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
                    refreshData();
                } else {
                    showNotification(`âŒ ì‚­ì œ ì‹¤íŒ¨: ${result.error}`, 'error');
                }
            } catch (error) {
                showNotification(`âŒ ì‚­ì œ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }
        
        // ì„ì‹œë¡œ ìƒˆ ì½˜í…ì¸ ë¥¼ ëª©ë¡ì— ì¶”ê°€ (ì¦‰ì‹œ í”¼ë“œë°±ìš©)
        function addTemporaryContent(type, contentData) {
            console.log('ğŸ“ ì„ì‹œ ì½˜í…ì¸  ì¶”ê°€:', type, contentData);
            
            const containerId = type === 'wordpress' ? 'wordpress-files' : 'tistory-files';
            const container = document.getElementById(containerId);
            
            const dateObj = new Date(contentData.created_at);
            const year = dateObj.getFullYear();
            const month = dateObj.getMonth() + 1;
            const day = dateObj.getDate();
            const hours = String(dateObj.getHours()).padStart(2, '0');
            const minutes = String(dateObj.getMinutes()).padStart(2, '0');
            const date = `${year}. ${month}. ${day}. ${hours}:${minutes}`;
            const siteClass = `site-${contentData.site}`;
            
            let tempHtml = '';
            if (type === 'wordpress') {
                const keywordTags = contentData.keywords.map(keyword => 
                    `<span class="badge bg-primary me-1">${keyword}</span>`
                ).join('');
                
                tempHtml = `
                    <div class="wordpress-file mb-3 p-2 border rounded bg-light" id="temp-content">
                        <div class="d-flex justify-content-between align-items-start">
                            <div class="flex-grow-1">
                                <div class="d-flex align-items-center mb-1">
                                    <span class="site-badge ${siteClass}">${contentData.site.toUpperCase()}</span>
                                    <span class="badge bg-secondary ms-2">${contentData.category}</span>
                                    <span class="badge bg-success ms-2">ìƒˆë¡œ ìƒì„±ë¨</span>
                                </div>
                                <strong>ğŸ“ ${contentData.title}</strong>
                                <div class="mt-2">${keywordTags}</div>
                                <div class="text-muted small mt-1">
                                    <i class="bi bi-calendar"></i> ${date} (ë°©ê¸ˆ ì „)
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                const keywordTags = contentData.keywords.map(keyword => 
                    `<span class="badge bg-secondary">${keyword}</span>`
                ).join(' ');
                
                tempHtml = `
                    <div class="tistory-file mb-3 p-2 border rounded bg-light" id="temp-content">
                        <div class="d-flex justify-content-between align-items-start">
                            <div class="flex-grow-1">
                                <div class="d-flex align-items-center mb-1">
                                    <span class="badge bg-success">ìƒˆë¡œ ìƒì„±ë¨</span>
                                </div>
                                <strong>ğŸ“ ${contentData.title}</strong>
                                <div class="mt-1">${keywordTags}</div>
                                <div class="text-muted small mt-1">
                                    <i class="bi bi-calendar"></i> ${date} (ë°©ê¸ˆ ì „)
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // ê¸°ì¡´ ë‚´ìš© ë§¨ ìœ„ì— ì¶”ê°€ (ì¦‰ì‹œ ë³´ì´ë„ë¡)
            console.log('ğŸ“Œ ì„ì‹œ ì½˜í…ì¸ ë¥¼ ëª©ë¡ ë§¨ ìœ„ì— ì¶”ê°€');
            container.insertAdjacentHTML('afterbegin', tempHtml);
        }
        
        // ì„ íƒì‚­ì œ ê¸°ëŠ¥
        const selectedFiles = {
            wordpress: new Set(),
            tistory: new Set()
        };
        
        // ì „ì²´ ì„ íƒ/í•´ì œ í† ê¸€
        function toggleSelectAll(type) {
            const selectAllCheckbox = document.getElementById(`select-all-${type}`);
            const containerId = type === 'wordpress' ? 'wordpress-files' : 'tistory-files';
            const container = document.getElementById(containerId);
            const contentCheckboxes = container.querySelectorAll('.content-checkbox[data-file-id]');
            const isChecked = selectAllCheckbox.checked;
            
            selectedFiles[type].clear();
            
            contentCheckboxes.forEach(checkbox => {
                checkbox.checked = isChecked;
                if (isChecked) {
                    const fileId = parseInt(checkbox.dataset.fileId);
                    selectedFiles[type].add(fileId);
                }
            });
            
            updateBulkActionBar(type);
        }
        
        // ê°œë³„ ì•„ì´í…œ ì„ íƒ/í•´ì œ í† ê¸€
        function toggleItemSelection(type, fileId) {
            // fileIdë¥¼ ì •ìˆ˜ë¡œ ë³€í™˜
            const numericFileId = parseInt(fileId);
            const checkbox = document.querySelector(`.content-checkbox[data-file-id="${fileId}"]`);
            
            if (checkbox.checked) {
                selectedFiles[type].add(numericFileId);
            } else {
                selectedFiles[type].delete(numericFileId);
            }
            
            // ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸
            const selectAllCheckbox = document.getElementById(`select-all-${type}`);
            const containerId = type === 'wordpress' ? 'wordpress-files' : 'tistory-files';
            const container = document.getElementById(containerId);
            const totalCheckboxes = container.querySelectorAll('.content-checkbox[data-file-id]').length;
            const checkedCount = selectedFiles[type].size;
            
            selectAllCheckbox.indeterminate = checkedCount > 0 && checkedCount < totalCheckboxes;
            selectAllCheckbox.checked = checkedCount === totalCheckboxes && totalCheckboxes > 0;
            
            updateBulkActionBar(type);
        }
        
        // ë²Œí¬ ì•¡ì…˜ ë°” ì—…ë°ì´íŠ¸
        function updateBulkActionBar(type) {
            const bulkActions = document.getElementById(`${type}-bulk-actions`);
            const selectedCount = document.getElementById(`${type}-selected-count`);
            const count = selectedFiles[type].size;
            
            selectedCount.textContent = `${count}ê°œ ì„ íƒë¨`;
            
            if (count > 0) {
                bulkActions.style.display = 'flex';
            } else {
                bulkActions.style.display = 'none';
            }
        }
        
        // ëª¨ë“  ì„ íƒ í•´ì œ
        function deselectAll(type) {
            selectedFiles[type].clear();
            
            // í•´ë‹¹ íƒ€ì…ì˜ ëª¨ë“  ì²´í¬ë°•ìŠ¤ í•´ì œ
            const containerId = type === 'wordpress' ? 'wordpress-files' : 'tistory-files';
            const container = document.getElementById(containerId);
            const checkboxes = container.querySelectorAll('.content-checkbox[data-file-id]');
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
            });
            
            // ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤ í•´ì œ
            const selectAllCheckbox = document.getElementById(`select-all-${type}`);
            selectAllCheckbox.checked = false;
            selectAllCheckbox.indeterminate = false;
            
            updateBulkActionBar(type);
        }
        
        // ë²Œí¬ ì‚­ì œ ì‹¤í–‰
        async function bulkDelete(type) {
            const selectedIds = Array.from(selectedFiles[type]);
            
            if (selectedIds.length === 0) {
                showNotification('ì‚­ì œí•  íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”', 'warning');
                return;
            }
            
            const confirmMessage = `ì„ íƒí•œ ${selectedIds.length}ê°œì˜ ${type === 'wordpress' ? 'WordPress' : 'Tistory'} íŒŒì¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`;
            
            if (!confirm(confirmMessage)) return;
            
            showNotification(`${selectedIds.length}ê°œ íŒŒì¼ ì‚­ì œ ì¤‘...`, 'info');
            
            try {
                const res = await fetch(`${window.location.origin}/api/bulk_delete_files`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        file_ids: selectedIds
                    })
                });
                
                if (!res.ok) {
                    throw new Error(`HTTP ${res.status}: ${res.statusText}`);
                }
                
                const result = await res.json();
                
                if (result.success) {
                    showNotification(`âœ… ${result.deleted_count}ê°œ íŒŒì¼ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤`, 'success');
                    
                    if (result.failed_ids && result.failed_ids.length > 0) {
                        showNotification(`âš ï¸ ${result.failed_ids.length}ê°œ íŒŒì¼ ì‚­ì œ ì‹¤íŒ¨`, 'warning');
                    }
                    
                    // ì„ íƒ ìƒíƒœ ì´ˆê¸°í™”
                    deselectAll(type);
                    
                    // ë°ì´í„° ìƒˆë¡œê³ ì¹¨
                    refreshData();
                } else {
                    showNotification(`âŒ ì‚­ì œ ì‹¤íŒ¨: ${result.error}`, 'error');
                }
            } catch (error) {
                console.error('ë²Œí¬ ì‚­ì œ ì˜¤ë¥˜:', error);
                showNotification(`âŒ ì‚­ì œ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì²´í¬ë°•ìŠ¤ ê°•ì œ ì¶”ê°€
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ’¡ ì²´í¬ë°•ìŠ¤ ê°•ì œ ì¶”ê°€ ì‹œì‘');
            
            // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ìœ¼ë¡œ ì´ë²ˆ ì£¼ ìŠ¤ì¼€ì¤„ í‘œì‹œ
            console.log('ğŸ“… í˜ì´ì§€ ë¡œë“œ: ì´ë²ˆ ì£¼ ìŠ¤ì¼€ì¤„ ìë™ í‘œì‹œ');
            const scheduleModal = document.getElementById('scheduleOverviewModal');
            if (scheduleModal) {
                // ëª¨ë‹¬ í‘œì‹œ ì—†ì´ ìŠ¤ì¼€ì¤„ ë°ì´í„°ë§Œ ë¡œë“œ
                showScheduleMonth(8); // 8ì›”ë¶€í„° ì‹œì‘
            }
            
            // WordPress í—¤ë”ì— ì²´í¬ë°•ìŠ¤ ì¶”ê°€
            setTimeout(function() {
                const wpHeader = document.querySelector('.card-header h5');
                if (wpHeader && wpHeader.textContent.includes('WordPress')) {
                    const parent = wpHeader.parentElement;
                    if (!parent.querySelector('#select-all-wordpress')) {
                        const checkboxContainer = document.createElement('div');
                        checkboxContainer.className = 'd-flex align-items-center';
                        checkboxContainer.innerHTML = `
                            <input type="checkbox" class="form-check-input select-all-checkbox me-2" 
                                   id="select-all-wordpress" onchange="toggleSelectAll('wordpress')" 
                                   style="display: block !important; visibility: visible !important; opacity: 1 !important; width: 20px; height: 20px;">
                        `;
                        parent.insertBefore(checkboxContainer.firstElementChild, wpHeader);
                        console.log('âœ… WordPress í—¤ë” ì²´í¬ë°•ìŠ¤ ì¶”ê°€ë¨');
                        
                        // ëŒ€ëŸ‰ ì‘ì—… ë°” ì¶”ê°€
                        addBulkActionBar('wordpress', wpHeader.closest('.card'));
                    }
                }
                
                // Tistory í—¤ë”ì— ì²´í¬ë°•ìŠ¤ ì¶”ê°€
                const allCards = document.querySelectorAll('.card');
                allCards.forEach(card => {
                    const header = card.querySelector('h5');
                    if (header && header.textContent.includes('Tistory')) {
                        const parent = header.parentElement;
                        if (!parent.querySelector('#select-all-tistory')) {
                            const checkboxContainer = document.createElement('div');
                            checkboxContainer.className = 'd-flex align-items-center';
                            checkboxContainer.innerHTML = `
                                <input type="checkbox" class="form-check-input select-all-checkbox me-2" 
                                       id="select-all-tistory" onchange="toggleSelectAll('tistory')" 
                                       style="display: block !important; visibility: visible !important; opacity: 1 !important; width: 20px; height: 20px;">
                            `;
                            parent.insertBefore(checkboxContainer.firstElementChild, header);
                            console.log('âœ… Tistory í—¤ë” ì²´í¬ë°•ìŠ¤ ì¶”ê°€ë¨');
                            
                            // ëŒ€ëŸ‰ ì‘ì—… ë°” ì¶”ê°€
                            addBulkActionBar('tistory', header.closest('.card'));
                        }
                    }
                });
            }, 1000); // 1ì´ˆ í›„ ì‹¤í–‰
        });
        
        // ëŒ€ëŸ‰ ì‘ì—… ë°” ì¶”ê°€
        function addBulkActionBar(type, cardElement) {
            if (cardElement.querySelector(`#${type}-bulk-actions`)) return;
            
            const bulkActionBar = document.createElement('div');
            bulkActionBar.id = `${type}-bulk-actions`;
            bulkActionBar.className = 'bulk-actions';
            bulkActionBar.style.cssText = `
                background: linear-gradient(135deg, #667eea, #764ba2);
                color: white;
                border-radius: 10px;
                padding: 15px;
                margin-bottom: 20px;
                display: none;
                align-items: center;
                justify-content: space-between;
                box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            `;
            
            bulkActionBar.innerHTML = `
                <div class="bulk-info">
                    <div class="bulk-count" id="${type}-selected-count" style="background: rgba(255, 255, 255, 0.2); border-radius: 15px; padding: 5px 12px; font-weight: bold;">0ê°œ ì„ íƒë¨</div>
                    <span style="margin-left: 15px;">ì„ íƒëœ ${type === 'wordpress' ? 'WordPress' : 'Tistory'} ì½˜í…ì¸ ë¥¼ ê´€ë¦¬í•˜ì„¸ìš”</span>
                </div>
                <div>
                    <button class="btn btn-light btn-sm me-2" onclick="deselectAll('${type}')" style="font-weight: bold;">
                        <i class="bi bi-x"></i> ì„ íƒ í•´ì œ
                    </button>
                    <button class="btn btn-danger btn-sm" onclick="bulkDelete('${type}')" style="font-weight: bold;">
                        <i class="bi bi-trash"></i> ì„ íƒ ì‚­ì œ
                    </button>
                </div>
            `;
            
            const cardBody = cardElement.querySelector('.card-body');
            cardBody.parentNode.insertBefore(bulkActionBar, cardBody);
            console.log(`âœ… ${type} ëŒ€ëŸ‰ ì‘ì—… ë°” ì¶”ê°€ë¨`);
        }

        // ====== ìë™ ë°œí–‰ ìŠ¤ì¼€ì¤„ ê´€ë¦¬ í•¨ìˆ˜ë“¤ ======

        // ì´ë²ˆ ì£¼ ì¼ìš”ì¼ ë‚ ì§œ ê³„ì‚° (ì£¼ì˜ ì‹œì‘)
        function getThisSunday() {
            const today = new Date();
            const dayOfWeek = today.getDay(); // 0=ì¼ìš”ì¼, 1=ì›”ìš”ì¼, ..., 6=í† ìš”ì¼
            
            // ì´ë²ˆ ì£¼ ì¼ìš”ì¼ê¹Œì§€ì˜ ì¼ìˆ˜ ê³„ì‚°
            const daysToSunday = dayOfWeek === 0 ? 0 : -dayOfWeek;
            
            const sunday = new Date(today);
            sunday.setDate(today.getDate() + daysToSunday);
            
            console.log('Today:', today.toISOString().split('T')[0], 'Day of week:', dayOfWeek, 'Days to Sunday:', daysToSunday, 'Sunday:', sunday.toISOString().split('T')[0]);
            
            return sunday.toISOString().split('T')[0];
        }

        // ì‚¬ìš© ì•ˆí•¨ - êµ¬ ì‹œìŠ¤í…œ í•¨ìˆ˜ (ë“€ì–¼ ì¹´í…Œê³ ë¦¬ë¡œ ëŒ€ì²´ë¨)
        function generateWeeklyTopicsClient_DEPRECATED(startDate) {
            console.warn('êµ¬ ì‹œìŠ¤í…œ í•¨ìˆ˜ í˜¸ì¶œë¨ - ë“€ì–¼ ì¹´í…Œê³ ë¦¬ ì‹œìŠ¤í…œ ì‚¬ìš© í•„ìš”');
            return {}; // ë¹ˆ ê°ì²´ ë°˜í™˜
            
            const date = new Date(startDate);
            const dateSeed = Math.floor(date.getTime() / (1000 * 60 * 60 * 24)); // ë‚ ì§œë¥¼ ìˆ«ìë¡œ ë³€í™˜
            
            // ì‹œë“œ ê¸°ë°˜ ëœë¤ í•¨ìˆ˜ - í•­ìƒ ê°™ì€ ë‚ ì§œëŠ” ê°™ì€ ê²°ê³¼ ë°˜í™˜
            function seededRandom(seed) {
                const x = Math.sin(seed) * 10000;
                return x - Math.floor(x);
            }
            
            const unpre_topics = [
                "JWT í† í° ê¸°ë°˜ ì‹œíë¦¬í‹° êµ¬í˜„",
                "DDD(ë„ë©”ì¸ ì£¼ë„ ì„¤ê³„) ì‹¤ì „ ì ìš©", 
                "C++ ìµœì‹  í”„ë¡œê·¸ë˜ë° ê¸°ë²•",
                "Kotlinìœ¼ë¡œ Android ì•± ê°œë°œ",
                "Python ë°ì´í„° ë¶„ì„ ë§ˆìŠ¤í„°",
                "React Hook ê³ ê¸‰ í™œìš©ë²•",
                "Spring Boot ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜",
                "Docker ì»¨í…Œì´ë„ˆ ìš´ì˜ ì‹¤ë¬´",
                "GraphQL API ì„¤ê³„ì™€ ìµœì í™”",
                "Redis ìºì‹± ì „ëµê³¼ ì„±ëŠ¥ íŠœë‹",
                "Kubernetes í´ëŸ¬ìŠ¤í„° ê´€ë¦¬",
                "MongoDB ìŠ¤í‚¤ë§ˆ ë””ìì¸ íŒ¨í„´",
                "Vue.js 3 Composition API í™œìš©",
                "TypeScript ê³ ê¸‰ íƒ€ì… ì‹œìŠ¤í…œ",
                "AWS ì„œë²„ë¦¬ìŠ¤ ì•„í‚¤í…ì²˜",
                "CI/CD íŒŒì´í”„ë¼ì¸ êµ¬ì¶• ê°€ì´ë“œ"
            ];
            
            const untab_topics = [
                "ì¹œí™˜ê²½ ë¶€ë™ì‚° ê·¸ë¦° ë¦¬ëª¨ë¸ë§ íŠ¸ë Œë“œ",
                "ê³ ë ¹í™” ì‚¬íšŒì™€ ì‹¤ë²„íƒ€ìš´ íˆ¬ì",
                "ì¸í”Œë ˆì´ì…˜ ì‹œëŒ€ì˜ íˆ¬ì ê°€ì´ë“œ", 
                "ê³µëª¨ì£¼ íˆ¬ì ì „ëµ ë¶„ì„",
                "ë©”íƒ€ë²„ìŠ¤ ë¶€ë™ì‚° íˆ¬ì",
                "ESG íˆ¬ìì˜ ë¯¸ë˜ ì „ë§",
                "ë¦¬ì¸ (REITs) íˆ¬ìì˜ ì¥ë‹¨ì ",
                "í•´ì™¸ ë¶€ë™ì‚° íˆ¬ì ê°€ì´ë“œ",
                "ì•”í˜¸í™”í ETF íˆ¬ì ì „ëµ",
                "ë°°ë‹¹ì£¼ í¬íŠ¸í´ë¦¬ì˜¤ êµ¬ì„±ë²•",
                "ê¸ˆìœµ ìœ„ê¸° ì‹œ ìì‚° ë³´í˜¸ ë°©ë²•",
                "ë¶€ë™ì‚° ê²½ë§¤ íˆ¬ì ë…¸í•˜ìš°",
                "ìŠ¤ë§ˆíŠ¸ í™ˆ ê¸°ìˆ ê³¼ ë¶€ë™ì‚° ê°€ì¹˜",
                "íœì…˜ íˆ¬ìì˜ ìˆ˜ìµì„± ë¶„ì„",
                "ìƒê°€ ì„ëŒ€ì—… ìš´ì˜ ì „ëµ",
                "ì‹ ë„ì‹œ ê°œë°œê³¼ íˆ¬ì ê¸°íšŒ"
            ];
            
            const skewese_topics = [
                "ìˆ˜ë©´ì˜ ê³¼í•™ê³¼ ì§ˆ ì¢‹ì€ ì ìë¦¬",
                "ì‹ ë¼ í†µì¼ì˜ ê³¼ì •ê³¼ ì—­ì‚¬ì  ì˜ë¯¸",
                "4.19í˜ëª…ê³¼ ë¯¼ì£¼ì£¼ì˜ ë°œì „", 
                "ì„ì§„ì™œë€ê³¼ ì´ìˆœì‹ ì˜ í™œì•½",
                "í•œêµ­ ì „í†µ ê±´ì¶•ì˜ ì•„ë¦„ë‹¤ì›€ê³¼ ê³¼í•™",
                "ì •ì¡°ì˜ ê°œí˜ ì •ì¹˜ì™€ í™”ì„± ê±´ì„¤",
                "ê³ êµ¬ë ¤ì˜ ì˜í†  í™•ì¥ê³¼ ê´‘ê°œí† ëŒ€ì™•",
                "ì¡°ì„  í›„ê¸° ì‹¤í•™ì‚¬ìƒì˜ ë°œì „",
                "ì¼ì œê°•ì ê¸° ë…ë¦½ìš´ë™ê°€ë“¤",
                "í•œêµ­ ì „ìŸê³¼ ë¶„ë‹¨ì˜ ì—­ì‚¬",
                "ê²½ì œê°œë°œ 5ê°œë…„ ê³„íšì˜ ì„±ê³¼",
                "88ì˜¬ë¦¼í”½ê³¼ í•œêµ­ì˜ êµ­ì œì  ìœ„ìƒ",
                "í•œê¸€ì˜ ê³¼í•™ì  ì›ë¦¬ì™€ ìš°ìˆ˜ì„±",
                "ë¶ˆêµ ì „ë˜ì™€ í•œêµ­ ë¬¸í™” í˜•ì„±",
                "ì¡°ì„ ì‹œëŒ€ ê³¼ê±°ì œë„ì˜ íŠ¹ì§•",
                "ê·¼ëŒ€í™” ê³¼ì •ì—ì„œ ì „í†µê³¼ í˜„ëŒ€ì˜ ë§Œë‚¨"
            ];
            
            const tistory_topics = [
                "ì¬ê±´ì¶• ê·œì œ ì™„í™”, ì‹œì¥ ë³€í™” ì˜ˆìƒ",
                "2025ë…„ ChatGPT-5ì™€ ì°¨ì„¸ëŒ€ AI í˜ì‹ ",
                "MZì„¸ëŒ€ íˆ¬ì íŒ¨í„´ ë¶„ì„, ë¶€ì‘ìš©ì€?",
                "ì¸í”Œë ˆì´ì…˜ ì¬ë¶€ìƒ? 2025ë…„ ì „ë§",
                "2026 ì›”ë“œì»µ ê³µë™ê°œìµœ, í•œêµ­ ì¶•êµ¬ ì¬ë„ì•½",
                "K-ë¬¸í™” ê¸€ë¡œë²Œ í™•ì‚° í˜„í™©",
                "ì „ê¸°ì°¨ ë°°í„°ë¦¬ ê¸°ìˆ  í˜ì‹ ê³¼ ë¯¸ë˜",
                "ì›ê²©ê·¼ë¬´ ì‹œëŒ€ì˜ ì‚¬ë¬´ê³µê°„ ë³€í™”",
                "í”Œë«í¼ ê²½ì œì™€ ê¸± ì›Œì»¤ë“¤",
                "Zì„¸ëŒ€ ì†Œë¹„ íŠ¸ë Œë“œ ë³€í™”",
                "ìŠ¤ë§ˆíŠ¸ì‹œí‹° êµ¬ì¶• í˜„í™©ê³¼ ì „ë§",
                "ë°”ì´ì˜¤ í—¬ìŠ¤ì¼€ì–´ ì‚°ì—… ë™í–¥",
                "ë¡œë´‡ ìë™í™”ì™€ ì¼ìë¦¬ ë³€í™”",
                "ë””ì§€í„¸ ë…¸ë§ˆë“œ ë¼ì´í”„ìŠ¤íƒ€ì¼",
                "íƒ„ì†Œì¤‘ë¦½ ì •ì±…ê³¼ ê¸°ì—… ëŒ€ì‘",
                "ë©”íƒ€ë²„ìŠ¤ êµìœ¡ì˜ ê°€ëŠ¥ì„±ê³¼ í•œê³„"
            ];
            
            // ë‚ ì§œë³„ë¡œ ê³ ì •ëœ ì¸ë±ìŠ¤ ê³„ì‚° (í•­ìƒ ê°™ì€ ë‚ ì§œëŠ” ê°™ì€ ì£¼ì œ)
            const unpre_index = Math.floor(seededRandom(dateSeed * 2 + 1) * unpre_topics.length);
            const untab_index = Math.floor(seededRandom(dateSeed * 3 + 2) * untab_topics.length);
            const skewese_index = Math.floor(seededRandom(dateSeed * 5 + 3) * skewese_topics.length);
            const tistory_index = Math.floor(seededRandom(dateSeed * 7 + 4) * tistory_topics.length);
            
            return {
                unpre: unpre_topics[unpre_index],
                untab: untab_topics[untab_index],
                skewese: skewese_topics[skewese_index],
                tistory: tistory_topics[tistory_index]
            };
        }

        // ì „ì²´ ìŠ¤ì¼€ì¤„ ë³´ê¸° ëª¨ë‹¬ í‘œì‹œ
        function showScheduleOverview() {
            const modal = new bootstrap.Modal(document.getElementById('scheduleOverviewModal'));
            modal.show();
            
            // ëª¨ë‹¬ì´ ì—´ë¦¬ë©´ í˜„ì¬ ì›” ìŠ¤ì¼€ì¤„ ë¡œë“œ (ë‹¹ì›”ë§Œ)
            showCurrentMonth(); // ë‹¹ì›”ë§Œ í‘œì‹œ
            calculateNextRunTime();
        }

        // ì‹œìŠ¤í…œ ìƒíƒœ ëª¨ë‹¬ í‘œì‹œ
        function showSystemStatus() {
            const modal = new bootstrap.Modal(document.getElementById('systemStatusModal'));
            modal.show();
            
            // ëª¨ë‹¬ì´ ì—´ë¦¬ë©´ ì‹œìŠ¤í…œ ìƒíƒœ ë¡œë“œ
            refreshSystemStatus();
        }

        // ì‹œìŠ¤í…œ ìƒíƒœ ì „ì²´ ìƒˆë¡œê³ ì¹¨
        async function refreshSystemStatus() {
            // ëª¨ë“  ìƒíƒœ ì´ˆê¸°í™”
            resetStatusLoading();
            
            // ë³‘ë ¬ë¡œ ëª¨ë“  ìƒíƒœ í™•ì¸
            await Promise.all([
                checkSystemOverview(),
                checkDatabaseStatus(),
                checkSchedulerStatus(),
                checkEnvironmentStatus(),
                loadSystemLogs()
            ]);
        }

        // ë¡œë”© ìƒíƒœë¡œ ì´ˆê¸°í™”
        function resetStatusLoading() {
            const sections = ['system-status-overview', 'db-status', 'scheduler-status', 'env-status'];
            sections.forEach(id => {
                document.getElementById(id).innerHTML = `
                    <div class="d-flex justify-content-center">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">í™•ì¸ ì¤‘...</span>
                        </div>
                    </div>
                `;
            });
        }

        // ì‹œìŠ¤í…œ ê°œìš” ìƒíƒœ í™•ì¸
        async function checkSystemOverview() {
            try {
                const response = await fetch('/api/system_status');
                
                // ì‘ë‹µ ìƒíƒœ í™•ì¸
                if (!response.ok) {
                    throw new Error(`ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜: ${response.status}`);
                }
                
                const data = await response.json();
                const statusElement = document.getElementById('system-status-overview');
                
                // APIëŠ” í•­ìƒ successë¥¼ ë°˜í™˜í•˜ë¯€ë¡œ status ê°ì²´ í™•ì¸
                const status = data.status || {};
                const overall = status.overall || 'healthy';
                
                // ìƒíƒœë³„ ìŠ¤íƒ€ì¼ ì„¤ì •
                const isHealthy = overall === 'healthy';
                const isWarning = overall === 'warning';
                const isError = overall === 'error';
                
                let statusColor = 'bg-success';
                let statusIcon = 'check-circle';
                let statusText = 'ì‹œìŠ¤í…œ ì •ìƒ';
                let alertClass = 'alert-success';
                
                if (isWarning) {
                    statusColor = 'bg-warning';
                    statusIcon = 'exclamation-triangle';
                    statusText = 'DB ì—°ê²° í™•ì¸ í•„ìš”';
                    alertClass = 'alert-warning';
                } else if (isError) {
                    statusColor = 'bg-danger';
                    statusIcon = 'x-circle';
                    statusText = 'ì‹œìŠ¤í…œ ì˜¤ë¥˜';
                    alertClass = 'alert-danger';
                }
                
                statusElement.innerHTML = `
                    <div class="row text-center">
                        <div class="col-6 mb-3">
                            <div class="p-3 rounded ${statusColor} text-white">
                                <i class="bi bi-${statusIcon} fs-3"></i>
                                <div class="mt-2">${statusText}</div>
                            </div>
                        </div>
                        <div class="col-6 mb-3">
                            <div class="p-3 rounded bg-info text-white">
                                <i class="bi bi-clock fs-3"></i>
                                <div class="mt-2">ê°€ë™ì‹œê°„</div>
                                <small>${status.uptime || 'ì„œë²„ ì‹¤í–‰ ì¤‘'}</small>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="alert ${alertClass} mb-0">
                                <strong>ğŸ–¥ï¸ ì„œë²„:</strong> ${status.server_info || 'Python Flask on Koyeb'}<br>
                                <strong>ğŸ—„ï¸ DB:</strong> ${status.database === 'connected' ? 'âœ… PostgreSQL ì—°ê²°ë¨' : status.database === 'disconnected' ? 'âŒ PostgreSQL ì—°ê²° ì‹¤íŒ¨' : 'â³ í™•ì¸ ì¤‘...'}<br>
                                ${status.memory_usage && status.memory_usage !== 'N/A' ? `<strong>ğŸ’¾ ë©”ëª¨ë¦¬:</strong> ${status.memory_usage}<br>` : ''}
                                ${status.cpu_usage && status.cpu_usage !== 'N/A' ? `<strong>âš¡ CPU:</strong> ${status.cpu_usage}<br>` : ''}
                                <strong>ğŸ”„ ì—…ë°ì´íŠ¸:</strong> ${new Date().toLocaleString()}<br>
                                ${!isHealthy ? `<hr><small><strong>ğŸ“Œ ì¡°ì¹˜ì‚¬í•­:</strong> ${status.database === 'disconnected' ? 'PostgreSQL ì—°ê²° ìƒíƒœë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”. (Koyeb DB ì„œë¹„ìŠ¤ í™•ì¸)' : 'ì‹œìŠ¤í…œ ë¡œê·¸ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.'}</small>` : '<hr><small>âœ… ëª¨ë“  ì‹œìŠ¤í…œì´ ì •ìƒ ì‘ë™ ì¤‘ì…ë‹ˆë‹¤.</small>'}
                            </div>
                        </div>
                    </div>
                `;
            } catch (error) {
                document.getElementById('system-status-overview').innerHTML = `
                    <div class="alert alert-danger mb-0">
                        <i class="bi bi-wifi-off"></i>
                        ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${error.message}
                    </div>
                `;
            }
        }

        // DB ì—°ê²° ìƒíƒœ í™•ì¸
        async function checkDatabaseStatus() {
            try {
                const response = await fetch('/api/database_status');
                const data = await response.json();
                
                const dbElement = document.getElementById('db-status');
                
                if (data.success) {
                    const db = data.database || {};
                    const connected = db.connected === true;
                    
                    dbElement.innerHTML = `
                        <div class="row">
                            <div class="col-12 mb-3">
                                <div class="alert ${connected ? 'alert-success' : 'alert-danger'} mb-2">
                                    <i class="bi bi-${connected ? 'check-circle' : 'x-circle'}"></i>
                                    <strong>ì—°ê²° ìƒíƒœ:</strong> ${connected ? 'ì—°ê²°ë¨' : 'ì—°ê²° ì‹¤íŒ¨'}
                                </div>
                                ${connected ? `
                                    <div class="small text-muted">
                                        <div><strong>í˜¸ìŠ¤íŠ¸:</strong> ${db.host || 'ì•Œ ìˆ˜ ì—†ìŒ'}</div>
                                        <div><strong>ë°ì´í„°ë² ì´ìŠ¤:</strong> ${db.database || 'ì•Œ ìˆ˜ ì—†ìŒ'}</div>
                                        <div><strong>ìŠ¤í‚¤ë§ˆ:</strong> ${db.schema || 'unble'}</div>
                                        <div><strong>í…Œì´ë¸” ìˆ˜:</strong> ${db.table_count !== undefined ? db.table_count : 'í™•ì¸ ì¤‘'}</div>
                                        <div><strong>ì´ ë ˆì½”ë“œ:</strong> ${db.total_records !== undefined ? db.total_records : 'í™•ì¸ ì¤‘'}</div>
                                    </div>
                                ` : `
                                    <div class="alert alert-warning mb-0">
                                        <strong>ì˜¤ë¥˜:</strong> ${db.error || 'ì—°ê²° ì‹¤íŒ¨'}<br>
                                        <div class="small text-muted mt-2">
                                            <div><strong>í˜¸ìŠ¤íŠ¸:</strong> ${db.host || 'ì•Œ ìˆ˜ ì—†ìŒ'}</div>
                                            <div><strong>ë°ì´í„°ë² ì´ìŠ¤:</strong> ${db.database || 'ì•Œ ìˆ˜ ì—†ìŒ'}</div>
                                            <div><strong>ìŠ¤í‚¤ë§ˆ:</strong> ${db.schema || 'unble'}</div>
                                        </div>
                                        <small>í™˜ê²½ë³€ìˆ˜ ì„¤ì •ì„ í™•ì¸í•˜ì„¸ìš”.</small>
                                    </div>
                                `}
                            </div>
                        </div>
                    `;
                } else {
                    dbElement.innerHTML = `
                        <div class="alert alert-danger mb-0">
                            <i class="bi bi-database-x"></i>
                            DB ìƒíƒœ í™•ì¸ ì‹¤íŒ¨: ${data.error}
                        </div>
                    `;
                }
            } catch (error) {
                document.getElementById('db-status').innerHTML = `
                    <div class="alert alert-danger mb-0">
                        <i class="bi bi-wifi-off"></i>
                        ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${error.message}
                    </div>
                `;
            }
        }

        // ìŠ¤ì¼€ì¤„ëŸ¬ ìƒíƒœ í™•ì¸
        async function checkSchedulerStatus() {
            try {
                const response = await fetch('/api/scheduler_status');
                const data = await response.json();
                
                const schedulerElement = document.getElementById('scheduler-status');
                
                if (data.success) {
                    const scheduler = data.scheduler || {};
                    const running = scheduler.running === true;
                    const jobsCount = scheduler.jobs_count || 0;
                    
                    schedulerElement.innerHTML = `
                        <div class="alert ${running ? 'alert-success' : 'alert-warning'} mb-2">
                            <i class="bi bi-${running ? 'play-circle' : 'pause-circle'}"></i>
                            <strong>ìƒíƒœ:</strong> ${running ? 'ì‹¤í–‰ ì¤‘' : 'ì¤‘ì§€ë¨'}
                        </div>
                        <div class="small text-muted">
                            <div><strong>ë“±ë¡ëœ ì‘ì—…:</strong> ${jobsCount}ê°œ</div>
                            <div><strong>ë‹¤ìŒ ì‹¤í–‰:</strong> ${scheduler.next_run || 'ì˜ˆì • ì—†ìŒ'}</div>
                            <div><strong>ë§ˆì§€ë§‰ ì‹¤í–‰:</strong> ${scheduler.last_run || 'ì—†ìŒ'}</div>
                            ${scheduler.last_error ? `
                                <div class="alert alert-danger mt-2 mb-0">
                                    <strong>ë§ˆì§€ë§‰ ì˜¤ë¥˜:</strong><br>
                                    <small>${scheduler.last_error}</small>
                                </div>
                            ` : ''}
                            ${jobsCount > 0 ? `
                                <div class="alert alert-info mt-2 mb-0">
                                    <i class="bi bi-info-circle"></i>
                                    ë§¤ì¼ ìƒˆë²½ 3ì‹œ ìë™ë°œí–‰ ì˜ˆì •
                                </div>
                            ` : ''}
                        </div>
                    `;
                } else {
                    schedulerElement.innerHTML = `
                        <div class="alert alert-danger mb-0">
                            <i class="bi bi-exclamation-triangle"></i>
                            ìŠ¤ì¼€ì¤„ëŸ¬ ìƒíƒœ í™•ì¸ ì‹¤íŒ¨: ${data.error}
                        </div>
                    `;
                }
            } catch (error) {
                document.getElementById('scheduler-status').innerHTML = `
                    <div class="alert alert-danger mb-0">
                        <i class="bi bi-wifi-off"></i>
                        ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${error.message}
                    </div>
                `;
            }
        }

        // í™˜ê²½ë³€ìˆ˜ ìƒíƒœ í™•ì¸
        async function checkEnvironmentStatus() {
            try {
                const response = await fetch('/api/environment_status');
                const data = await response.json();
                
                const envElement = document.getElementById('env-status');
                
                if (data.success) {
                    const env = data.environment;
                    const criticalMissing = env.critical_missing || [];
                    const optionalMissing = env.optional_missing || [];
                    
                    envElement.innerHTML = `
                        <div class="alert ${criticalMissing.length === 0 ? 'alert-success' : 'alert-danger'} mb-2">
                            <i class="bi bi-${criticalMissing.length === 0 ? 'check-circle' : 'exclamation-triangle'}"></i>
                            <strong>í•„ìˆ˜ í™˜ê²½ë³€ìˆ˜:</strong> ${criticalMissing.length === 0 ? 'ëª¨ë‘ ì„¤ì •ë¨' : 'ëˆ„ë½ë¨'}
                        </div>
                        ${criticalMissing.length > 0 ? `
                            <div class="alert alert-danger">
                                <strong>ëˆ„ë½ëœ í•„ìˆ˜ ë³€ìˆ˜:</strong>
                                <ul class="mb-0">
                                    ${criticalMissing.map(key => `<li>${key}</li>`).join('')}
                                </ul>
                            </div>
                        ` : ''}
                        ${optionalMissing.length > 0 ? `
                            <div class="alert alert-warning">
                                <strong>ëˆ„ë½ëœ ì„ íƒ ë³€ìˆ˜:</strong>
                                <ul class="mb-0">
                                    ${optionalMissing.map(key => `<li>${key}</li>`).join('')}
                                </ul>
                            </div>
                        ` : ''}
                        <div class="small text-muted">
                            <div><strong>ì„¤ì •ëœ ë³€ìˆ˜:</strong> ${env.total_set}ê°œ</div>
                            <div><strong>ì´ ë³€ìˆ˜:</strong> ${env.total_expected}ê°œ</div>
                        </div>
                    `;
                } else {
                    envElement.innerHTML = `
                        <div class="alert alert-danger mb-0">
                            <i class="bi bi-gear-wide-connected"></i>
                            í™˜ê²½ë³€ìˆ˜ í™•ì¸ ì‹¤íŒ¨: ${data.error}
                        </div>
                    `;
                }
            } catch (error) {
                document.getElementById('env-status').innerHTML = `
                    <div class="alert alert-danger mb-0">
                        <i class="bi bi-wifi-off"></i>
                        ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${error.message}
                    </div>
                `;
            }
        }

        // ì‹œìŠ¤í…œ ë¡œê·¸ ë¡œë“œ
        async function loadSystemLogs() {
            await refreshSystemLogs();
        }

        // ì‹œìŠ¤í…œ ë¡œê·¸ ìƒˆë¡œê³ ì¹¨
        async function refreshSystemLogs() {
            try {
                document.getElementById('system-logs').innerHTML = `
                    <div class="d-flex justify-content-center">
                        <div class="spinner-border text-dark" role="status">
                            <span class="visually-hidden">ë¡œê·¸ ë¡œë”© ì¤‘...</span>
                        </div>
                    </div>
                `;

                const response = await fetch('/api/system_logs?limit=20');
                const data = await response.json();
                
                const logsElement = document.getElementById('system-logs');
                
                if (data.success && data.logs.length > 0) {
                    logsElement.innerHTML = data.logs.map(log => `
                        <div class="log-entry border-start border-3 ${getLogBorderColor(log.log_level)} p-2 mb-2 bg-light">
                            <div class="d-flex justify-content-between align-items-start">
                                <div class="flex-grow-1">
                                    <span class="badge bg-${getLogBadgeColor(log.log_level)} me-2">${log.log_level}</span>
                                    <span class="text-muted small">${log.component}</span>
                                    <div class="mt-1">${log.message}</div>
                                    ${log.details ? `
                                        <details class="mt-2">
                                            <summary class="text-muted small cursor-pointer">ìƒì„¸ì •ë³´ ë³´ê¸°</summary>
                                            <pre class="mt-2 p-2 bg-white border rounded small">${JSON.stringify(log.details, null, 2)}</pre>
                                        </details>
                                    ` : ''}
                                </div>
                                <small class="text-muted">${new Date(log.timestamp).toLocaleString()}</small>
                            </div>
                        </div>
                    `).join('');
                } else {
                    logsElement.innerHTML = `
                        <div class="alert alert-info mb-0">
                            <i class="bi bi-info-circle"></i>
                            ${data.logs && data.logs.length === 0 ? 'ë¡œê·¸ê°€ ì—†ìŠµë‹ˆë‹¤.' : 'ë¡œê·¸ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'}
                        </div>
                    `;
                }
            } catch (error) {
                document.getElementById('system-logs').innerHTML = `
                    <div class="alert alert-danger mb-0">
                        <i class="bi bi-wifi-off"></i>
                        ë¡œê·¸ ë¡œë”© ì‹¤íŒ¨: ${error.message}
                    </div>
                `;
            }
        }

        // ë¡œê·¸ ë ˆë²¨ì— ë”°ë¥¸ ìƒ‰ìƒ ë°˜í™˜
        function getLogBorderColor(level) {
            switch(level.toUpperCase()) {
                case 'ERROR': return 'border-danger';
                case 'WARNING': return 'border-warning';
                case 'INFO': return 'border-info';
                case 'DEBUG': return 'border-secondary';
                default: return 'border-primary';
            }
        }

        function getLogBadgeColor(level) {
            switch(level.toUpperCase()) {
                case 'ERROR': return 'danger';
                case 'WARNING': return 'warning';
                case 'INFO': return 'info';
                case 'DEBUG': return 'secondary';
                default: return 'primary';
            }
        }

        // íŠ¹ì • ì£¼ì°¨ ìŠ¤ì¼€ì¤„ í‘œì‹œ - í´ë¼ì´ì–¸íŠ¸ì‚¬ì´ë“œ ìƒì„± ì‚¬ìš©
        async function showScheduleWeek(weekType) {
            try {
                // ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ë³€ê²½
                document.querySelectorAll('.schedule-overview-controls .btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                if (event && event.target) {
                    event.target.classList.add('active');
                }
                
                const today = new Date();
                let targetDate;
                let startDateObj;
                
                if (weekType === 'current') {
                    targetDate = getThisSunday();
                    startDateObj = new Date(targetDate);
                } else {
                    // ë‹¤ìŒ ì£¼ ì¼ìš”ì¼ = ì´ë²ˆ ì£¼ ì¼ìš”ì¼ + 7ì¼
                    const thisSunday = new Date(getThisSunday());
                    thisSunday.setDate(thisSunday.getDate() + 7);
                    targetDate = thisSunday.toISOString().split('T')[0];
                    startDateObj = thisSunday;
                    console.log('ë‹¤ìŒì£¼ ê³„ì‚° ê²°ê³¼:', {
                        ì´ë²ˆì£¼ì¼ìš”ì¼: getThisSunday(),
                        ë‹¤ìŒì£¼ì¼ìš”ì¼: targetDate,
                        thisSunday: thisSunday
                    });
                }
                
                console.log('í´ë¼ì´ì–¸íŠ¸ì‚¬ì´ë“œ ì£¼ì œ ìƒì„± ì‹œì‘:', targetDate);
                
                // ë“€ì–¼ ì¹´í…Œê³ ë¦¬ ì‹œìŠ¤í…œ ì‚¬ìš© - êµ¬ í•¨ìˆ˜ ë¹„í™œì„±í™”
                const weekTopics = {}; // generateWeeklyTopicsClient_DEPRECATED(targetDate);
                console.log('ìƒì„±ëœ ì£¼ì°¨ë³„ ì£¼ì œ:', weekTopics);
                
                // API ì‘ë‹µ í˜•ì‹ìœ¼ë¡œ ë°ì´í„° ë³€í™˜ (displayWeeklySchedule í•¨ìˆ˜ê°€ ê¸°ëŒ€í•˜ëŠ” êµ¬ì¡°)
                const scheduleData = {
                    week_start: targetDate,
                    schedule: {}
                };
                
                // ì£¼ê°„ 7ì¼ ìŠ¤ì¼€ì¤„ ìƒì„±
                const dayNames = ['ì¼ìš”ì¼', 'ì›”ìš”ì¼', 'í™”ìš”ì¼', 'ìˆ˜ìš”ì¼', 'ëª©ìš”ì¼', 'ê¸ˆìš”ì¼', 'í† ìš”ì¼'];
                
                for (let i = 0; i < 7; i++) {
                    const currentDate = new Date(startDateObj);
                    currentDate.setDate(currentDate.getDate() + i);
                    const dateStr = currentDate.toISOString().split('T')[0];
                    const dayName = dayNames[currentDate.getDay()];
                    
                    scheduleData.schedule[dateStr] = {
                        date: dateStr,
                        day_name: dayName,
                        sites: {}
                    };
                    
                    // ê° ë‚ ì§œë³„ë¡œ ë‹¤ë¥¸ ì£¼ì œ ìƒì„± (ì¼ë³„ + ì‚¬ì´íŠ¸ë³„ ê³ ìœ  ì£¼ì œ)
                    Object.keys(weekTopics).forEach(siteKey => {
                        // ë“€ì–¼ ì¹´í…Œê³ ë¦¬ ì‹œìŠ¤í…œ ì‚¬ìš© - êµ¬ í•¨ìˆ˜ ë¹„í™œì„±í™”  
                        const dailyTopics = {}; // generateWeeklyTopicsClient_DEPRECATED(dateStr);
                        
                        scheduleData.schedule[dateStr].sites[siteKey] = [{
                            time: '03:00',
                            topic: dailyTopics[siteKey],
                            category: getSiteDefaultCategory(siteKey),
                            status: 'scheduled'
                        }];
                    });
                }
                
                console.log('ìµœì¢… ìŠ¤ì¼€ì¤„ ë°ì´í„°:', scheduleData);
                
                // ìŠ¤ì¼€ì¤„ì„ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥
                try {
                    await fetch('/api/schedule/save', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({schedule_data: scheduleData})
                    });
                    console.log('ìŠ¤ì¼€ì¤„ DB ì €ì¥ ì™„ë£Œ');
                } catch (saveError) {
                    console.warn('ìŠ¤ì¼€ì¤„ DB ì €ì¥ ì‹¤íŒ¨:', saveError);
                }
                
                displayWeeklySchedule(scheduleData);
                
            } catch (error) {
                console.error('ìŠ¤ì¼€ì¤„ ë¡œë“œ ì˜¤ë¥˜:', error);
                const container = document.getElementById('schedule-overview-content') || document.getElementById('weekly-schedule-content');
                container.innerHTML = '<div class="text-center text-muted">ìŠ¤ì¼€ì¤„ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
            }
        }
        
        // ì›”ë³„ ìŠ¤ì¼€ì¤„ í‘œì‹œ
        // ë‹¹ì›” ìŠ¤ì¼€ì¤„ë§Œ í‘œì‹œ
        async function showCurrentMonth() {
            try {
                // í˜„ì¬ ì›”ë³„ ìŠ¤ì¼€ì¤„ API í˜¸ì¶œ
                const response = await fetch('/api/schedule/monthly');
                if (!response.ok) {
                    throw new Error('ì›”ë³„ ìŠ¤ì¼€ì¤„ì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
                
                const monthlyData = await response.json();
                console.log('ë‹¹ì›” ìŠ¤ì¼€ì¤„ ë°ì´í„°:', monthlyData);
                
                displayMonthlySchedule(monthlyData);
                
            } catch (error) {
                console.error('ë‹¹ì›” ìŠ¤ì¼€ì¤„ ë¡œë“œ ì˜¤ë¥˜:', error);
                const container = document.getElementById('schedule-overview-content');
                container.innerHTML = '<div class="text-center text-danger">ë‹¹ì›” ìŠ¤ì¼€ì¤„ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
            }
        }

        // ê¸°ì¡´ í•¨ìˆ˜ (ì‚¬ìš© ì•ˆ í•¨)
        async function showScheduleMonth(month) {
            try {
                // ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ë³€ê²½
                document.querySelectorAll('.schedule-overview-controls .btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                if (event && event.target) {
                    event.target.classList.add('active');
                }
                
                const year = 2025; // í˜„ì¬ëŠ” 2025ë…„ ê³ ì •
                
                // ì›”ë³„ ìŠ¤ì¼€ì¤„ API í˜¸ì¶œ (ìƒˆ API í˜•ì‹ ì‚¬ìš©)
                const monthParam = `${year}-${month.toString().padStart(2, '0')}`;
                const response = await fetch(`/api/schedule/monthly?month=${monthParam}`);
                if (!response.ok) {
                    throw new Error('ì›”ë³„ ìŠ¤ì¼€ì¤„ì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
                
                const monthlyData = await response.json();
                console.log('ì›”ë³„ ìŠ¤ì¼€ì¤„ ë°ì´í„°:', monthlyData);
                
                displayMonthlySchedule(monthlyData, year, month);
                
            } catch (error) {
                console.error('ì›”ë³„ ìŠ¤ì¼€ì¤„ ë¡œë“œ ì˜¤ë¥˜:', error);
                const container = document.getElementById('schedule-overview-content');
                container.innerHTML = '<div class="text-center text-muted">ì›”ë³„ ìŠ¤ì¼€ì¤„ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
            }
        }
        
        // ì›”ë³„ ìŠ¤ì¼€ì¤„ ë‹¬ë ¥ í‘œì‹œ
        function displayMonthlySchedule(scheduleData) {
            const container = document.getElementById('schedule-overview-content');
            
            console.log('ğŸ“Š ì›”ë³„ ìŠ¤ì¼€ì¤„ ë°ì´í„°:', scheduleData);
            
            if (scheduleData && scheduleData.schedule) {
                const monthSchedule = scheduleData.schedule; // ë°°ì—´ í˜•íƒœ
                
                // ë‹¬ë ¥ í‘œì‹œ
                let html = `
                    <div class="schedule-header mb-4">
                        <h6 class="text-primary">
                            ğŸ“… ${scheduleData.month_name} ì „ì²´ ë°œí–‰ ê³„íší‘œ (í•˜ë£¨ 8ê°œ í¬ìŠ¤íŒ…)
                        </h6>
                        <div class="text-muted small">ğŸ”¥ ì‹¤ì‹œê°„ íŠ¸ë Œë“œê°€ ì ìš©ëœ ì£¼ì œ í¬í•¨</div>
                    </div>
                    <div class="row">
                `;
                
                // ê° ë‚ ì§œë³„ë¡œ ì¹´ë“œ í‘œì‹œ
                monthSchedule.forEach(dayInfo => {
                    const { date, day_name, sites } = dayInfo;
                    const dayNum = new Date(date).getDate();
                    const hasSchedule = sites && Object.keys(sites).length > 0;
                    
                    let dayContent = '';
                    if (hasSchedule) {
                        // ê° ì‚¬ì´íŠ¸ë³„ ì£¼ì œ í‘œì‹œ
                        Object.entries(sites).forEach(([siteName, siteTopics]) => {
                            if (siteTopics && siteTopics.length > 0) {
                                dayContent += `
                                    <div class="site-schedule mb-2">
                                        <div class="site-header">
                                            <strong class="site-name text-primary">${siteName.toUpperCase()}</strong>
                                        </div>
                                `;
                                
                                siteTopics.forEach((topicInfo, index) => {
                                    const badgeClass = index === 0 ? 'bg-primary' : 'bg-secondary';
                                    const badgeText = index === 0 ? '1' : '2';
                                    dayContent += `
                                        <div class="topic-item mb-1">
                                            <span class="badge ${badgeClass} me-1">${badgeText}</span>
                                            <small class="category-name text-muted">[${topicInfo.category}]</small>
                                            <div class="topic-title small">${topicInfo.topic}</div>
                                        </div>
                                    `;
                                });
                                
                                dayContent += `</div>`;
                            }
                        });
                    }
                    
                    html += `
                        <div class="col-md-6 col-lg-4 mb-3">
                            <div class="card ${hasSchedule ? 'border-primary' : 'border-light'}">
                                <div class="card-header bg-light d-flex justify-content-between">
                                    <strong>${dayNum}ì¼ (${day_name})</strong>
                                    ${hasSchedule ? '<span class="badge bg-success">8ê°œ í¬ìŠ¤íŒ…</span>' : '<span class="badge bg-light text-muted">íœ´ì¼</span>'}
                                </div>
                                <div class="card-body p-2">
                                    ${dayContent || '<div class="text-muted small">ìŠ¤ì¼€ì¤„ ì—†ìŒ</div>'}
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                html += `
                    </div>
                    <style>
                        .site-schedule {
                            margin-bottom: 8px;
                        }
                        .site-name {
                            font-size: 0.8rem;
                            color: #0d6efd !important;
                        }
                        .topic-item {
                            display: flex;
                            align-items: start;
                            margin-bottom: 4px;
                        }
                        .topic-title {
                            font-size: 0.75rem;
                            line-height: 1.2;
                            margin-top: 1px;
                        }
                        .category-name {
                            font-size: 0.65rem;
                            margin-right: 4px;
                        }
                        .monthly-calendar .day-header .badge {
                            font-size: 0.65rem;
                            padding: 2px 4px;
                        }
                        .monthly-calendar .schedule-item {
                            margin-bottom: 3px;
                            border-radius: 3px;
                            padding: 3px;
                            font-size: 0.6rem;
                        }
                        .monthly-calendar .site-header {
                            text-align: center;
                            margin-bottom: 2px;
                            border-bottom: 1px solid rgba(255,255,255,0.3);
                            padding-bottom: 1px;
                        }
                        .monthly-calendar .site-name {
                            font-weight: bold;
                            font-size: 0.65rem;
                            color: #333;
                        }
                        .monthly-calendar .topic-item {
                            display: flex;
                            align-items: flex-start;
                            gap: 3px;
                            margin: 2px 0;
                            padding: 2px;
                            background: rgba(255,255,255,0.2);
                            border-radius: 2px;
                        }
                        .monthly-calendar .topic-item .badge {
                            font-size: 0.5rem;
                            padding: 1px 2px;
                            width: 12px;
                            height: 12px;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            flex-shrink: 0;
                        }
                        .monthly-calendar .topic-content {
                            flex: 1;
                            min-width: 0;
                        }
                        .monthly-calendar .category-name {
                            font-size: 0.55rem;
                            color: #666;
                            display: block;
                            margin-bottom: 1px;
                        }
                        .monthly-calendar .topic-title {
                            font-size: 0.6rem;
                            line-height: 1.2;
                            color: #333;
                            word-wrap: break-word;
                            overflow-wrap: break-word;
                            hyphens: auto;
                        }
                        .monthly-calendar .schedule-item.site-unpre {
                            background: #e3f2fd;
                            border-left: 2px solid #2196f3;
                        }
                        .monthly-calendar .schedule-item.site-untab {
                            background: #f3e5f5;
                            border-left: 2px solid #9c27b0;
                        }
                        .monthly-calendar .schedule-item.site-skewese {
                            background: #e8f5e8;
                            border-left: 2px solid #4caf50;
                        }
                        .monthly-calendar .schedule-item.site-tistory {
                            background: #fff3e0;
                            border-left: 2px solid #ff9800;
                        }
                    </style>
                    
                    <div class="mt-3 text-center">
                        <small class="text-muted">
                            ì´ ë°œí–‰ ì˜ˆì •: <strong>${Object.keys(monthSchedule).length * 8}</strong>ê°œ í¬ìŠ¤íŒ…
                            | P = Primary ì¹´í…Œê³ ë¦¬, S = Secondary ì¹´í…Œê³ ë¦¬
                        </small>
                    </div>
                `;
                
                container.innerHTML = html;
            } else if (scheduleData && scheduleData.length > 0) {
                // êµ¬í˜• API ì‘ë‹µ í˜•ì‹ ì²˜ë¦¬ (í˜¸í™˜ì„±)
                const scheduleByDate = {};
                scheduleData.forEach(item => {
                    const date = item.day;
                    if (!scheduleByDate[date]) {
                        scheduleByDate[date] = [];
                    }
                    scheduleByDate[date].push(item);
                });
                
                // êµ¬í˜• í˜•ì‹ í‘œì‹œ ë¡œì§...
                container.innerHTML = `
                    <div class="text-center py-4">
                        <p class="text-muted">êµ¬í˜• ìŠ¤ì¼€ì¤„ í˜•ì‹ì…ë‹ˆë‹¤. 2ê°œ ì¹´í…Œê³ ë¦¬ ì‹œìŠ¤í…œìœ¼ë¡œ ì—…ê·¸ë ˆì´ë“œê°€ í•„ìš”í•©ë‹ˆë‹¤.</p>
                    </div>
                `;
            } else {
                container.innerHTML = `
                    <div class="text-center py-4">
                        <div class="text-muted mb-3">
                            <i class="bi bi-calendar-x" style="font-size: 2rem;"></i>
                        </div>
                        <p class="text-muted">${year}ë…„ ${month}ì›” ë°œí–‰ ê³„íšì´ ì—†ìŠµë‹ˆë‹¤.</p>
                    </div>
                `;
            }
        }
        
        // ì‚¬ì´íŠ¸ë³„ ê¸°ë³¸ ì¹´í…Œê³ ë¦¬ ë°˜í™˜
        function getSiteDefaultCategory(siteKey) {
            const categories = {
                'unpre': 'í”„ë¡œê·¸ë˜ë°',
                'untab': 'ì·¨ë¯¸',
                'skewese': 'ë·°í‹°/íŒ¨ì…˜',
                'tistory': 'ì¼ë°˜'
            };
            return categories[siteKey] || 'ì¼ë°˜';
        }

        // ìŠ¤ì¼€ì¤„ ì „ì²´ í‘œì‹œ
        function displayScheduleOverview(scheduleData, weekType) {
            console.log('displayScheduleOverview called with:', scheduleData, weekType);
            console.log('scheduleData type:', typeof scheduleData);
            console.log('scheduleData keys:', scheduleData ? Object.keys(scheduleData) : 'null');
            console.log('scheduleData length:', scheduleData ? Object.keys(scheduleData).length : 0);
            
            const container = document.getElementById('schedule-overview-content');
            console.log('Container found:', container);
            
            if (!scheduleData || Object.keys(scheduleData).length === 0) {
                console.log('No schedule data, showing empty message');
                console.log('Condition details: scheduleData exists?', !!scheduleData, 'keys length:', scheduleData ? Object.keys(scheduleData).length : 0);
                container.innerHTML = `
                    <div class="text-center py-4">
                        <div class="text-muted mb-3">
                            <i class="bi bi-calendar-x" style="font-size: 2rem;"></i>
                        </div>
                        <p class="text-muted">${weekType === 'current' ? 'ì´ë²ˆ' : 'ë‹¤ìŒ'} ì£¼ ë°œí–‰ ê³„íšì´ ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤.</p>
                        <small class="text-muted">ì‹œìŠ¤í…œì´ ìë™ìœ¼ë¡œ ìŠ¤ì¼€ì¤„ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.</small>
                        <div class="mt-3">
                            <small class="text-warning">DEBUG: scheduleData = ${JSON.stringify(scheduleData)}</small>
                        </div>
                    </div>
                `;
                return;
            }
            
            console.log('Schedule data passed validation, proceeding with display');
            
            // ì›ë³¸ ë°ì´í„°ë¥¼ JSONìœ¼ë¡œ ì¶œë ¥í•´ì„œ ì‹¤ì œ êµ¬ì¡° í™•ì¸
            console.log('Raw scheduleData JSON:', JSON.stringify(scheduleData));
            console.log('First date raw data:', scheduleData['2025-08-11']);
            
            let html = `
                <div class="schedule-header mb-4">
                    <h6 class="text-primary">
                        ğŸ“… ${weekType === 'current' ? 'ì´ë²ˆ' : 'ë‹¤ìŒ'} ì£¼ ë°œí–‰ ê³„íš 
                    </h6>
                </div>
                <div class="row">
            `;
            
            // API ì‘ë‹µ ë°ì´í„°ë¥¼ ë‚ ì§œë³„ë¡œ í‘œì‹œ
            const scheduleEntries = Object.entries(scheduleData);
            console.log('Processing schedule entries:', scheduleEntries);
            scheduleEntries.forEach(([date, dayInfo]) => {
                console.log('Raw dayInfo for', date, ':', dayInfo);
                console.log('dayInfo type:', typeof dayInfo);
                console.log('dayInfo keys:', dayInfo ? Object.keys(dayInfo) : 'null');
                
                // ì§ì ‘ scheduleDataì—ì„œ ê°€ì ¸ì˜¤ê¸°
                const dayData = scheduleData[date];
                console.log('Direct access dayData:', dayData);
                console.log('Direct access keys:', dayData ? Object.keys(dayData) : 'null');
                
                if (!dayData || Object.keys(dayData).length === 0) {
                    console.log('No day data for date:', date);
                    return;
                }
                
                const dateObj = new Date(date);
                const dayName = dateObj.toLocaleDateString('ko-KR', { weekday: 'long' });
                
                html += `
                    <div class="col-md-6 col-lg-4 mb-3">
                        <div class="card schedule-day-card">
                            <div class="card-header bg-light">
                                <h6 class="mb-0">${dayName}</h6>
                                <small class="text-muted">${date}</small>
                            </div>
                            <div class="card-body p-2">
                `;
                
                // ì‚¬ì´íŠ¸ë³„ ê³„íš í‘œì‹œ
                const sites = ['unpre', 'untab', 'skewese', 'tistory'];
                sites.forEach(site => {
                    if (dayData[site]) {
                        const plan = dayData[site];
                        
                        html += `
                            <div class="schedule-site-item mb-2 p-2 bg-light rounded">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div class="flex-grow-1">
                                        <div class="site-badge site-${site} small mb-1">${site.toUpperCase()}</div>
                                        <div class="fw-bold small">${plan.time} ë°œí–‰</div>
                                        <div class="text-muted small">
                                            ì£¼ì œ: ${plan.topic || 'ìë™ ì„ íƒ'}
                                        </div>
                                    </div>
                                    <span class="badge bg-info small">${plan.status || 'ì˜ˆì •'}</span>
                                </div>
                            </div>
                        `;
                    }
                });
                
                html += `
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            console.log('Generated HTML length:', html.length);
            console.log('Final HTML:', html);
            container.innerHTML = html;
            console.log('HTML inserted into container');
        }

        // ë‹¤ìŒ ì‹¤í–‰ ì‹œê°„ ê³„ì‚°
        function calculateNextRunTime() {
            const now = new Date();
            const tomorrow = new Date(now);
            tomorrow.setDate(tomorrow.getDate() + 1);
            tomorrow.setHours(3, 0, 0, 0); // ìƒˆë²½ 3ì‹œ
            
            // ë§Œì•½ í˜„ì¬ ì‹œê°„ì´ ìƒˆë²½ 3ì‹œ ì´ì „ì´ë©´ ì˜¤ëŠ˜ 3ì‹œë¡œ ì„¤ì •
            if (now.getHours() < 3) {
                tomorrow.setDate(now.getDate());
            }
            
            const nextRunElement = document.getElementById('next-run-time');
            if (nextRunElement) {
                const options = { 
                    year: 'numeric', 
                    month: 'short', 
                    day: 'numeric', 
                    hour: '2-digit', 
                    minute: '2-digit' 
                };
                nextRunElement.textContent = tomorrow.toLocaleString('ko-KR', options);
            }
        }

        // ì¼ì£¼ì¼ì¹˜ ìŠ¤ì¼€ì¤„ ë¡œë“œ
        async function loadWeeklySchedule() {
            const weekPicker = document.getElementById('schedule-week-picker');
            const startDate = weekPicker.value || getThisSunday();
            
            try {
                console.log('ğŸ“… ìŠ¤ì¼€ì¤„ ë¡œë”© ì‹œì‘:', startDate);
                const response = await fetch(`/api/schedule/weekly?start_date=${startDate}`);
                const scheduleData = await response.json();
                
                console.log('ğŸ“Š API ì‘ë‹µ ë°ì´í„°:', scheduleData);
                console.log('ğŸ“Š schedule í‚¤ ì¡´ì¬:', !!scheduleData.schedule);
                console.log('ğŸ“Š schedule íƒ€ì…:', typeof scheduleData.schedule);
                if (scheduleData.schedule) {
                    console.log('ğŸ“Š schedule í‚¤ë“¤:', Object.keys(scheduleData.schedule));
                }
                
                displayWeeklySchedule(scheduleData);
            } catch (error) {
                console.error('ìŠ¤ì¼€ì¤„ ë¡œë“œ ì˜¤ë¥˜:', error);
                document.getElementById('weekly-schedule-content').innerHTML = 
                    '<div class="text-center text-muted">ìŠ¤ì¼€ì¤„ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
            }
        }

        // ìŠ¤ì¼€ì¤„ í‘œì‹œ
        function displayWeeklySchedule(scheduleData) {
            console.log('ğŸ¨ displayWeeklySchedule ì‹œì‘', scheduleData);
            console.log('ğŸ” Container search: weekly-schedule-content exists?', !!document.getElementById('weekly-schedule-content'));
            console.log('ğŸ” Container search: schedule-overview-content exists?', !!document.getElementById('schedule-overview-content'));
            
            const container = document.getElementById('schedule-overview-content') || document.getElementById('weekly-schedule-content');
            console.log('âœ… Selected container:', container);
            
            if (!scheduleData || !scheduleData.schedule) {
                console.log('âŒ ìŠ¤ì¼€ì¤„ ë°ì´í„° ì—†ìŒ:', !scheduleData, !scheduleData?.schedule);
                console.log('ğŸ“Š scheduleData keys:', scheduleData ? Object.keys(scheduleData) : 'null');
                container.innerHTML = `
                    <div class="text-center py-4">
                        <div class="text-muted mb-3">
                            <i class="bi bi-calendar-x" style="font-size: 2rem;"></i>
                        </div>
                        <p class="text-muted">í•´ë‹¹ ì£¼ì˜ ë°œí–‰ ìŠ¤ì¼€ì¤„ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                        <button class="btn btn-primary btn-sm" onclick="createWeeklySchedule()">
                            ìŠ¤ì¼€ì¤„ ìƒì„±í•˜ê¸°
                        </button>
                    </div>
                `;
                return;
            }
            
            // ìº˜ë¦°ë” ìŠ¤íƒ€ì¼ì„ ìœ„í•œ CSS ì¶”ê°€
            const calendarCSS = `
                <style>
                .calendar-week {
                    display: grid;
                    grid-template-columns: repeat(7, 1fr);
                    gap: 1px;
                    background: #dee2e6;
                    border-radius: 8px;
                    overflow: hidden;
                    margin-bottom: 20px;
                }
                .calendar-day {
                    background: white;
                    min-height: 250px;
                    padding: 8px;
                    position: relative;
                    overflow: visible;
                }
                .calendar-day.today {
                    background: #fff3cd;
                    border: 2px solid #ffc107;
                }
                .day-header {
                    font-size: 0.9rem;
                    font-weight: bold;
                    color: #495057;
                    margin-bottom: 8px;
                    text-align: center;
                    border-bottom: 1px solid #dee2e6;
                    padding-bottom: 4px;
                }
                .site-item {
                    margin-bottom: 6px;
                    padding: 6px 8px;
                    border-radius: 6px;
                    font-size: 0.8rem;
                    line-height: 1.3;
                    cursor: pointer;
                    transition: all 0.2s;
                    min-height: auto;
                }
                .site-item:hover {
                    transform: translateY(-1px);
                    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                }
                .site-unpre { background: #e3f2fd; color: #1976d2; }
                .site-untab { background: #f3e5f5; color: #7b1fa2; }
                .site-skewese { background: #e8f5e8; color: #388e3c; }
                .site-tistory { background: #fff3e0; color: #f57c00; }
                .status-published { border-left: 4px solid #28a745; }
                .status-generated { border-left: 4px solid #ffc107; }
                .status-planned { border-left: 4px solid #6c757d; }
                .time-badge {
                    position: absolute;
                    top: 4px;
                    right: 4px;
                    background: #007bff;
                    color: white;
                    font-size: 0.6rem;
                    padding: 2px 4px;
                    border-radius: 3px;
                }
                </style>
            `;
            
            let html = calendarCSS + `
                <div class="schedule-calendar-view">
                    <div class="text-center mb-4">
                        <h5><i class="bi bi-calendar-week"></i> ${scheduleData.week_start} ì£¼ê°„ ë°œí–‰ ê³„íš</h5>
                        <small class="text-muted">ë§¤ì¼ ìƒˆë²½ 3ì‹œ ìë™ ë°œí–‰</small>
                    </div>
                    
                    <div class="calendar-week">
            `;
            
            // ì˜¤ëŠ˜ ë‚ ì§œ
            const today = new Date().toISOString().split('T')[0];
            
            // scheduleData.schedule ê°ì²´ë¥¼ ìˆœíšŒ
            console.log('ğŸ”„ ìŠ¤ì¼€ì¤„ ë°ì´í„° ìˆœíšŒ ì‹œì‘');
            let dayCount = 0;
            for (const [dayNum, dayData] of Object.entries(scheduleData.schedule)) {
                console.log(`ğŸ“… Day ${dayNum}:`, dayData);
                dayCount++;
                
                const isToday = dayData.date === today;
                
                html += `
                    <div class="calendar-day ${isToday ? 'today' : ''}">
                        <div class="day-header">
                            ${dayData.day_name}
                            <br><small>${dayData.date}</small>
                        </div>
                        ${isToday ? '<div class="time-badge">03:00</div>' : ''}
                `;
                
                // ì‚¬ì´íŠ¸ë³„ ìŠ¤ì¼€ì¤„ í‘œì‹œ
                for (const [site, siteArray] of Object.entries(dayData.sites)) {
                    // siteArrayëŠ” ë°°ì—´ì´ë¯€ë¡œ ì²« ë²ˆì§¸ ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
                    const siteData = Array.isArray(siteArray) ? siteArray[0] : siteArray;
                    console.log(`ğŸ” Site ${site} data:`, siteData);
                    
                    if (!siteData) continue;
                    
                    const statusClass = `status-${siteData.status || 'scheduled'}`;
                    const siteClass = `site-${site}`;
                    
                    const statusIcon = siteData.status === 'published' ? 'âœ…' : 
                                      siteData.status === 'generated' ? 'â³' : 'ğŸ“';
                    
                    html += `
                        <div class="site-item ${siteClass} ${statusClass}" 
                             title="${siteData.topic || 'ì£¼ì œ ì—†ìŒ'} (${siteData.category || 'ì¹´í…Œê³ ë¦¬ ì—†ìŒ'})"
                             onclick="${siteData.url ? `window.open('${siteData.url}', '_blank')` : 'void(0)'}">
                            <div style="font-weight: bold; margin-bottom: 2px;">
                                ${statusIcon} ${site.toUpperCase()}
                            </div>
                            <div style="word-break: break-word; line-height: 1.2; max-height: none;">
                                ${siteData.topic || 'ì£¼ì œ ë¡œë”© ì¤‘...'}
                            </div>
                            <div style="font-size: 0.6rem; color: #666; margin-top: 2px;">
                                ${siteData.category || 'ì¹´í…Œê³ ë¦¬ ì—†ìŒ'}
                            </div>
                        </div>
                    `;
                }
                
                html += `</div>`;
            }
            
            html += `
                    </div>
                    
                    <div class="mt-4 text-center">
                        <div class="d-flex justify-content-center gap-3 mb-3">
                            <small><span style="display:inline-block;width:12px;height:12px;background:#28a745;margin-right:4px;"></span>ë°œí–‰ì™„ë£Œ</small>
                            <small><span style="display:inline-block;width:12px;height:12px;background:#ffc107;margin-right:4px;"></span>ìƒì„±ì™„ë£Œ</small>
                            <small><span style="display:inline-block;width:12px;height:12px;background:#6c757d;margin-right:4px;"></span>ì˜ˆì •</small>
                        </div>
                        <small class="text-muted">ğŸ’¡ ë°œí–‰ëœ ê¸€ì„ í´ë¦­í•˜ë©´ ìƒˆ ì°½ì—ì„œ ì—´ë¦½ë‹ˆë‹¤</small>
                    </div>
                </div>
            `;
            
            console.log('âœ… ìµœì¢… HTML ê¸¸ì´:', html.length);
            console.log('âœ… ì²˜ë¦¬ëœ ì¼ ìˆ˜:', dayCount);
            console.log('ğŸ¯ ì»¨í…Œì´ë„ˆì— HTML ì„¤ì • ì¤‘...');
            container.innerHTML = html;
            console.log('ğŸ‰ ìŠ¤ì¼€ì¤„ í‘œì‹œ ì™„ë£Œ!');
        }

        // ìˆ˜ë™ ë°œí–‰ íŠ¸ë¦¬ê±°
        async function triggerManualPublish() {
            const today = new Date().toISOString().split('T')[0];
            
            // ì‹¤ì œ ì˜¤ëŠ˜ ì£¼ì œë¥¼ APIì—ì„œ ê°€ì ¸ì˜¤ê¸°
            let todayTopics = {};
            let topicList = 'ğŸ“ ì˜¤ëŠ˜ ë“€ì–¼ ì¹´í…Œê³ ë¦¬ ë°œí–‰ ì£¼ì œ:\n\n';
            
            try {
                const response = await fetch('/api/get_today_topics');
                const data = await response.json();
                
                if (data.success && data.today_topics) {
                    todayTopics = data.today_topics;
                    
                    // APIì—ì„œ ê°€ì ¸ì˜¨ ì‹¤ì œ ì£¼ì œë¡œ í‘œì‹œ
                    Object.keys(todayTopics).forEach(site => {
                        if (todayTopics[site].primary && todayTopics[site].secondary) {
                            topicList += `ğŸ”¸ ${site.toUpperCase()}:\n`;
                            topicList += `   Primary: [${todayTopics[site].primary.category}] ${todayTopics[site].primary.topic}\n`;
                            topicList += `   Secondary: [${todayTopics[site].secondary.category}] ${todayTopics[site].secondary.topic}\n\n`;
                        }
                    });
                } else {
                    throw new Error('ì£¼ì œ ë¡œë”© ì‹¤íŒ¨');
                }
            } catch (error) {
                console.error('ì£¼ì œ ë¡œë”© ì˜¤ë¥˜:', error);
                // ì‹¤íŒ¨ì‹œ ê¸°ë³¸ ë©”ì‹œì§€
                topicList += 'âš ï¸ ì‹¤ì‹œê°„ ì£¼ì œ ë¡œë”© ì‹¤íŒ¨ - ê¸°ë³¸ ì£¼ì œë¡œ ë°œí–‰ë©ë‹ˆë‹¤.\n';
                topicList += 'ê° ì‚¬ì´íŠ¸ë³„ë¡œ ë“€ì–¼ ì¹´í…Œê³ ë¦¬ ì‹œìŠ¤í…œì— ë”°ë¼ 2ê°œì”© ìƒì„±ë©ë‹ˆë‹¤.\n\n';
            }
            
            if (!confirm(`âš ï¸ ì˜¤ëŠ˜(${today}) ë“€ì–¼ ì¹´í…Œê³ ë¦¬ ì‹œìŠ¤í…œìœ¼ë¡œ ì´ 8ê°œ ì½˜í…ì¸ ë¥¼ ì§€ê¸ˆ ìˆ˜ë™ ë°œí–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\n${topicList}ğŸ“Š ì‚¬ì´íŠ¸ë³„ 2ê°œì”©, ì´ 8ê°œ í¬ìŠ¤íŠ¸ê°€ ìƒì„±ë©ë‹ˆë‹¤.`)) {
                return;
            }
            
            // ì§„í–‰ìƒí™© ëª¨ë‹¬ ìƒì„±
            const progressModal = document.createElement('div');
            progressModal.innerHTML = `
                <div class="modal fade" id="publishProgressModal" tabindex="-1">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">ğŸš€ ë“€ì–¼ ì¹´í…Œê³ ë¦¬ ìˆ˜ë™ ë°œí–‰ ì¤‘... (ì´ 8ê°œ í¬ìŠ¤íŠ¸)</h5>
                            </div>
                            <div class="modal-body">
                                <div class="progress mb-3">
                                    <div class="progress-bar progress-bar-striped progress-bar-animated" 
                                         role="progressbar" style="width: 0%" id="publishProgress"></div>
                                </div>
                                <div id="publishStatus">ë“€ì–¼ ì¹´í…Œê³ ë¦¬ ë°œí–‰ì„ ì‹œì‘í•©ë‹ˆë‹¤...</div>
                                <div class="text-muted mb-2">ê° ì‚¬ì´íŠ¸ë³„ë¡œ Primary + Secondary ì¹´í…Œê³ ë¦¬ 2ê°œì”© ë°œí–‰</div>
                                <div id="estimatedTime" class="text-info mb-2" style="display:none">â±ï¸ ì˜ˆìƒ ì†Œìš”ì‹œê°„: ì•½ 10-15ë¶„</div>
                                <div id="currentProgress" class="text-primary mb-2"></div>
                                <ul id="publishResults" class="mt-3"></ul>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(progressModal);
            
            const modal = new bootstrap.Modal(document.getElementById('publishProgressModal'));
            modal.show();
            
            showNotification('ğŸš€ ë“€ì–¼ ì¹´í…Œê³ ë¦¬ ìˆ˜ë™ ë°œí–‰ì„ ì‹œì‘í•©ë‹ˆë‹¤... (ì´ 8ê°œ í¬ìŠ¤íŠ¸)', 'info');
            
            // ì‹œì‘ ì‹œê°„ ì €ì¥
            window.publishStartTime = Date.now();
            
            // ì‹¤ì‹œê°„ ìƒíƒœ í´ë§ ì‹œì‘
            const pollStatus = async () => {
                try {
                    const statusResponse = await fetch('/api/publish_status');
                    
                    // JSON ì‘ë‹µ í™•ì¸
                    if (!statusResponse.ok) {
                        console.error('ìƒíƒœ ì¡°íšŒ ì‹¤íŒ¨:', statusResponse.status);
                        return;
                    }
                    
                    const contentType = statusResponse.headers.get("content-type");
                    if (!contentType || !contentType.includes("application/json")) {
                        console.error('JSONì´ ì•„ë‹Œ ì‘ë‹µ ìˆ˜ì‹ :', contentType);
                        return;
                    }
                    
                    const status = await statusResponse.json();
                    
                    const progressBar = document.getElementById('publishProgress');
                    const statusDiv = document.getElementById('publishStatus');
                    const resultsUl = document.getElementById('publishResults');
                    
                    if (progressBar) {
                        progressBar.style.width = `${status.progress}%`;
                        progressBar.innerHTML = `${status.progress}%`;
                        
                        // ìƒì„¸í•œ ìƒíƒœ ë©”ì‹œì§€ êµ¬ì„±
                        let detailedStatus = status.message || 'ì²˜ë¦¬ ì¤‘...';
                        
                        if (status.in_progress && status.current_step) {
                            detailedStatus += `<br><small class="text-muted">ğŸ”¸ ${status.step_details || status.current_step}</small>`;
                        }
                        
                        if (status.current_task) {
                            detailedStatus += `<br><small class="text-info">ğŸ“ í˜„ì¬ ì‘ì—…: ${status.current_task}</small>`;
                        }
                        
                        if (status.elapsed_time) {
                            detailedStatus += `<br><small class="text-secondary">â±ï¸ ê²½ê³¼ ì‹œê°„: ${status.elapsed_time}</small>`;
                        }
                        
                        // ì§„í–‰ë¥  ìƒì„¸ ì •ë³´
                        if (status.total_posts > 0) {
                            const completed = status.completed_posts || 0;
                            const failed = status.failed_posts || 0;
                            const total = status.total_posts;
                            detailedStatus += `<br><small class="text-success">ğŸ“Š í¬ìŠ¤íŠ¸: ${completed}/${total} ì™„ë£Œ`;
                            if (failed > 0) {
                                detailedStatus += ` (ì‹¤íŒ¨: ${failed})`;
                            }
                            detailedStatus += `</small>`;
                        }
                        
                        statusDiv.innerHTML = detailedStatus;
                        
                        // ì—ëŸ¬ í‘œì‹œ
                        if (status.errors && status.errors.length > 0) {
                            let errorHtml = '<div class="mt-3"><h6 class="text-danger">ğŸš¨ ì˜¤ë¥˜ ë¡œê·¸:</h6><div class="alert alert-danger p-2" style="max-height: 200px; overflow-y: auto;">';
                            
                            status.errors.slice(-5).forEach((error, index) => {
                                const timestamp = new Date(error.timestamp).toLocaleTimeString();
                                errorHtml += `<small><strong>[${timestamp}]</strong> ${error.site || ''} ${error.type || ''}: ${error.message}<br>`;
                                if (error.details) {
                                    errorHtml += `<em class="text-muted">ìƒì„¸: ${error.details}</em><br>`;
                                }
                                errorHtml += '</small><hr class="my-1">';
                            });
                            
                            errorHtml += '</div></div>';
                            statusDiv.innerHTML += errorHtml;
                        }
                        
                        // ì˜ˆìƒ ì‹œê°„ í‘œì‹œ
                        const estimatedTimeDiv = document.getElementById('estimatedTime');
                        const currentProgressDiv = document.getElementById('currentProgress');
                        
                        if (status.progress > 0 && status.progress < 100) {
                            estimatedTimeDiv.style.display = 'block';
                            
                            // ê²½ê³¼ ì‹œê°„ ê¸°ë°˜ ì˜ˆìƒ ì‹œê°„ ê³„ì‚°
                            const startTime = window.publishStartTime || Date.now();
                            const elapsed = (Date.now() - startTime) / 1000; // ì´ˆ
                            const estimatedTotal = (elapsed / status.progress) * 100;
                            const remaining = Math.max(0, estimatedTotal - elapsed);
                            
                            const remainingMinutes = Math.ceil(remaining / 60);
                            if (remainingMinutes > 0) {
                                estimatedTimeDiv.innerHTML = `â±ï¸ ì˜ˆìƒ ë‚¨ì€ ì‹œê°„: ì•½ ${remainingMinutes}ë¶„`;
                            }
                        }
                        
                        // í˜„ì¬ ì²˜ë¦¬ ì¤‘ì¸ ì‚¬ì´íŠ¸ì™€ ì§„í–‰ë¥  í‘œì‹œ
                        if (status.current_site) {
                            currentProgressDiv.innerHTML = `ğŸ“ í˜„ì¬ ì²˜ë¦¬ì¤‘: ${status.current_site.toUpperCase()}`;
                        } else if (status.progress === 100) {
                            currentProgressDiv.innerHTML = 'âœ… ëª¨ë“  ì‘ì—… ì™„ë£Œ';
                        }
                        
                        // 8ê°œ í¬ìŠ¤íŠ¸ ê¸°ì¤€ ì§„í–‰ë¥  í‘œì‹œ
                        if (status.completed_sites !== undefined) {
                            currentProgressDiv.innerHTML += ` - ${status.completed_sites}/8 í¬ìŠ¤íŠ¸ ì™„ë£Œ`;
                        }
                        
                        // ì™„ë£Œëœ ì‚¬ì´íŠ¸ ê²°ê³¼ í‘œì‹œ
                        resultsUl.innerHTML = '';
                        if (status.results && Array.isArray(status.results)) {
                            status.results.forEach(result => {
                                const li = document.createElement('li');
                                li.className = (result.status === 'success' || result.success) ? 'text-success' : 'text-danger';
                                
                                // ë“€ì–¼ ì¹´í…Œê³ ë¦¬ ë°°ì§€ í‘œì‹œ
                                const categoryType = result.category || '';
                                const categoryBadge = categoryType === 'primary' ? '<span class="badge bg-primary me-1">P</span>' : 
                                                      categoryType === 'secondary' ? '<span class="badge bg-secondary me-1">S</span>' : '';
                                
                                let resultText = `${categoryBadge}${result.site.toUpperCase()}: ${result.message}`;
                                if (result.topic) {
                                    resultText += ` (ì£¼ì œ: ${result.topic})`;
                                }
                                if (result.url) {
                                    resultText += ` - <a href="${result.url}" target="_blank">ë°œí–‰ëœ ê¸€ ë³´ê¸°</a>`;
                                }
                                
                                li.innerHTML = resultText;
                                resultsUl.appendChild(li);
                            });
                        }
                        
                        if (!status.in_progress) {
                            // ì™„ë£Œë˜ë©´ í´ë§ ì¤‘ì§€
                            clearInterval(pollInterval);
                            
                            if (status.progress === 100) {
                                progressBar.className = 'progress-bar bg-success';
                                showNotification('âœ… ìë™ë°œí–‰ê³„íš ìˆ˜ë™ ì‹¤í–‰ ì™„ë£Œ!', 'success');
                            } else {
                                progressBar.className = 'progress-bar bg-danger';
                                showNotification('âŒ ë°œí–‰ ì¤‘ ì˜¤ë¥˜ ë°œìƒ', 'error');
                            }
                            
                            // ë°œí–‰ ì™„ë£Œ í›„ í•œ ë²ˆë§Œ ìƒˆë¡œê³ ì¹¨
                            setTimeout(() => {
                                loadWeeklySchedule();
                                refreshData();
                            }, 1000);
                            
                            // 5ì´ˆ í›„ ëª¨ë‹¬ ë‹«ê¸°
                            setTimeout(() => {
                                modal.hide();
                                if (progressModal && progressModal.parentNode) {
                                    progressModal.parentNode.removeChild(progressModal);
                                }
                            }, 5000);
                        }
                    }
                } catch (error) {
                    console.error('ìƒíƒœ í´ë§ ì˜¤ë¥˜:', error);
                }
            };
            
            // 1ì´ˆë§ˆë‹¤ ìƒíƒœ í´ë§
            const pollInterval = setInterval(pollStatus, 1000);
            
            try {
                // ë°œí–‰ ì‹œì‘ (ë¹ ë¥¸ API ì‚¬ìš©)
                const response = await fetch('/api/quick_publish', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({sites: ['unpre', 'untab', 'skewese', 'tistory']})
                });
                
                // ì‘ë‹µ ê²€ì¦
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const contentType = response.headers.get("content-type");
                if (!contentType || !contentType.includes("application/json")) {
                    throw new Error(`JSONì´ ì•„ë‹Œ ì‘ë‹µ: ${contentType}`);
                }
                
                const result = await response.json();
                
                // API í˜¸ì¶œ ì„±ê³µ ì‹œ ë©”ì‹œì§€
                if (result.success) {
                    console.log('ë°œí–‰ ìš”ì²­ì´ ì„±ê³µì ìœ¼ë¡œ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤:', result.message);
                } else {
                    console.error('ë°œí–‰ ì‹œì‘ ì‹¤íŒ¨:', result.message || result.error);
                    clearInterval(pollInterval);
                    showNotification(`âŒ ë°œí–‰ ì‹œì‘ ì‹¤íŒ¨: ${result.message || result.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`, 'error');
                    modal.hide();
                    if (progressModal && progressModal.parentNode) {
                        progressModal.parentNode.removeChild(progressModal);
                    }
                }
                
            } catch (error) {
                clearInterval(pollInterval);
                console.error('ë°œí–‰ ìš”ì²­ ì˜¤ë¥˜:', error);
                showNotification(`âŒ ë°œí–‰ ìš”ì²­ ì˜¤ë¥˜: ${error.message}`, 'error');
                modal.hide();
                if (progressModal && progressModal.parentNode) {
                    progressModal.parentNode.removeChild(progressModal);
                }
            }
        }

        // í˜ì´ì§€ ë¡œë“œì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            // ë‚ ì§œ ì„ íƒê¸°ë¥¼ ì´ë²ˆ ì£¼ ì¼ìš”ì¼ë¡œ ì„¤ì •
            document.getElementById('schedule-week-picker').value = getThisSunday();
            
            // ìŠ¤ì¼€ì¤„ ë¡œë“œ
            loadWeeklySchedule();
        });
        // ëˆ„ë½ëœ ì½˜í…ì¸  ê´€ë¦¬ í•¨ìˆ˜ë“¤
        function editContent(fileId, type) {
            alert(`${type} ì½˜í…ì¸  í¸ì§‘ ê¸°ëŠ¥ (ID: ${fileId})\nì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.`);
        }
        
        function downloadContent(fileId, type) {
            try {
                // ë‹¤ìš´ë¡œë“œ API í˜¸ì¶œ
                const downloadUrl = `/api/download_content/${fileId}`;
                
                showNotification(`ğŸ”„ ${type} ì½˜í…ì¸  ë‹¤ìš´ë¡œë“œ ì‹œì‘...`, 'info');
                
                // ì§ì ‘ ì°½ ì—´ê¸° ë°©ì‹ìœ¼ë¡œ ë³€ê²½
                window.open(downloadUrl, '_blank');
                
                // ì„±ê³µ ë©”ì‹œì§€ëŠ” ì•½ê°„ ì§€ì—° í›„ í‘œì‹œ
                setTimeout(() => {
                    showNotification(`âœ… ${type} ì½˜í…ì¸  ë‹¤ìš´ë¡œë“œê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
                }, 500);
                
            } catch (error) {
                console.error('ë‹¤ìš´ë¡œë“œ ì˜¤ë¥˜:', error);
                showNotification(`âŒ ë‹¤ìš´ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.`, 'error');
            }
        }
        
        function previewContent(fileId) {
            // ë¯¸ë¦¬ë³´ê¸° API í˜¸ì¶œ
            const previewUrl = `/api/preview_content/${fileId}`;
            const previewWindow = window.open(previewUrl, '_blank', 'width=1024,height=768,scrollbars=yes,resizable=yes');
            
            if (!previewWindow) {
                showNotification('íŒì—…ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. íŒì—… í—ˆìš© í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', 'warning');
            } else {
                showNotification('ë¯¸ë¦¬ë³´ê¸° ì°½ì´ ì—´ë ¸ìŠµë‹ˆë‹¤.', 'success');
            }
        }
        
        function deleteContent(fileId, type) {
            if (confirm(`ì •ë§ë¡œ ì´ ${type} ì½˜í…ì¸ ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                // ì‚­ì œ API í˜¸ì¶œ
                fetch('/api/delete_posts', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({post_ids: [fileId]})
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showNotification('ì½˜í…ì¸ ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                        // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                        refreshDataQuietly();
                    } else {
                        showNotification('ì‚­ì œ ì‹¤íŒ¨: ' + (data.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'), 'error');
                    }
                })
                .catch(error => {
                    console.error('ì‚­ì œ ì˜¤ë¥˜:', error);
                    showNotification('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                });
            }
        }
        
        function publishToTistory(fileId, buttonElement) {
            if (!confirm(`Tistoryì— ì½˜í…ì¸ ë¥¼ ë°œí–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                return;
            }
            
            // ë¡œë”© ìƒíƒœ í‘œì‹œ (ë²„íŠ¼ ìš”ì†Œë¥¼ ì•ˆì „í•˜ê²Œ ì°¾ê¸°)
            let button = buttonElement;
            if (!button && event && event.target) {
                button = event.target.closest('button');
            }
            
            let originalContent = '';
            if (button) {
                originalContent = button.innerHTML;
                button.disabled = true;
                button.innerHTML = '<i class="spinner-border spinner-border-sm"></i> ë°œí–‰ ì¤‘...';
            }
            
            fetch('/api/publish_post', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    post_id: fileId,
                    site: 'tistory'
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data && data.success) {
                    alert('Tistoryì— ì½˜í…ì¸ ê°€ ì„±ê³µì ìœ¼ë¡œ ë°œí–‰ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    location.reload(); // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ìœ¼ë¡œ ìƒíƒœ ì—…ë°ì´íŠ¸
                } else {
                    const errorMsg = (data && data.error) ? data.error : 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜';
                    alert(`ë°œí–‰ ì‹¤íŒ¨: ${errorMsg}`);
                }
            })
            .catch(error => {
                console.error('ë°œí–‰ ì˜¤ë¥˜:', error);
                alert(`ë°œí–‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
            })
            .finally(() => {
                // ë²„íŠ¼ ìƒíƒœ ë³µì›
                if (button) {
                    button.disabled = false;
                    button.innerHTML = originalContent;
                }
            });
        }
        
        function publishToWordPress(fileId, buttonElement) {
            if (!confirm(`WordPressì— ì½˜í…ì¸ ë¥¼ ë°œí–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                return;
            }
            
            // ë¡œë”© ìƒíƒœ í‘œì‹œ (ë²„íŠ¼ ìš”ì†Œë¥¼ ì•ˆì „í•˜ê²Œ ì°¾ê¸°)
            let button = buttonElement;
            if (!button && event && event.target) {
                button = event.target.closest('button');
            }
            
            let originalContent = '';
            if (button) {
                originalContent = button.innerHTML;
                button.disabled = true;
                button.innerHTML = '<i class="spinner-border spinner-border-sm"></i> ë°œí–‰ ì¤‘...';
            }
            
            fetch('/api/publish_post', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    post_id: fileId,
                    site: 'wordpress'
                })
            })
            .then(async response => {
                const contentType = response.headers.get('content-type');
                if (contentType && contentType.includes('application/json')) {
                    return response.json();
                } else {
                    const text = await response.text();
                    console.error('Non-JSON response:', text.substring(0, 200));
                    throw new Error(`ì„œë²„ì—ì„œ JSONì´ ì•„ë‹Œ ì‘ë‹µì„ ë°›ì•˜ìŠµë‹ˆë‹¤: ${response.status}`);
                }
            })
            .then(data => {
                if (data && data.success) {
                    alert('WordPressì— ì½˜í…ì¸ ê°€ ì„±ê³µì ìœ¼ë¡œ ë°œí–‰ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    if (data.url) {
                        console.log('ë°œí–‰ëœ URL:', data.url);
                    }
                    location.reload(); // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ìœ¼ë¡œ ìƒíƒœ ì—…ë°ì´íŠ¸
                } else {
                    const errorMsg = (data && data.error) ? data.error : 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜';
                    alert(`ë°œí–‰ ì‹¤íŒ¨: ${errorMsg}`);
                }
            })
            .catch(error => {
                console.error('ë°œí–‰ ì˜¤ë¥˜:', error);
                alert(`ë°œí–‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
            })
            .finally(() => {
                // ë²„íŠ¼ ìƒíƒœ ë³µì›
                if (button) {
                    button.disabled = false;
                    button.innerHTML = originalContent;
                }
            });
        }
        
        function publishContent(fileId, site, buttonElement) {
            if (!confirm(`${site} ì‚¬ì´íŠ¸ì— ì½˜í…ì¸ ë¥¼ ë°œí–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                return;
            }
            
            // ë¡œë”© ìƒíƒœ í‘œì‹œ (ë²„íŠ¼ ìš”ì†Œë¥¼ ì•ˆì „í•˜ê²Œ ì°¾ê¸°)
            let button = buttonElement;
            if (!button && event && event.target) {
                button = event.target.closest('button');
            }
            
            let originalContent = '';
            if (button) {
                originalContent = button.innerHTML;
                button.disabled = true;
                button.innerHTML = '<i class="spinner-border spinner-border-sm"></i> ë°œí–‰ ì¤‘...';
            }
            
            fetch('/api/publish_post', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    post_id: fileId,
                    site: site
                })
            })
            .then(async response => {
                const contentType = response.headers.get('content-type');
                if (contentType && contentType.includes('application/json')) {
                    return response.json();
                } else {
                    const text = await response.text();
                    console.error('Non-JSON response:', text.substring(0, 200));
                    throw new Error(`ì„œë²„ì—ì„œ JSONì´ ì•„ë‹Œ ì‘ë‹µì„ ë°›ì•˜ìŠµë‹ˆë‹¤: ${response.status}`);
                }
            })
            .then(data => {
                if (data && data.success) {
                    alert('ì½˜í…ì¸ ê°€ ì„±ê³µì ìœ¼ë¡œ ë°œí–‰ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    if (data.url) {
                        console.log('ë°œí–‰ëœ URL:', data.url);
                    }
                    location.reload(); // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ìœ¼ë¡œ ìƒíƒœ ì—…ë°ì´íŠ¸
                } else {
                    const errorMsg = (data && data.error) ? data.error : 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜';
                    alert(`ë°œí–‰ ì‹¤íŒ¨: ${errorMsg}`);
                }
            })
            .catch(error => {
                console.error('ë°œí–‰ ì˜¤ë¥˜:', error);
                alert(`ë°œí–‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
            })
            .finally(() => {
                // ë²„íŠ¼ ìƒíƒœ ë³µì›
                if (button) {
                    button.disabled = false;
                    button.innerHTML = originalContent;
                }
            });
        }

        function publishToWordPressSite(fileId, site, buttonElement) {
            if (!confirm(`${site.toUpperCase()} WordPress ì‚¬ì´íŠ¸ì— ì½˜í…ì¸ ë¥¼ ë°œí–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                return;
            }
            
            // ë¡œë”© ìƒíƒœ í‘œì‹œ
            let button = buttonElement;
            if (!button && event && event.target) {
                button = event.target.closest('button');
            }
            
            let originalContent = '';
            if (button) {
                originalContent = button.innerHTML;
                button.disabled = true;
                button.innerHTML = '<i class="spinner-border spinner-border-sm"></i> ë°œí–‰ ì¤‘...';
            }
            
            fetch('/api/publish_to_wordpress', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    site: site,
                    file_id: fileId
                })
            })
            .then(async response => {
                const contentType = response.headers.get('content-type');
                if (contentType && contentType.includes('application/json')) {
                    return response.json();
                } else {
                    const text = await response.text();
                    console.error('Non-JSON response:', text.substring(0, 200));
                    throw new Error(`ì„œë²„ì—ì„œ JSONì´ ì•„ë‹Œ ì‘ë‹µì„ ë°›ì•˜ìŠµë‹ˆë‹¤: ${response.status}`);
                }
            })
            .then(data => {
                if (data && data.success) {
                    showNotification(`${site.toUpperCase()} ì‚¬ì´íŠ¸ì— ì„±ê³µì ìœ¼ë¡œ ë°œí–‰ë˜ì—ˆìŠµë‹ˆë‹¤!`, 'success');
                    if (data.url) {
                        console.log('ë°œí–‰ëœ URL:', data.url);
                        showNotification(`ë°œí–‰ëœ URL: ${data.url}`, 'info');
                    }
                    // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                    refreshDataQuietly();
                } else {
                    const errorMsg = (data && data.error) ? data.error : 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜';
                    showNotification(`ë°œí–‰ ì‹¤íŒ¨: ${errorMsg}`, 'error');
                }
            })
            .catch(error => {
                console.error('WordPress ë°œí–‰ ì˜¤ë¥˜:', error);
                showNotification(`ë°œí–‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`, 'error');
            })
            .finally(() => {
                // ë²„íŠ¼ ìƒíƒœ ë³µì›
                if (button) {
                    button.disabled = false;
                    button.innerHTML = originalContent;
                }
            });
        }

        // ë‚ ì§œë³„ ìƒì„¸ ì£¼ì œ ëª¨ë‹¬ í‘œì‹œ
        function showDayDetailModal(date, dayData) {
            console.log('ë‚ ì§œ ìƒì„¸ ë³´ê¸°:', date, dayData);
            
            let modalHtml = `
                <div class="modal fade" id="dayDetailModal" tabindex="-1">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header bg-primary text-white">
                                <h5 class="modal-title">
                                    <i class="bi bi-calendar-day"></i> ${date} ë°œí–‰ ê³„íš ìƒì„¸
                                </h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <div class="row">
            `;
            
            // ì‚¬ì´íŠ¸ë³„ ìƒì„¸ ì •ë³´ í‘œì‹œ
            Object.entries(dayData).forEach(([site, categories]) => {
                const siteNames = {
                    'unpre': 'UNPRE',
                    'untab': 'UNTAB',
                    'skewese': 'SKEWESE',
                    'tistory': 'Tistory'
                };
                
                modalHtml += `
                    <div class="col-md-6 mb-4">
                        <div class="card border-primary">
                            <div class="card-header bg-primary text-white">
                                <h6 class="mb-0">
                                    <i class="bi bi-globe"></i> ${siteNames[site] || site.toUpperCase()}
                                </h6>
                            </div>
                            <div class="card-body">
                `;
                
                // Primary ì¹´í…Œê³ ë¦¬
                if (categories.primary) {
                    modalHtml += `
                        <div class="mb-3">
                            <div class="d-flex align-items-center mb-2">
                                <span class="badge bg-primary me-2">Primary</span>
                                <strong>${categories.primary.category}</strong>
                            </div>
                            <div class="ps-3">
                                <p class="mb-2 text-dark">
                                    <i class="bi bi-lightbulb"></i> ${categories.primary.topic}
                                </p>
                                <div class="keywords-section">
                                    <small class="text-muted">í‚¤ì›Œë“œ:</small>
                                    ${categories.primary.keywords ? 
                                        categories.primary.keywords.map(k => 
                                            `<span class="badge bg-primary bg-opacity-25 text-primary me-1">${k}</span>`
                                        ).join('') : 
                                        '<span class="text-muted">í‚¤ì›Œë“œ ì—†ìŒ</span>'
                                    }
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                // Secondary ì¹´í…Œê³ ë¦¬
                if (categories.secondary) {
                    modalHtml += `
                        <div>
                            <div class="d-flex align-items-center mb-2">
                                <span class="badge bg-secondary me-2">Secondary</span>
                                <strong>${categories.secondary.category}</strong>
                            </div>
                            <div class="ps-3">
                                <p class="mb-2 text-dark">
                                    <i class="bi bi-lightbulb"></i> ${categories.secondary.topic}
                                </p>
                                <div class="keywords-section">
                                    <small class="text-muted">í‚¤ì›Œë“œ:</small>
                                    ${categories.secondary.keywords ? 
                                        categories.secondary.keywords.map(k => 
                                            `<span class="badge bg-secondary bg-opacity-25 text-secondary me-1">${k}</span>`
                                        ).join('') : 
                                        '<span class="text-muted">í‚¤ì›Œë“œ ì—†ìŒ</span>'
                                    }
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                modalHtml += `
                            </div>
                        </div>
                    </div>
                `;
            });
            
            modalHtml += `
                                </div>
                                <div class="alert alert-info mt-3">
                                    <i class="bi bi-info-circle"></i>
                                    <strong>ì´ ${Object.keys(dayData).length * 2}ê°œ</strong> í¬ìŠ¤íŒ…ì´ ì´ ë‚  ë°œí–‰ë©ë‹ˆë‹¤.
                                    (ê° ì‚¬ì´íŠ¸ë³„ Primary + Secondary ì¹´í…Œê³ ë¦¬)
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // ê¸°ì¡´ ëª¨ë‹¬ ì œê±° í›„ ìƒˆë¡œ ì¶”ê°€
            const existingModal = document.getElementById('dayDetailModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            
            // ëª¨ë‹¬ í‘œì‹œ
            const modal = new bootstrap.Modal(document.getElementById('dayDetailModal'));
            modal.show();
        }

    </script>
</body>
</html>