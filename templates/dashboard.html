<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="timestamp" content="2025-08-11-01-05">
    <meta name="version" content="bulk-delete-v2.1">
    <script>
        // ìºì‹œ ë¬´íš¨í™”ë¥¼ ìœ„í•œ ê°•ì œ ìƒˆë¡œê³ ì¹¨
        if (performance.navigation.type !== 1) {
            console.log("ê°•ì œ ìºì‹œ ìƒˆë¡œê³ ì¹¨ ì‹¤í–‰");
        }
    </script>
    <title>ë¸”ë¡œê·¸ ìë™í™” ëŒ€ì‹œë³´ë“œ v2.1 (ì„ íƒì‚­ì œ ê¸°ëŠ¥ ì¶”ê°€)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .navbar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.08);
            transition: transform 0.3s;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        .stat-card {
            padding: 20px;
            border-radius: 10px;
            color: white;
            position: relative;
            overflow: hidden;
        }
        .stat-card::after {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: rgba(255,255,255,0.1);
            transform: rotate(45deg);
        }
        .stat-card h3 {
            font-size: 2.5rem;
            font-weight: bold;
        }
        .stat-card p {
            margin: 0;
            opacity: 0.9;
        }
        .bg-gradient-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .bg-gradient-success {
            background: linear-gradient(135deg, #48c774 0%, #3ec46d 100%);
        }
        .bg-gradient-info {
            background: linear-gradient(135deg, #4fc3f7 0%, #29b6f6 100%);
        }
        .bg-gradient-warning {
            background: linear-gradient(135deg, #ffb74d 0%, #ffa726 100%);
        }
        .site-badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin: 2px;
        }
        .site-unpre { background-color: #e3f2fd; color: #1976d2; }
        .site-untab { background-color: #e8f5e9; color: #388e3c; }
        .site-skewese { background-color: #fff3e0; color: #f57c00; }
        .site-tistory { background-color: #fce4ec; color: #c2185b; }
        
        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 5px;
        }
        .status-online { background-color: #4caf50; }
        .status-offline { background-color: #f44336; }
        
        .log-entry {
            padding: 10px;
            border-left: 3px solid #667eea;
            margin-bottom: 10px;
            background: white;
            border-radius: 5px;
        }
        
        .schedule-item {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            background: white;
            border-left: 4px solid #667eea;
        }
        
        #loader {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: none;
        }
        
        .spinner-border {
            width: 3rem;
            height: 3rem;
        }
        
        .tistory-file {
            padding: 15px;
            margin-bottom: 10px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #ff6b6b;
        }
        
        .refresh-btn {
            animation: rotate 2s linear infinite;
        }
        
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        
        /* ìŠ¤í•€ ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€ */
        .spin {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        /* ì¤‘ì•™ ì§„í–‰ ê³¼ì • ì˜¤ë²„ë ˆì´ */
        .progress-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .progress-container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            text-align: center;
            min-width: 400px;
            max-width: 500px;
        }
        
        .progress-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 30px;
        }
        
        .progress-steps-list {
            list-style: none;
            padding: 0;
            margin: 20px 0;
        }
        
        .progress-step-item {
            display: flex;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #f0f0f0;
            transition: all 0.3s ease;
        }
        
        .progress-step-item:last-child {
            border-bottom: none;
        }
        
        .progress-step-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            transition: all 0.3s ease;
        }
        
        .progress-step-icon.waiting {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            color: #6c757d;
        }
        
        .progress-step-icon.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            animation: pulse 2s infinite;
        }
        
        .progress-step-icon.completed {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
        }
        
        .progress-step-text {
            flex: 1;
            text-align: left;
            font-size: 1rem;
        }
        
        .progress-step-text.active {
            color: #667eea;
            font-weight: 600;
        }
        
        .progress-step-text.completed {
            color: #28a745;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.7); }
            70% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(102, 126, 234, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(102, 126, 234, 0); }
        }
        
        /* ë¡œë”© ìŠ¤í”¼ë„ˆ ê°œì„  */
        .loading-spinner {
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        
        /* ì—…ë°ì´íŠ¸ ì¸ë””ì¼€ì´í„° ê°œì„  */
        .update-indicator {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 15px;
            padding: 15px 20px;
            margin: 10px 0;
            font-size: 1rem;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .update-indicator .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        
        /* ì„ íƒì‚­ì œ ê¸°ëŠ¥ ìŠ¤íƒ€ì¼ */
        .bulk-actions {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            display: none;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .bulk-actions.show {
            display: flex;
        }
        
        .bulk-info {
            display: flex;
            align-items: center;
        }
        
        .bulk-count {
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 10px;
            border-radius: 15px;
            margin-right: 15px;
            font-weight: bold;
        }
        
        .content-item {
            transition: all 0.3s ease;
        }
        
        .content-item.selected {
            background-color: #f8f9ff !important;
            border-color: #667eea !important;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
        }
        
        .content-checkbox {
            transform: scale(1.2);
            margin-right: 10px;
            display: inline-block !important;
            visibility: visible !important;
            opacity: 1 !important;
            width: 16px !important;
            height: 16px !important;
        }
        
        .select-all-checkbox {
            transform: scale(1.3);
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            width: 20px !important;
            height: 20px !important;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-dark">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1">
                <i class="bi bi-robot"></i> ë¸”ë¡œê·¸ ìë™í™” ëŒ€ì‹œë³´ë“œ
            </span>
            <div class="text-white">
                <a href="/trending" class="btn btn-outline-light btn-sm me-3">
                    <i class="bi bi-graph-up"></i> íŠ¸ë Œë”©
                </a>
                <span id="current-time"></span>
                <button class="btn btn-light btn-sm ms-3" onclick="refreshData()">
                    <i class="bi bi-arrow-clockwise"></i> ìƒˆë¡œê³ ì¹¨
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container-fluid mt-4">
        <!-- Stats Cards -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="stat-card bg-gradient-primary">
                    <h3 id="total-posts">0</h3>
                    <p>ì „ì²´ í¬ìŠ¤íŠ¸</p>
                    <i class="bi bi-file-text" style="position: absolute; right: 20px; top: 20px; font-size: 2rem; opacity: 0.3;"></i>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card bg-gradient-success">
                    <h3 id="today-posts">0</h3>
                    <p>ì˜¤ëŠ˜ ë°œí–‰</p>
                    <i class="bi bi-calendar-check" style="position: absolute; right: 20px; top: 20px; font-size: 2rem; opacity: 0.3;"></i>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card bg-gradient-info">
                    <h3 id="total-views">0</h3>
                    <p>ì´ ì¡°íšŒìˆ˜</p>
                    <i class="bi bi-eye" style="position: absolute; right: 20px; top: 20px; font-size: 2rem; opacity: 0.3;"></i>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card bg-gradient-warning">
                    <h3 id="total-revenue">â‚©0</h3>
                    <p>ì˜ˆìƒ ìˆ˜ìµ</p>
                    <i class="bi bi-currency-dollar" style="position: absolute; right: 20px; top: 20px; font-size: 2rem; opacity: 0.3;"></i>
                </div>
            </div>
        </div>

        <!-- System Status -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-light">
                        <h5 class="mb-0"><i class="bi bi-activity"></i> ì‹œìŠ¤í…œ ìƒíƒœ</h5>
                    </div>
                    <div class="card-body">
                        <div class="row" id="system-status">
                            <div class="col-md-3">
                                <span class="status-indicator status-offline"></span> unpre.co.kr
                            </div>
                            <div class="col-md-3">
                                <span class="status-indicator status-offline"></span> untab.co.kr
                            </div>
                            <div class="col-md-3">
                                <span class="status-indicator status-offline"></span> skewese.com
                            </div>
                            <div class="col-md-3">
                                <span class="status-indicator status-offline"></span> Database
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts -->
        <div class="row mb-4">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header bg-light">
                        <h5 class="mb-0"><i class="bi bi-graph-up"></i> ì¼ë³„ ë°œí–‰ í˜„í™©</h5>
                    </div>
                    <div class="card-body">
                        <canvas id="dailyChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header bg-light">
                        <h5 class="mb-0"><i class="bi bi-pie-chart"></i> ì‚¬ì´íŠ¸ë³„ í†µê³„</h5>
                    </div>
                    <div class="card-body">
                        <canvas id="siteChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Posts & Schedule -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-light">
                        <h5 class="mb-0"><i class="bi bi-clock-history"></i> ìµœê·¼ í¬ìŠ¤íŠ¸</h5>
                    </div>
                    <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                        <div id="recent-posts"></div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-light d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="bi bi-calendar-week"></i> ìë™ ë°œí–‰ ê³„íš (ìƒˆë²½ 3ì‹œ ì‹¤í–‰)</h5>
                        <div>
                            <button class="btn btn-sm btn-info" onclick="showScheduleOverview()">
                                <i class="bi bi-eye"></i> ì „ì²´ ê³„íš ë³´ê¸°
                            </button>
                            <button class="btn btn-sm btn-warning" onclick="triggerManualPublish()">
                                <i class="bi bi-lightning"></i> ìˆ˜ë™ ë°œí–‰
                            </button>
                        </div>
                    </div>
                    <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                        <div class="mb-3 text-center">
                            <div class="auto-schedule-info bg-light p-3 rounded">
                                <h6 class="mb-1"><i class="bi bi-clock"></i> ìë™ ë°œí–‰ ì‹œê°„</h6>
                                <div class="text-primary fw-bold">ë§¤ì¼ ìƒˆë²½ 3:00</div>
                                <small class="text-muted">3ê°œ ì‚¬ì´íŠ¸ ë™ì‹œ ë°œí–‰</small>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label small">ì£¼ì°¨ ì„ íƒ:</label>
                            <input type="date" id="schedule-week-picker" class="form-control form-control-sm" 
                                   onchange="loadWeeklySchedule()">
                        </div>
                        <div id="weekly-schedule-content"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Content Management -->
        <div class="row mb-4">
            <!-- WordPress Files -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-light d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center">
                            <input type="checkbox" class="form-check-input select-all-checkbox me-2" 
                                   id="select-all-wordpress" onchange="toggleSelectAll('wordpress')">
                            <h5 class="mb-0"><i class="bi bi-wordpress"></i> WordPress ì½˜í…ì¸ </h5>
                        </div>
                        <div class="dropdown">
                            <button class="btn btn-sm btn-success dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                <i class="bi bi-plus-circle"></i> ìƒˆ ì½˜í…ì¸ 
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#" onclick="showWordPressModal('unpre')">unpre ì½˜í…ì¸  ìƒì„±</a></li>
                                <li><a class="dropdown-item" href="#" onclick="showWordPressModal('untab')">untab ì½˜í…ì¸  ìƒì„±</a></li>
                                <li><a class="dropdown-item" href="#" onclick="showWordPressModal('skewese')">skewese ì½˜í…ì¸  ìƒì„±</a></li>
                            </ul>
                        </div>
                    </div>
                    
                    <!-- WordPress ì„ íƒì‚­ì œ ì•¡ì…˜ ë°” -->
                    <div id="wordpress-bulk-actions" class="bulk-actions">
                        <div class="bulk-info">
                            <div class="bulk-count" id="wordpress-selected-count">0ê°œ ì„ íƒë¨</div>
                            <span>ì„ íƒëœ WordPress ì½˜í…ì¸ ë¥¼ ê´€ë¦¬í•˜ì„¸ìš”</span>
                        </div>
                        <div>
                            <button class="btn btn-light btn-sm me-2" onclick="deselectAll('wordpress')">
                                <i class="bi bi-x"></i> ì„ íƒ í•´ì œ
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="bulkDelete('wordpress')">
                                <i class="bi bi-trash"></i> ì„ íƒ ì‚­ì œ
                            </button>
                        </div>
                    </div>
                    <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                        <div id="wordpress-files"></div>
                    </div>
                </div>
            </div>
            
            <!-- Tistory Files -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-light d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center">
                            <input type="checkbox" class="form-check-input select-all-checkbox me-2" 
                                   id="select-all-tistory" onchange="toggleSelectAll('tistory')">
                            <h5 class="mb-0"><i class="bi bi-file-earmark-text"></i> Tistory ì½˜í…ì¸ </h5>
                        </div>
                        <button class="btn btn-sm btn-primary" onclick="showTistoryModal()">
                            <i class="bi bi-plus-circle"></i> ìƒˆ ì½˜í…ì¸  ìƒì„±
                        </button>
                    </div>
                    
                    <!-- Tistory ì„ íƒì‚­ì œ ì•¡ì…˜ ë°” -->
                    <div id="tistory-bulk-actions" class="bulk-actions">
                        <div class="bulk-info">
                            <div class="bulk-count" id="tistory-selected-count">0ê°œ ì„ íƒë¨</div>
                            <span>ì„ íƒëœ Tistory ì½˜í…ì¸ ë¥¼ ê´€ë¦¬í•˜ì„¸ìš”</span>
                        </div>
                        <div>
                            <button class="btn btn-light btn-sm me-2" onclick="deselectAll('tistory')">
                                <i class="bi bi-x"></i> ì„ íƒ í•´ì œ
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="bulkDelete('tistory')">
                                <i class="bi bi-trash"></i> ì„ íƒ ì‚­ì œ
                            </button>
                        </div>
                    </div>
                    <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                        <div id="tistory-files"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Topic Pool Status -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-light">
                        <h5 class="mb-0"><i class="bi bi-collection"></i> ì£¼ì œ í’€ ìƒíƒœ</h5>
                    </div>
                    <div class="card-body">
                        <div id="topic-stats" class="row"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ì „ì²´ ìŠ¤ì¼€ì¤„ ë³´ê¸° ëª¨ë‹¬ -->
    <div class="modal fade" id="scheduleOverviewModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="bi bi-calendar3"></i> ìë™ ë°œí–‰ ê³„íš ì „ì²´ë³´ê¸°
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="alert alert-info">
                                <h6><i class="bi bi-info-circle"></i> ìë™ ë°œí–‰ ì‹œìŠ¤í…œ</h6>
                                <ul class="mb-0">
                                    <li>ë§¤ì¼ ìƒˆë²½ 3ì‹œ ìë™ ì‹¤í–‰</li>
                                    <li>3ê°œ ì‚¬ì´íŠ¸ (unpre, untab, skewese) ë™ì‹œ ë°œí–‰</li>
                                    <li>ê³ í’ˆì§ˆ Pexels ì´ë¯¸ì§€ ìë™ ìƒì„±</li>
                                    <li>ì£¼ì œë³„ ë‹¤ì–‘í•œ ì½˜í…ì¸  ìë™ ìƒì„±</li>
                                </ul>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="auto-schedule-next bg-light p-3 rounded">
                                <h6><i class="bi bi-clock-history"></i> ë‹¤ìŒ ì‹¤í–‰ ì˜ˆì •</h6>
                                <div id="next-run-time" class="fw-bold text-primary">ê³„ì‚° ì¤‘...</div>
                                <small class="text-muted">ìë™ìœ¼ë¡œ ì½˜í…ì¸ ê°€ ìƒì„±ë©ë‹ˆë‹¤</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="schedule-overview-controls mb-3">
                        <div class="btn-group" role="group">
                            <button class="btn btn-outline-primary active" onclick="showScheduleWeek('current')">ì´ë²ˆ ì£¼</button>
                            <button class="btn btn-outline-primary" onclick="showScheduleWeek('next')">ë‹¤ìŒ ì£¼</button>
                        </div>
                    </div>
                    
                    <div id="schedule-overview-content">
                        <!-- ìŠ¤ì¼€ì¤„ ë‚´ìš©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loader -->
    <div id="loader">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <script>
        // ì°¨íŠ¸ ë³€ìˆ˜
        let dailyChart = null;
        let siteChart = null;

        // ì‹œê°„ ì—…ë°ì´íŠ¸
        function updateTime() {
            const now = new Date();
            document.getElementById('current-time').innerText = now.toLocaleString('ko-KR');
        }
        setInterval(updateTime, 1000);
        updateTime();

        // ë°ì´í„° ìƒˆë¡œê³ ì¹¨
        async function refreshData() {
            document.getElementById('loader').style.display = 'block';
            
            try {
                // í†µê³„ ë°ì´í„°
                const statsRes = await fetch('/api/stats');
                const stats = await statsRes.json();
                
                document.getElementById('total-posts').innerText = stats.total_posts;
                document.getElementById('today-posts').innerText = stats.today_posts;
                document.getElementById('total-views').innerText = (stats.revenue?.total_views || 0).toLocaleString();
                document.getElementById('total-revenue').innerText = 'â‚©' + ((stats.revenue?.total_revenue || 0) * 1400).toLocaleString();
                
                // ì£¼ì œ í’€ ìƒíƒœ ê°€ì ¸ì˜¤ê¸°
                const topicRes = await fetch('/api/topic_stats');
                const topicStats = await topicRes.json();
                updateTopicStats(topicStats);
                
                // ì‹œìŠ¤í…œ ìƒíƒœ
                const statusRes = await fetch('/api/system_status');
                const status = await statusRes.json();
                updateSystemStatus(status);
                
                // ìµœê·¼ í¬ìŠ¤íŠ¸
                const postsRes = await fetch('/api/recent_posts');
                const posts = await postsRes.json();
                updateRecentPosts(posts);
                
                // ë°œí–‰ ì¼ì •
                const scheduleRes = await fetch('/api/schedule');
                const schedule = await scheduleRes.json();
                updateSchedule(schedule);
                
                // WordPress íŒŒì¼
                const wordpressRes = await fetch('/api/wordpress_files');
                const wordpressFiles = await wordpressRes.json();
                updateWordPressFiles(wordpressFiles);
                
                // Tistory íŒŒì¼
                const tistoryRes = await fetch('/api/tistory_files');
                const tistoryFiles = await tistoryRes.json();
                updateTistoryFiles(tistoryFiles);
                
                // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
                await updateCharts();
                
            } catch (error) {
                console.error('Error refreshing data:', error);
            } finally {
                document.getElementById('loader').style.display = 'none';
            }
        }

        // ì‹œìŠ¤í…œ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateSystemStatus(status) {
            let html = '';
            
            try {
                // API ì‘ë‹µ êµ¬ì¡° í™•ì¸
                if (!status || typeof status !== 'object') {
                    console.warn('Invalid status object:', status);
                    status = {
                        sites: { unpre: {status: 'offline'}, untab: {status: 'offline'}, skewese: {status: 'offline'} },
                        database: {status: 'offline'},
                        api: { openai: {status: 'offline'}, claude: {status: 'offline'} }
                    };
                }
                
                // ì‚¬ì´íŠ¸ ìƒíƒœ
                if (status.sites && typeof status.sites === 'object') {
                    for (const [site, info] of Object.entries(status.sites)) {
                        const isOnline = info && info.status === 'online';
                        const statusClass = isOnline ? 'status-online' : 'status-offline';
                        const statusText = isOnline ? 'ì •ìƒ' : 'ì˜¤í”„ë¼ì¸';
                        html += `
                            <div class="col-md-3 mb-2">
                                <span class="status-indicator ${statusClass}"></span>
                                ${site}.co.kr <small class="text-muted">(${statusText})</small>
                            </div>
                        `;
                    }
                }
                
                // ë°ì´í„°ë² ì´ìŠ¤
                const dbStatus = status.database && status.database.status;
                const dbClass = dbStatus === 'online' ? 'status-online' : 'status-offline';
                const dbText = dbStatus === 'online' ? 'ì •ìƒ' : 'ì˜¤í”„ë¼ì¸';
                html += `
                    <div class="col-md-3 mb-2">
                        <span class="status-indicator ${dbClass}"></span>
                        Database <small class="text-muted">(${dbText})</small>
                    </div>
                `;
                
                // API ìƒíƒœ
                if (status.api && typeof status.api === 'object') {
                    for (const [api, info] of Object.entries(status.api)) {
                        const isOnline = info && info.status === 'online';
                        const statusClass = isOnline ? 'status-online' : 'status-offline';
                        const statusText = isOnline ? 'ì •ìƒ' : 'ì˜¤í”„ë¼ì¸';
                        html += `
                            <div class="col-md-3 mb-2">
                                <span class="status-indicator ${statusClass}"></span>
                                ${api.toUpperCase()} API <small class="text-muted">(${statusText})</small>
                            </div>
                        `;
                    }
                }
                
            } catch (error) {
                console.error('Error updating system status:', error);
                html = `
                    <div class="col-12">
                        <span class="status-indicator status-offline"></span>
                        ì‹œìŠ¤í…œ ìƒíƒœ ë¡œë”© ì‹¤íŒ¨
                    </div>
                `;
            }
            
            const statusElement = document.getElementById('system-status');
            if (statusElement) {
                statusElement.innerHTML = html;
            }
        }

        // ìµœê·¼ í¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        function updateRecentPosts(posts) {
            let html = '';
            
            posts.forEach(post => {
                const siteClass = `site-${post.site}`;
                const date = new Date(post.published_date).toLocaleDateString('ko-KR');
                
                html += `
                    <div class="log-entry">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <span class="site-badge ${siteClass}">${post.site}</span>
                                <strong>${post.title}</strong>
                                <div class="text-muted small mt-1">
                                    <i class="bi bi-calendar"></i> ${date}
                                    <span class="ms-2"><i class="bi bi-folder"></i> ${post.category}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('recent-posts').innerHTML = html || '<p class="text-muted">í¬ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
        }

        // ë°œí–‰ ì¼ì • ì—…ë°ì´íŠ¸
        function updateSchedule(schedule) {
            let html = '';
            
            schedule.forEach(item => {
                const siteClass = `site-${item.site}`;
                const daysKor = item.days.map(d => {
                    const dayMap = {mon: 'ì›”', tue: 'í™”', wed: 'ìˆ˜', thu: 'ëª©', fri: 'ê¸ˆ', sat: 'í† ', sun: 'ì¼'};
                    return dayMap[d] || d;
                }).join(', ');
                
                html += `
                    <div class="schedule-item">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <span class="site-badge ${siteClass}">${item.site}</span>
                                <strong class="ms-2">${item.time}</strong>
                            </div>
                            <span class="text-muted">${daysKor}</span>
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('schedule').innerHTML = html;
        }

        // WordPress íŒŒì¼ ì—…ë°ì´íŠ¸
        function updateWordPressFiles(files) {
            // ì„ì‹œ ì½˜í…ì¸  ì œê±°
            const tempContent = document.getElementById('temp-content');
            if (tempContent) {
                tempContent.remove();
            }
            
            let html = '';
            
            files.forEach(file => {
                // ë‚ ì§œì™€ ì‹œê°„ì„ ìƒì„¸í•˜ê²Œ í‘œì‹œ (2025. 8. 10. 14:22 í˜•ì‹)
                let dateTimeString = '';
                if (file.created_at) {
                    const dateObj = new Date(file.created_at);
                    const year = dateObj.getFullYear();
                    const month = dateObj.getMonth() + 1;
                    const day = dateObj.getDate();
                    const hours = String(dateObj.getHours()).padStart(2, '0');
                    const minutes = String(dateObj.getMinutes()).padStart(2, '0');
                    dateTimeString = `${year}. ${month}. ${day}. ${hours}:${minutes}`;
                }
                
                const site = file.site || 'unknown';
                const siteClass = `site-${site}`;
                
                // ì œëª© ì •ë¦¬ (JSX ì½”ë“œë‚˜ ì´ìƒí•œ ë‚´ìš© í•„í„°ë§)
                let cleanTitle = file.title || 'ì œëª© ì—†ìŒ';
                
                // JSXë‚˜ íŠ¹ìˆ˜ ë¬¸ìê°€ í¬í•¨ëœ ì œëª© ì²˜ë¦¬
                if (cleanTitle.includes('jsx') || cleanTitle.includes('const') || cleanTitle.includes('element') || cleanTitle.includes('<') || cleanTitle.includes('{')) {
                    cleanTitle = 'ì˜¬ë°”ë¥´ì§€ ì•Šì€ ì½˜í…ì¸ ';
                }
                
                // ì œëª© ê¸¸ì´ ì œí•œ (ìµœëŒ€ 50ì)
                if (cleanTitle.length > 50) {
                    cleanTitle = cleanTitle.substring(0, 50) + '...';
                }
                
                // í‚¤ì›Œë“œ/íƒœê·¸ ì²˜ë¦¬ (WordPress)
                let keywords = [];
                if (file.tags && Array.isArray(file.tags)) {
                    keywords = file.tags;
                } else if (file.metadata && file.metadata.keywords) {
                    keywords = file.metadata.keywords;
                } else if (file.metadata && file.metadata.tags) {
                    keywords = file.metadata.tags;
                }
                
                const keywordTags = keywords.slice(0, 5).map(keyword => 
                    `<span class="badge bg-primary me-1">${keyword}</span>`
                ).join('');
                
                // ì¹´í…Œê³ ë¦¬ ì²˜ë¦¬ (categories ë°°ì—´ì—ì„œ ì²« ë²ˆì§¸ í•­ëª© ì‚¬ìš©)
                let category = 'ì¹´í…Œê³ ë¦¬ ì—†ìŒ';
                if (file.categories && Array.isArray(file.categories) && file.categories.length > 0) {
                    category = file.categories[0];
                } else if (file.category) {
                    category = file.category;
                }
                
                html += `
                    <div class="wordpress-file content-item mb-3 p-2 border rounded" data-file-id="${file.id}">
                        <div class="d-flex justify-content-between align-items-start">
                            <div class="d-flex align-items-start flex-grow-1">
                                <input type="checkbox" class="form-check-input content-checkbox me-2" 
                                       onchange="toggleItemSelection('wordpress', ${file.id})" data-file-id="${file.id}"
                                       style="display: inline-block !important; visibility: visible !important; opacity: 1 !important; width: 16px !important; height: 16px !important; transform: scale(1.2);">
                                <div class="flex-grow-1">
                                    <div class="d-flex align-items-center mb-1">
                                        <span class="site-badge ${siteClass}">${site.toUpperCase()}</span>
                                        <span class="badge bg-secondary ms-2">${category}</span>
                                    </div>
                                    <strong>${cleanTitle}</strong>
                                    ${keywordTags ? `<div class="mt-2">${keywordTags}</div>` : ''}
                                    <div class="text-muted small mt-1">
                                        <i class="bi bi-calendar"></i> ${dateTimeString}
                                        ${file.word_count ? `<span class="ms-3"><i class="bi bi-file-text"></i> ${file.word_count.toLocaleString()}ì</span>` : ''}
                                    </div>
                                </div>
                            </div>
                            <div class="btn-group-vertical btn-group-sm">
                                <a href="/api/download_file/${encodeURIComponent(file.file_path)}" class="btn btn-outline-primary btn-sm" title="ë‹¤ìš´ë¡œë“œ">
                                    <i class="bi bi-download"></i> ë‹¤ìš´ë¡œë“œ
                                </a>
                                <button class="btn btn-outline-success btn-sm" onclick="publishToWordPress(${file.id}, '${site}')" title="WordPressì— ë°œí–‰">
                                    <i class="bi bi-upload"></i> ë°œí–‰
                                </button>
                                <button class="btn btn-outline-danger btn-sm" onclick="deleteFile('${file.id}', 'wordpress')" title="íŒŒì¼ ì‚­ì œ">
                                    <i class="bi bi-trash"></i> ì‚­ì œ
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('wordpress-files').innerHTML = html || '<p class="text-muted">ìƒì„±ëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
        }

        // Tistory íŒŒì¼ ì—…ë°ì´íŠ¸
        function updateTistoryFiles(files) {
            let html = '';
            
            files.forEach(file => {
                // ë‚ ì§œì™€ ì‹œê°„ì„ ìƒì„¸í•˜ê²Œ í‘œì‹œ (2025. 8. 10. 14:22 í˜•ì‹)
                let dateTimeString = '';
                if (file.created_at) {
                    const dateObj = new Date(file.created_at);
                    const year = dateObj.getFullYear();
                    const month = dateObj.getMonth() + 1;
                    const day = dateObj.getDate();
                    const hours = String(dateObj.getHours()).padStart(2, '0');
                    const minutes = String(dateObj.getMinutes()).padStart(2, '0');
                    dateTimeString = `${year}. ${month}. ${day}. ${hours}:${minutes}`;
                }
                const tags = (file.tags || []).map(tag => `<span class="badge bg-secondary">${tag}</span>`).join(' ');
                
                html += `
                    <div class="tistory-file content-item mb-3 p-2 border rounded" data-file-id="${file.id}">
                        <div class="d-flex justify-content-between align-items-start">
                            <div class="d-flex align-items-start flex-grow-1">
                                <input type="checkbox" class="form-check-input content-checkbox me-2" 
                                       onchange="toggleItemSelection('tistory', ${file.id})" data-file-id="${file.id}"
                                       style="display: inline-block !important; visibility: visible !important; opacity: 1 !important; width: 16px !important; height: 16px !important; transform: scale(1.2);">
                                <div class="flex-grow-1">
                                    <strong>${file.title}</strong>
                                    <div class="mt-1">${tags}</div>
                                    <div class="text-muted small mt-1">
                                        <i class="bi bi-calendar"></i> ${dateTimeString}
                                        ${file.word_count ? `<span class="ms-3"><i class="bi bi-file-text"></i> ${file.word_count.toLocaleString()}ì</span>` : ''}
                                    </div>
                                </div>
                            </div>
                            <div class="btn-group-vertical btn-group-sm">
                                <a href="/api/download_file/${encodeURIComponent(file.file_path)}" class="btn btn-outline-primary btn-sm">
                                    <i class="bi bi-download"></i> ë‹¤ìš´ë¡œë“œ
                                </a>
                                <button class="btn btn-outline-danger btn-sm" onclick="deleteFile('${file.id}')">
                                    <i class="bi bi-trash"></i> ì‚­ì œ
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('tistory-files').innerHTML = html || '<p class="text-muted">ìƒì„±ëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
        }

        // ì£¼ì œ í’€ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateTopicStats(topicStats) {
            let html = '';
            
            for (const [site, stats] of Object.entries(topicStats)) {
                const total = stats.used + stats.unused;
                const percentage = total > 0 ? Math.round((stats.used / total) * 100) : 0;
                
                html += `
                    <div class="col-md-4 mb-3">
                        <h6>${site}</h6>
                        <div class="progress" style="height: 25px;">
                            <div class="progress-bar bg-success" style="width: ${percentage}%">
                                ì‚¬ìš©: ${stats.used}
                            </div>
                            <div class="progress-bar bg-info" style="width: ${100-percentage}%">
                                ë¯¸ì‚¬ìš©: ${stats.unused}
                            </div>
                        </div>
                    </div>
                `;
            }
            
            document.getElementById('topic-stats').innerHTML = html;
        }

        // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        async function updateCharts() {
            // ì¼ë³„ ì°¨íŠ¸
            const dailyRes = await fetch('/api/chart/daily');
            const dailyData = await dailyRes.json();
            
            const ctx1 = document.getElementById('dailyChart').getContext('2d');
            if (dailyChart) dailyChart.destroy();
            
            dailyChart = new Chart(ctx1, {
                type: 'line',
                data: {
                    labels: dailyData.labels,
                    datasets: [{
                        label: 'ë°œí–‰ í¬ìŠ¤íŠ¸',
                        data: dailyData.data,
                        borderColor: 'rgb(102, 126, 234)',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
            
            // ì‚¬ì´íŠ¸ë³„ ì°¨íŠ¸
            const siteRes = await fetch('/api/chart/site');
            const siteData = await siteRes.json();
            
            const ctx2 = document.getElementById('siteChart').getContext('2d');
            if (siteChart) siteChart.destroy();
            
            siteChart = new Chart(ctx2, {
                type: 'doughnut',
                data: {
                    labels: siteData.labels,
                    datasets: [{
                        data: siteData.data,
                        backgroundColor: [
                            'rgba(102, 126, 234, 0.8)',
                            'rgba(72, 199, 116, 0.8)',
                            'rgba(255, 183, 77, 0.8)',
                            'rgba(255, 107, 107, 0.8)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        // WordPress ì½˜í…ì¸  ìƒì„±
        async function generateWordPressContent() {
            // ëª¨ë‹¬ì—ì„œ ì…ë ¥ê°’ ê°€ì ¸ì˜¤ê¸°
            const site = selectedWpSite;
            const topic = document.getElementById('wpContentTopic').value.trim();
            const keywordsInput = document.getElementById('wpContentKeywords').value.trim();
            const contentLength = document.getElementById('wpContentLength').value;
            let category = document.getElementById('wpContentCategory').value;
            
            if (!topic) {
                showNotification('ì£¼ì œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            // ì§ì ‘ì…ë ¥ ì¹´í…Œê³ ë¦¬ ì²˜ë¦¬
            if (category === 'ì§ì ‘ì…ë ¥') {
                const customCategory = document.getElementById('wpCustomCategory').value.trim();
                if (!customCategory) {
                    showNotification('ì§ì ‘ì…ë ¥ ì¹´í…Œê³ ë¦¬ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                    return;
                }
                category = customCategory;
            }
            
            // í‚¤ì›Œë“œ ì²˜ë¦¬ (ì½¤ë§ˆë¡œ ë¶„ë¦¬)
            const keywords = keywordsInput ? 
                keywordsInput.split(',').map(k => k.trim()).filter(k => k.length > 0) : 
                getDefaultKeywordsByCategory(category);
            
            // ëª¨ë‹¬ ë‹«ê¸°
            const modal = bootstrap.Modal.getInstance(document.getElementById('wordpressModal'));
            modal.hide();
            
            // ì§„í–‰ ìƒí™© ìƒì„¸ í‘œì‹œ
            showNotification(`ğŸš€ ${site.toUpperCase()} ì½˜í…ì¸  ìƒì„± ì‹œì‘...`, 'info');
            showProgressSteps([
                'âœ¨ AIê°€ ì½˜í…ì¸ ë¥¼ ì‘ì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...',
                'ğŸ” SEO ìµœì í™” ì§„í–‰ ì¤‘...',
                'ğŸ“ íŒŒì¼ ì €ì¥ ì¤‘...',
                'ğŸ’¾ ë°ì´í„°ë² ì´ìŠ¤ ë“±ë¡ ì¤‘...'
            ]);
            
            try {
                const res = await fetch('/api/generate_wordpress', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        site: site, 
                        topic: topic,
                        keywords: keywords,
                        category: category,
                        content_length: contentLength
                    })
                });
                
                const result = await res.json();
                hideProgressSteps();
                
                if (result.success) {
                    showNotification(`âœ… ${site.toUpperCase()} ì½˜í…ì¸  ìƒì„± ì™„ë£Œ! ëª©ë¡ì„ ì—…ë°ì´íŠ¸í•˜ê³  ìˆìŠµë‹ˆë‹¤...`, 'success');
                    
                    // ì—…ë°ì´íŠ¸ ì¤‘ í‘œì‹œ (ìƒˆë¡œìš´ ë””ìì¸)
                    const wpFilesContainer = document.getElementById('wordpress-files');
                    wpFilesContainer.insertAdjacentHTML('afterbegin', 
                        `<div id="updating-indicator" class="update-indicator">
                            <div class="spinner"></div>
                            ëª©ë¡ì„ ì—…ë°ì´íŠ¸í•˜ê³  ìˆìŠµë‹ˆë‹¤...
                            <small style="display: block; margin-top: 5px; opacity: 0.8;">
                                ìƒˆë¡œ ìƒì„±ëœ ì½˜í…ì¸ ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ (ìµœëŒ€ 5ì´ˆ)
                            </small>
                        </div>`
                    );
                    
                    // ì¦‰ì‹œ ëª©ë¡ì— ìƒˆ ì½˜í…ì¸  í‘œì‹œ (ì„ì‹œ)
                    addTemporaryContent('wordpress', {
                        title: result.title || topic,
                        site: site,
                        category: category,
                        keywords: keywords.slice(0, 3),
                        created_at: new Date().toISOString(),
                        isNew: true
                    });
                    
                    // ì—¬ëŸ¬ ë²ˆ ì‹œë„í•´ì„œ ëª©ë¡ ê°±ì‹  ë³´ì¥
                    let retryCount = 0;
                    const maxRetries = 5;
                    
                    const updateList = async () => {
                        try {
                            const wordpressRes = await fetch('/api/wordpress_files');
                            const wordpressFiles = await wordpressRes.json();
                            
                            // ìƒˆë¡œ ìƒì„±ëœ ì½˜í…ì¸ ê°€ ëª©ë¡ì— ìˆëŠ”ì§€ í™•ì¸
                            const hasNewContent = wordpressFiles.some(f => 
                                f.title.includes(result.title.substring(0, 10)) || 
                                new Date(f.created_at).getTime() > Date.now() - 60000 // 1ë¶„ ì´ë‚´ ìƒì„±
                            );
                            
                            updateWordPressFiles(wordpressFiles);
                            
                            if (hasNewContent || retryCount >= maxRetries) {
                                // ì—…ë°ì´íŠ¸ ì¤‘ ì¸ë””ì¼€ì´í„° ì œê±°
                                const indicator = document.getElementById('updating-indicator');
                                if (indicator) indicator.remove();
                                
                                showNotification(`ğŸ‰ ëª©ë¡ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤! ìƒˆ ì½˜í…ì¸ ë¥¼ í™•ì¸í•˜ì„¸ìš”.`, 'info');
                                // ì „ì²´ ë°ì´í„°ë„ ê°±ì‹ 
                                refreshData();
                            } else {
                                retryCount++;
                                setTimeout(updateList, 1000); // 1ì´ˆ í›„ ì¬ì‹œë„
                            }
                        } catch (error) {
                            if (retryCount < maxRetries) {
                                retryCount++;
                                setTimeout(updateList, 1000);
                            } else {
                                // ì—…ë°ì´íŠ¸ ì¤‘ ì¸ë””ì¼€ì´í„° ì œê±°
                                const indicator = document.getElementById('updating-indicator');
                                if (indicator) indicator.remove();
                                
                                showNotification('ëª©ë¡ ê°±ì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.', 'error');
                            }
                        }
                    };
                    
                    // ì¦‰ì‹œ ì²« ë²ˆì§¸ ê°±ì‹  ì‹œë„
                    setTimeout(updateList, 500);
                    
                    // í¼ ë¦¬ì…‹
                    document.getElementById('wordpressForm').reset();
                } else {
                    showNotification(`âŒ ìƒì„± ì‹¤íŒ¨: ${result.error}`, 'error');
                }
            } catch (error) {
                hideProgressSteps();
                showNotification(`âŒ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }
        
        // ì¹´í…Œê³ ë¦¬ë³„ ê¸°ë³¸ í‚¤ì›Œë“œ ë°˜í™˜
        function getDefaultKeywordsByCategory(category) {
            const defaultKeywords = {
                'í”„ë¡œê·¸ë˜ë°': ['í”„ë¡œê·¸ë˜ë°', 'ì½”ë”©', 'ê°œë°œ', 'ì•Œê³ ë¦¬ì¦˜', 'ìë£Œêµ¬ì¡°'],
                'ì›¹ê°œë°œ': ['ì›¹ê°œë°œ', 'HTML', 'CSS', 'JavaScript', 'í”„ë¡ íŠ¸ì—”ë“œ'],
                'ë°ì´í„°ì‚¬ì´ì–¸ìŠ¤': ['ë°ì´í„°ë¶„ì„', 'Python', 'ë¨¸ì‹ ëŸ¬ë‹', 'í†µê³„', 'ë¹…ë°ì´í„°'],
                'AI/ML': ['ì¸ê³µì§€ëŠ¥', 'ë¨¸ì‹ ëŸ¬ë‹', 'ë”¥ëŸ¬ë‹', 'AI', 'ì‹ ê²½ë§'],
                'DevOps': ['DevOps', 'ë°°í¬', 'CI/CD', 'Docker', 'Kubernetes'],
                'ëª¨ë°”ì¼ê°œë°œ': ['ëª¨ë°”ì¼', 'ì•±ê°œë°œ', 'React Native', 'Flutter', 'iOS'],
                'ê²Œì„ê°œë°œ': ['ê²Œì„ê°œë°œ', 'Unity', 'ê²Œì„ì—”ì§„', '3D', 'ê²Œì„ë””ìì¸'],
                'ê¸°íƒ€': ['ê°œë°œ', 'í”„ë¡œê·¸ë˜ë°', 'ê¸°ìˆ ', 'IT', 'ì†Œí”„íŠ¸ì›¨ì–´']
            };
            return defaultKeywords[category] || defaultKeywords['ê¸°íƒ€'];
        }

        // WordPress ë°œí–‰
        async function publishToWordPress(fileId, site) {
            if (!confirm(`${site}ì— ì´ ì½˜í…ì¸ ë¥¼ ë°œí–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            
            showNotification('ë°œí–‰ ì¤‘...', 'info');
            
            try {
                const res = await fetch('/api/publish_to_wordpress', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({file_id: fileId, site: site})
                });
                
                const result = await res.json();
                
                if (result.success) {
                    showNotification('ë°œí–‰ ì™„ë£Œ!', 'success');
                    refreshData();
                } else {
                    showNotification(`ë°œí–‰ ì‹¤íŒ¨: ${result.error}`, 'error');
                }
            } catch (error) {
                showNotification(`ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        // íŒŒì¼ ì‚­ì œ
        async function deleteFile(fileId) {
            if (!confirm('ì´ íŒŒì¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            console.log('Deleting file with ID:', fileId);
            showNotification('íŒŒì¼ ì‚­ì œ ì¤‘...', 'info');
            
            try {
                const response = await fetch('/api/delete_file', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({file_id: fileId})
                });
                
                console.log('Delete response status:', response.status);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('Delete failed with status:', response.status, 'Error:', errorText);
                    showNotification(`ì‚­ì œ ì‹¤íŒ¨ (${response.status}): ${errorText}`, 'error');
                    return;
                }
                
                const result = await response.json();
                console.log('Delete result:', result);
                
                if (result.success) {
                    showNotification('íŒŒì¼ì´ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    await refreshData(); // ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ëŒ€ê¸°
                } else {
                    showNotification(`ì‚­ì œ ì‹¤íŒ¨: ${result.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`, 'error');
                }
            } catch (error) {
                console.error('Delete error:', error);
                showNotification(`ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        // Tistory ì½˜í…ì¸  ìƒì„±
        async function generateTistoryContent() {
            // ëª¨ë‹¬ì—ì„œ ì…ë ¥ê°’ ê°€ì ¸ì˜¤ê¸°
            const topic = document.getElementById('contentTopic').value.trim();
            const keywordsInput = document.getElementById('contentKeywords').value.trim();
            const contentLength = document.getElementById('contentLength').value;
            const category = document.getElementById('contentCategory').value;
            
            if (!topic) {
                showNotification('ì£¼ì œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            // í‚¤ì›Œë“œ ì²˜ë¦¬ (ì½¤ë§ˆë¡œ ë¶„ë¦¬)
            const keywords = keywordsInput ? 
                keywordsInput.split(',').map(k => k.trim()).filter(k => k.length > 0) : 
                ['í† ìµ', 'ì˜ì–´í•™ìŠµ', 'ì–´í•™ì‹œí—˜', 'ê³ ë“ì ', 'í•™ìŠµë²•'];
            
            // ëª¨ë‹¬ ë‹«ê¸°
            const modal = bootstrap.Modal.getInstance(document.getElementById('tistoryModal'));
            modal.hide();
            
            // Tistory ì§„í–‰ ìƒí™© í‘œì‹œ
            showNotification('ğŸš€ Tistory ì½˜í…ì¸  ìƒì„± ì‹œì‘...', 'info');
            showProgressSteps([
                'âœ¨ AIê°€ Tistory ì½˜í…ì¸ ë¥¼ ì‘ì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...',
                'ğŸ¨ HTML í˜•ì‹ìœ¼ë¡œ ë³€í™˜ ì¤‘...',
                'ğŸ“ íŒŒì¼ ì €ì¥ ì¤‘...',
                'ğŸ’¾ ë°ì´í„°ë² ì´ìŠ¤ ë“±ë¡ ì¤‘...'
            ]);
            
            try {
                const res = await fetch('/api/generate_tistory', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        topic: topic,
                        keywords: keywords,
                        category: category,
                        content_length: contentLength
                    })
                });
                
                const result = await res.json();
                hideProgressSteps();
                
                if (result.success) {
                    showNotification(`âœ… Tistory ì½˜í…ì¸  ìƒì„± ì™„ë£Œ!`, 'success');
                    
                    // ì¦‰ì‹œ ëª©ë¡ì— ìƒˆ ì½˜í…ì¸  í‘œì‹œ (ì„ì‹œ)
                    addTemporaryContent('tistory', {
                        title: result.title || topic,
                        category: category,
                        keywords: keywords.slice(0, 3),
                        created_at: new Date().toISOString(),
                        isNew: true
                    });
                    
                    // 3ì´ˆ í›„ ì‹¤ì œ ë°ì´í„°ë¡œ ìƒˆë¡œê³ ì¹¨
                    setTimeout(() => {
                        refreshData();
                    }, 3000);
                    
                    // í¼ ë¦¬ì…‹
                    document.getElementById('tistoryForm').reset();
                } else {
                    if (result.error && result.error.includes('API key')) {
                        showNotification(`âŒ Claude API í‚¤ ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤!\n\n1. https://console.anthropic.com ì—ì„œ API í‚¤ ë°œê¸‰\n2. .env íŒŒì¼ì˜ ANTHROPIC_API_KEY ì„¤ì •\n3. ì„œë²„ ì¬ì‹œì‘\n\nì˜¤ë¥˜: ${result.error}`, 'error');
                    } else {
                        showNotification(`âŒ ìƒì„± ì‹¤íŒ¨: ${result.error}`, 'error');
                    }
                }
            } catch (error) {
                hideProgressSteps();
                showNotification(`âŒ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        // ì•Œë¦¼ í‘œì‹œ
        function showNotification(message, type = 'info') {
            // ê¸°ì¡´ ì•Œë¦¼ ì œê±°
            const existing = document.querySelector('.notification-toast');
            if (existing) existing.remove();
            
            const colors = {
                success: '#28a745',
                error: '#dc3545', 
                info: '#17a2b8',
                warning: '#ffc107'
            };
            
            const toast = document.createElement('div');
            toast.className = 'notification-toast';
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${colors[type] || colors.info};
                color: white;
                padding: 15px 20px;
                border-radius: 5px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                z-index: 9999;
                max-width: 300px;
                font-weight: 500;
                animation: slideIn 0.3s ease-out;
            `;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            // 3ì´ˆ í›„ ìë™ ì œê±°
            setTimeout(() => {
                toast.style.animation = 'slideOut 0.3s ease-in forwards';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // ì¡°ìš©í•œ ìƒˆë¡œê³ ì¹¨ (ë¡œë”© ìŠ¤í”¼ë„ˆ ì—†ì´)
        async function refreshDataQuietly() {
            try {
                // í†µê³„ ë°ì´í„°
                const statsRes = await fetch('/api/stats');
                const stats = await statsRes.json();
                
                document.getElementById('total-posts').innerText = stats.total_posts;
                document.getElementById('today-posts').innerText = stats.today_posts;
                document.getElementById('total-views').innerText = (stats.revenue?.total_views || 0).toLocaleString();
                document.getElementById('total-revenue').innerText = 'â‚©' + ((stats.revenue?.total_revenue || 0) * 1400).toLocaleString();
                
                // WordPress íŒŒì¼ (ê°€ì¥ ì¤‘ìš”í•œ ë°ì´í„°ë§Œ)
                const wordpressRes = await fetch('/api/wordpress_files');
                const wordpressFiles = await wordpressRes.json();
                updateWordPressFiles(wordpressFiles);
                
                // Tistory íŒŒì¼
                const tistoryRes = await fetch('/api/tistory_files');
                const tistoryFiles = await tistoryRes.json();
                updateTistoryFiles(tistoryFiles);
                
            } catch (error) {
                console.log('ì¡°ìš©í•œ ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨:', error);
            }
        }

        // ì´ˆê¸° ë¡œë“œ
        refreshData();
        
        // 2ë¶„ë§ˆë‹¤ ìë™ ìƒˆë¡œê³ ì¹¨ (ì¡°ìš©í•œ ì—…ë°ì´íŠ¸)
        setInterval(() => {
            refreshDataQuietly();
        }, 120000);
    </script>

    <!-- Tistory ì½˜í…ì¸  ìƒì„± ëª¨ë‹¬ -->
    <div class="modal fade" id="tistoryModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-file-earmark-text"></i> Tistory ì½˜í…ì¸  ìƒì„±</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="tistoryForm">
                        <div class="mb-3">
                            <label for="contentTopic" class="form-label">ì½˜í…ì¸  ì£¼ì œ *</label>
                            <input type="text" class="form-control" id="contentTopic" 
                                   placeholder="ì˜ˆ: í† ìµ 900ì  ë‹¬ì„± ì „ëµ" required>
                            <div class="form-text">ìƒì„±í•  ì½˜í…ì¸ ì˜ ì£¼ìš” ì£¼ì œë¥¼ ì…ë ¥í•˜ì„¸ìš”</div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="contentKeywords" class="form-label">í•„ìˆ˜ í‚¤ì›Œë“œ</label>
                            <input type="text" class="form-control" id="contentKeywords" 
                                   placeholder="ì˜ˆ: í† ìµ, ì˜ì–´í•™ìŠµ, ê³ ë“ì , ì‹œí—˜ì¤€ë¹„">
                            <div class="form-text">ì½¤ë§ˆ(,)ë¡œ êµ¬ë¶„í•˜ì—¬ ì…ë ¥ (ìµœëŒ€ 10ê°œ)</div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="contentLength" class="form-label">ì½˜í…ì¸  ê¸¸ì´</label>
                            <select class="form-select" id="contentLength">
                                <option value="short">ì§§ìŒ (1,500-2,000ì)</option>
                                <option value="medium" selected>ë³´í†µ (2,500-3,500ì)</option>
                                <option value="long">ê¸¸ê²Œ (4,000-5,500ì)</option>
                                <option value="very_long">ë§¤ìš° ê¸¸ê²Œ (6,000-8,000ì)</option>
                            </select>
                            <div class="form-text">ì½˜í…ì¸ ì˜ ê¸¸ì´ë¥¼ ì„ íƒí•˜ì„¸ìš”</div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="contentCategory" class="form-label">ì¹´í…Œê³ ë¦¬</label>
                            <select class="form-select" id="contentCategory">
                                <option value="ì–¸ì–´í•™ìŠµ">ì–¸ì–´í•™ìŠµ</option>
                                <option value="ìê²©ì¦">ìê²©ì¦</option>
                                <option value="ì·¨ì—…">ì·¨ì—…</option>
                                <option value="ì—¬í–‰">ì—¬í–‰</option>
                                <option value="ë¼ì´í”„ìŠ¤íƒ€ì¼">ë¼ì´í”„ìŠ¤íƒ€ì¼</option>
                                <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
                    <button type="button" class="btn btn-primary" onclick="generateTistoryContent()">
                        <i class="bi bi-magic"></i> ì½˜í…ì¸  ìƒì„±
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- WordPress ì½˜í…ì¸  ìƒì„± ëª¨ë‹¬ -->
    <div class="modal fade" id="wordpressModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-wordpress"></i> <span id="wpSiteName">WordPress</span> ì½˜í…ì¸  ìƒì„±</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="wordpressForm">
                        <div class="mb-3">
                            <label for="wpSite" class="form-label">ì‚¬ì´íŠ¸ ì„ íƒ</label>
                            <input type="text" class="form-control" id="wpSite" readonly>
                        </div>
                        
                        <div class="mb-3">
                            <label for="wpContentTopic" class="form-label">ì½˜í…ì¸  ì£¼ì œ *</label>
                            <input type="text" class="form-control" id="wpContentTopic" 
                                   placeholder="ì˜ˆ: React í”„ë¡œê·¸ë˜ë° ì™„ì „ì •ë³µ" required>
                            <div class="form-text">ìƒì„±í•  ì½˜í…ì¸ ì˜ ì£¼ìš” ì£¼ì œë¥¼ ì…ë ¥í•˜ì„¸ìš”</div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="wpContentKeywords" class="form-label">í•„ìˆ˜ í‚¤ì›Œë“œ</label>
                            <input type="text" class="form-control" id="wpContentKeywords" 
                                   placeholder="ì˜ˆ: React, JavaScript, í”„ë¡ íŠ¸ì—”ë“œ, ì›¹ê°œë°œ">
                            <div class="form-text">ì½¤ë§ˆ(,)ë¡œ êµ¬ë¶„í•˜ì—¬ ì…ë ¥ (ìµœëŒ€ 10ê°œ)</div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="wpContentLength" class="form-label">ì½˜í…ì¸  ê¸¸ì´</label>
                            <select class="form-select" id="wpContentLength">
                                <option value="short">ì§§ìŒ (1,500-2,000ì)</option>
                                <option value="medium" selected>ë³´í†µ (2,500-3,500ì)</option>
                                <option value="long">ê¸¸ê²Œ (4,000-5,500ì)</option>
                                <option value="very_long">ë§¤ìš° ê¸¸ê²Œ (6,000-8,000ì)</option>
                            </select>
                            <div class="form-text">ì½˜í…ì¸ ì˜ ê¸¸ì´ë¥¼ ì„ íƒí•˜ì„¸ìš”</div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="wpContentCategory" class="form-label">ì¹´í…Œê³ ë¦¬</label>
                            <select class="form-select" id="wpContentCategory" onchange="toggleCustomCategory()">
                                <!-- ì‚¬ì´íŠ¸ë³„ ì¹´í…Œê³ ë¦¬ê°€ JavaScriptë¡œ ë™ì  ìƒì„±ë©ë‹ˆë‹¤ -->
                            </select>
                        </div>
                        
                        <div class="mb-3" id="customCategoryDiv" style="display: none;">
                            <label for="wpCustomCategory" class="form-label">ì§ì ‘ ì…ë ¥ ì¹´í…Œê³ ë¦¬</label>
                            <input type="text" class="form-control" id="wpCustomCategory" 
                                   placeholder="ì¹´í…Œê³ ë¦¬ë¥¼ ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”">
                            <div class="form-text">ì§ì ‘ ì¹´í…Œê³ ë¦¬ë¥¼ ì…ë ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
                    <button type="button" class="btn btn-success" onclick="generateWordPressContent()">
                        <i class="bi bi-magic"></i> ì½˜í…ì¸  ìƒì„±
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // WordPress ëª¨ë‹¬ í‘œì‹œ
        let selectedWpSite = '';
        
        // ì‚¬ì´íŠ¸ë³„ ì¹´í…Œê³ ë¦¬ ì •ì˜
        const siteCategories = {
            'unpre': [
                'ê°œë°œ', 'IT', 'í”„ë¡œê·¸ë˜ë°', 'JavaScript', 'Python', 'React', 'Node.js',
                'ë°ì´í„°ë² ì´ìŠ¤', 'ì›¹ê°œë°œ', 'DevOps', 'AI/ML', 'ì •ë³´ì²˜ë¦¬ê¸°ì‚¬', 'ì–¸ì–´í•™ìŠµ',
                'í† ìµ', 'JLPT', 'ì˜ì–´íšŒí™”', 'ì§ì ‘ì…ë ¥'
            ],
            'untab': [
                'ë¶€ë™ì‚°', 'ê²½ë§¤', 'ê³µë§¤', 'ì •ì±…/ì œë„', 'íˆ¬ìì „ëµ', 'ì‹œì¥ë¶„ì„',
                'ê¶Œë¦¬ë¶„ì„', 'ì„ëŒ€ìˆ˜ìµ', 'ì¬ê°œë°œ', 'ì¬ê±´ì¶•', 'ë²•ë¥ ì •ë³´', 'ì„¸ê¸ˆ',
                'ëŒ€ì¶œ', 'íˆ¬ìë¦¬ìŠ¤í¬', 'ì§ì ‘ì…ë ¥'
            ],
            'skewese': [
                'ì„¸ê³„ì‚¬', 'í•œêµ­ì‚¬', 'ê³ ëŒ€ì‚¬', 'ê·¼í˜„ëŒ€ì‚¬', 'ì—­ì‚¬ì¸ë¬¼', 'ë¬¸í™”ì‚¬',
                'ì „ìŸì‚¬', 'ì •ì¹˜ì‚¬', 'ì‚¬íšŒì‚¬', 'ë¬¸í™”ì¬', 'ë°•ë¬¼ê´€', 'ì—­ì‚¬ì—¬í–‰',
                'ì—­ì‚¬ë“œë¼ë§ˆ', 'ë¬¸í™”ìœ ì‚°', 'ì§ì ‘ì…ë ¥'
            ]
        };
        
        function showWordPressModal(site) {
            selectedWpSite = site;
            document.getElementById('wpSite').value = site;
            document.getElementById('wpSiteName').textContent = site.toUpperCase();
            
            // ì‚¬ì´íŠ¸ë³„ ì¹´í…Œê³ ë¦¬ ì—…ë°ì´íŠ¸
            updateCategoriesForSite(site);
            
            // ì»¤ìŠ¤í…€ ì¹´í…Œê³ ë¦¬ ì…ë ¥ì°½ ìˆ¨ê¸°ê¸°
            document.getElementById('customCategoryDiv').style.display = 'none';
            document.getElementById('wpCustomCategory').value = '';
            
            const modal = new bootstrap.Modal(document.getElementById('wordpressModal'));
            modal.show();
        }
        
        function updateCategoriesForSite(site) {
            const categorySelect = document.getElementById('wpContentCategory');
            const categories = siteCategories[site] || ['ê¸°íƒ€', 'ì§ì ‘ì…ë ¥'];
            
            // ê¸°ì¡´ ì˜µì…˜ ì œê±°
            categorySelect.innerHTML = '';
            
            // ì‚¬ì´íŠ¸ë³„ ì¹´í…Œê³ ë¦¬ ì¶”ê°€
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categorySelect.appendChild(option);
            });
        }
        
        function toggleCustomCategory() {
            const categorySelect = document.getElementById('wpContentCategory');
            const customDiv = document.getElementById('customCategoryDiv');
            
            if (categorySelect.value === 'ì§ì ‘ì…ë ¥') {
                customDiv.style.display = 'block';
                document.getElementById('wpCustomCategory').focus();
            } else {
                customDiv.style.display = 'none';
                document.getElementById('wpCustomCategory').value = '';
            }
        }
        
        // Tistory ëª¨ë‹¬ í‘œì‹œ
        function showTistoryModal() {
            const modal = new bootstrap.Modal(document.getElementById('tistoryModal'));
            modal.show();
        }
        
        // ì§„í–‰ ë‹¨ê³„ í‘œì‹œ (ì¤‘ì•™ ì˜¤ë²„ë ˆì´)
        function showProgressSteps(steps) {
            console.log('ğŸ¬ ì¤‘ì•™ ì§„í–‰ ì˜¤ë²„ë ˆì´ ì‹œì‘:', steps);
            
            // ê¸°ì¡´ ì˜¤ë²„ë ˆì´ ì œê±°
            const existingOverlay = document.getElementById('progress-overlay');
            if (existingOverlay) {
                existingOverlay.remove();
            }
            
            // ì¤‘ì•™ ì˜¤ë²„ë ˆì´ ìƒì„±
            const overlay = document.createElement('div');
            overlay.className = 'progress-overlay';
            overlay.id = 'progress-overlay';
            
            const container = document.createElement('div');
            container.className = 'progress-container';
            
            container.innerHTML = `
                <div class="progress-title">
                    <i class="bi bi-magic" style="color: #667eea; margin-right: 10px;"></i>
                    ì½˜í…ì¸  ìƒì„± ì¤‘
                </div>
                <ul class="progress-steps-list" id="progress-steps-list">
                    ${steps.map((step, index) => `
                        <li class="progress-step-item" id="step-${index}">
                            <div class="progress-step-icon waiting" id="icon-${index}">
                                <i class="bi bi-circle"></i>
                            </div>
                            <div class="progress-step-text" id="text-${index}">
                                ${step}
                            </div>
                        </li>
                    `).join('')}
                </ul>
                <div style="margin-top: 20px; color: #6c757d;">
                    <small>ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...</small>
                </div>
            `;
            
            overlay.appendChild(container);
            document.body.appendChild(overlay);
            
            // ë‹¨ê³„ë³„ ì§„í–‰ ì• ë‹ˆë©”ì´ì…˜
            let currentStep = 0;
            const progressInterval = setInterval(() => {
                if (currentStep < steps.length) {
                    // í˜„ì¬ ë‹¨ê³„ í™œì„±í™”
                    const icon = document.getElementById(`icon-${currentStep}`);
                    const text = document.getElementById(`text-${currentStep}`);
                    
                    if (icon && text) {
                        icon.className = 'progress-step-icon active';
                        icon.innerHTML = '<div class="loading-spinner" style="width: 20px; height: 20px; border-width: 2px;"></div>';
                        text.className = 'progress-step-text active';
                    }
                    
                    // ì´ì „ ë‹¨ê³„ë“¤ ì™„ë£Œ í‘œì‹œ
                    for (let i = 0; i < currentStep; i++) {
                        const prevIcon = document.getElementById(`icon-${i}`);
                        const prevText = document.getElementById(`text-${i}`);
                        if (prevIcon && prevText) {
                            prevIcon.className = 'progress-step-icon completed';
                            prevIcon.innerHTML = '<i class="bi bi-check-lg"></i>';
                            prevText.className = 'progress-step-text completed';
                        }
                    }
                    
                    currentStep++;
                } else {
                    // ëª¨ë“  ë‹¨ê³„ ì™„ë£Œ
                    for (let i = 0; i < steps.length; i++) {
                        const icon = document.getElementById(`icon-${i}`);
                        const text = document.getElementById(`text-${i}`);
                        if (icon && text) {
                            icon.className = 'progress-step-icon completed';
                            icon.innerHTML = '<i class="bi bi-check-lg"></i>';
                            text.className = 'progress-step-text completed';
                        }
                    }
                    clearInterval(progressInterval);
                }
            }, 1200); // 1.2ì´ˆë§ˆë‹¤ ë‹¤ìŒ ë‹¨ê³„
            
            window.currentProgressInterval = progressInterval;
        }
        
        function hideProgressSteps() {
            const overlay = document.getElementById('progress-overlay');
            if (overlay) {
                overlay.remove();
            }
            
            if (window.currentProgressInterval) {
                clearInterval(window.currentProgressInterval);
                window.currentProgressInterval = null;
            }
        }
        
        // íŒŒì¼ ì‚­ì œ ê¸°ëŠ¥
        async function deleteFile(fileId, type) {
            if (!confirm('ì´ íŒŒì¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) return;
            
            showNotification('íŒŒì¼ ì‚­ì œ ì¤‘...', 'info');
            
            try {
                const res = await fetch('/api/delete_file', {
                    method: 'DELETE',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({file_id: fileId, type: type})
                });
                
                const result = await res.json();
                
                if (result.success) {
                    showNotification('âœ… íŒŒì¼ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
                    refreshData();
                } else {
                    showNotification(`âŒ ì‚­ì œ ì‹¤íŒ¨: ${result.error}`, 'error');
                }
            } catch (error) {
                showNotification(`âŒ ì‚­ì œ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }
        
        // ì„ì‹œë¡œ ìƒˆ ì½˜í…ì¸ ë¥¼ ëª©ë¡ì— ì¶”ê°€ (ì¦‰ì‹œ í”¼ë“œë°±ìš©)
        function addTemporaryContent(type, contentData) {
            console.log('ğŸ“ ì„ì‹œ ì½˜í…ì¸  ì¶”ê°€:', type, contentData);
            
            const containerId = type === 'wordpress' ? 'wordpress-files' : 'tistory-files';
            const container = document.getElementById(containerId);
            
            const dateObj = new Date(contentData.created_at);
            const year = dateObj.getFullYear();
            const month = dateObj.getMonth() + 1;
            const day = dateObj.getDate();
            const hours = String(dateObj.getHours()).padStart(2, '0');
            const minutes = String(dateObj.getMinutes()).padStart(2, '0');
            const date = `${year}. ${month}. ${day}. ${hours}:${minutes}`;
            const siteClass = `site-${contentData.site}`;
            
            let tempHtml = '';
            if (type === 'wordpress') {
                const keywordTags = contentData.keywords.map(keyword => 
                    `<span class="badge bg-primary me-1">${keyword}</span>`
                ).join('');
                
                tempHtml = `
                    <div class="wordpress-file mb-3 p-2 border rounded bg-light" id="temp-content">
                        <div class="d-flex justify-content-between align-items-start">
                            <div class="flex-grow-1">
                                <div class="d-flex align-items-center mb-1">
                                    <span class="site-badge ${siteClass}">${contentData.site.toUpperCase()}</span>
                                    <span class="badge bg-secondary ms-2">${contentData.category}</span>
                                    <span class="badge bg-success ms-2">ìƒˆë¡œ ìƒì„±ë¨</span>
                                </div>
                                <strong>ğŸ“ ${contentData.title}</strong>
                                <div class="mt-2">${keywordTags}</div>
                                <div class="text-muted small mt-1">
                                    <i class="bi bi-calendar"></i> ${date} (ë°©ê¸ˆ ì „)
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                const keywordTags = contentData.keywords.map(keyword => 
                    `<span class="badge bg-secondary">${keyword}</span>`
                ).join(' ');
                
                tempHtml = `
                    <div class="tistory-file mb-3 p-2 border rounded bg-light" id="temp-content">
                        <div class="d-flex justify-content-between align-items-start">
                            <div class="flex-grow-1">
                                <div class="d-flex align-items-center mb-1">
                                    <span class="badge bg-success">ìƒˆë¡œ ìƒì„±ë¨</span>
                                </div>
                                <strong>ğŸ“ ${contentData.title}</strong>
                                <div class="mt-1">${keywordTags}</div>
                                <div class="text-muted small mt-1">
                                    <i class="bi bi-calendar"></i> ${date} (ë°©ê¸ˆ ì „)
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // ê¸°ì¡´ ë‚´ìš© ë§¨ ìœ„ì— ì¶”ê°€ (ì¦‰ì‹œ ë³´ì´ë„ë¡)
            console.log('ğŸ“Œ ì„ì‹œ ì½˜í…ì¸ ë¥¼ ëª©ë¡ ë§¨ ìœ„ì— ì¶”ê°€');
            container.insertAdjacentHTML('afterbegin', tempHtml);
        }
        
        // ì„ íƒì‚­ì œ ê¸°ëŠ¥
        const selectedFiles = {
            wordpress: new Set(),
            tistory: new Set()
        };
        
        // ì „ì²´ ì„ íƒ/í•´ì œ í† ê¸€
        function toggleSelectAll(type) {
            const selectAllCheckbox = document.getElementById(`select-all-${type}`);
            const containerId = type === 'wordpress' ? 'wordpress-files' : 'tistory-files';
            const container = document.getElementById(containerId);
            const contentCheckboxes = container.querySelectorAll('.content-checkbox[data-file-id]');
            const isChecked = selectAllCheckbox.checked;
            
            selectedFiles[type].clear();
            
            contentCheckboxes.forEach(checkbox => {
                checkbox.checked = isChecked;
                if (isChecked) {
                    const fileId = parseInt(checkbox.dataset.fileId);
                    selectedFiles[type].add(fileId);
                }
            });
            
            updateBulkActionBar(type);
        }
        
        // ê°œë³„ ì•„ì´í…œ ì„ íƒ/í•´ì œ í† ê¸€
        function toggleItemSelection(type, fileId) {
            const checkbox = document.querySelector(`.content-checkbox[data-file-id="${fileId}"]`);
            
            if (checkbox.checked) {
                selectedFiles[type].add(fileId);
            } else {
                selectedFiles[type].delete(fileId);
            }
            
            // ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸
            const selectAllCheckbox = document.getElementById(`select-all-${type}`);
            const containerId = type === 'wordpress' ? 'wordpress-files' : 'tistory-files';
            const container = document.getElementById(containerId);
            const totalCheckboxes = container.querySelectorAll('.content-checkbox[data-file-id]').length;
            const checkedCount = selectedFiles[type].size;
            
            selectAllCheckbox.indeterminate = checkedCount > 0 && checkedCount < totalCheckboxes;
            selectAllCheckbox.checked = checkedCount === totalCheckboxes && totalCheckboxes > 0;
            
            updateBulkActionBar(type);
        }
        
        // ë²Œí¬ ì•¡ì…˜ ë°” ì—…ë°ì´íŠ¸
        function updateBulkActionBar(type) {
            const bulkActions = document.getElementById(`${type}-bulk-actions`);
            const selectedCount = document.getElementById(`${type}-selected-count`);
            const count = selectedFiles[type].size;
            
            selectedCount.textContent = `${count}ê°œ ì„ íƒë¨`;
            
            if (count > 0) {
                bulkActions.style.display = 'flex';
            } else {
                bulkActions.style.display = 'none';
            }
        }
        
        // ëª¨ë“  ì„ íƒ í•´ì œ
        function deselectAll(type) {
            selectedFiles[type].clear();
            
            // í•´ë‹¹ íƒ€ì…ì˜ ëª¨ë“  ì²´í¬ë°•ìŠ¤ í•´ì œ
            const containerId = type === 'wordpress' ? 'wordpress-files' : 'tistory-files';
            const container = document.getElementById(containerId);
            const checkboxes = container.querySelectorAll('.content-checkbox[data-file-id]');
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
            });
            
            // ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤ í•´ì œ
            const selectAllCheckbox = document.getElementById(`select-all-${type}`);
            selectAllCheckbox.checked = false;
            selectAllCheckbox.indeterminate = false;
            
            updateBulkActionBar(type);
        }
        
        // ë²Œí¬ ì‚­ì œ ì‹¤í–‰
        async function bulkDelete(type) {
            const selectedIds = Array.from(selectedFiles[type]);
            
            if (selectedIds.length === 0) {
                showNotification('ì‚­ì œí•  íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”', 'warning');
                return;
            }
            
            const confirmMessage = `ì„ íƒí•œ ${selectedIds.length}ê°œì˜ ${type === 'wordpress' ? 'WordPress' : 'Tistory'} íŒŒì¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`;
            
            if (!confirm(confirmMessage)) return;
            
            showNotification(`${selectedIds.length}ê°œ íŒŒì¼ ì‚­ì œ ì¤‘...`, 'info');
            
            try {
                const res = await fetch('/api/bulk_delete_files', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        file_ids: selectedIds
                    })
                });
                
                const result = await res.json();
                
                if (result.success) {
                    showNotification(`âœ… ${result.deleted_count}ê°œ íŒŒì¼ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤`, 'success');
                    
                    if (result.failed_ids && result.failed_ids.length > 0) {
                        showNotification(`âš ï¸ ${result.failed_ids.length}ê°œ íŒŒì¼ ì‚­ì œ ì‹¤íŒ¨`, 'warning');
                    }
                    
                    // ì„ íƒ ìƒíƒœ ì´ˆê¸°í™”
                    deselectAll(type);
                    
                    // ë°ì´í„° ìƒˆë¡œê³ ì¹¨
                    refreshData();
                } else {
                    showNotification(`âŒ ì‚­ì œ ì‹¤íŒ¨: ${result.error}`, 'error');
                }
            } catch (error) {
                console.error('ë²Œí¬ ì‚­ì œ ì˜¤ë¥˜:', error);
                showNotification(`âŒ ì‚­ì œ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì²´í¬ë°•ìŠ¤ ê°•ì œ ì¶”ê°€
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ’¡ ì²´í¬ë°•ìŠ¤ ê°•ì œ ì¶”ê°€ ì‹œì‘');
            
            // WordPress í—¤ë”ì— ì²´í¬ë°•ìŠ¤ ì¶”ê°€
            setTimeout(function() {
                const wpHeader = document.querySelector('.card-header h5');
                if (wpHeader && wpHeader.textContent.includes('WordPress')) {
                    const parent = wpHeader.parentElement;
                    if (!parent.querySelector('#select-all-wordpress')) {
                        const checkboxContainer = document.createElement('div');
                        checkboxContainer.className = 'd-flex align-items-center';
                        checkboxContainer.innerHTML = `
                            <input type="checkbox" class="form-check-input select-all-checkbox me-2" 
                                   id="select-all-wordpress" onchange="toggleSelectAll('wordpress')" 
                                   style="display: block !important; visibility: visible !important; opacity: 1 !important; width: 20px; height: 20px;">
                        `;
                        parent.insertBefore(checkboxContainer.firstElementChild, wpHeader);
                        console.log('âœ… WordPress í—¤ë” ì²´í¬ë°•ìŠ¤ ì¶”ê°€ë¨');
                        
                        // ëŒ€ëŸ‰ ì‘ì—… ë°” ì¶”ê°€
                        addBulkActionBar('wordpress', wpHeader.closest('.card'));
                    }
                }
                
                // Tistory í—¤ë”ì— ì²´í¬ë°•ìŠ¤ ì¶”ê°€
                const allCards = document.querySelectorAll('.card');
                allCards.forEach(card => {
                    const header = card.querySelector('h5');
                    if (header && header.textContent.includes('Tistory')) {
                        const parent = header.parentElement;
                        if (!parent.querySelector('#select-all-tistory')) {
                            const checkboxContainer = document.createElement('div');
                            checkboxContainer.className = 'd-flex align-items-center';
                            checkboxContainer.innerHTML = `
                                <input type="checkbox" class="form-check-input select-all-checkbox me-2" 
                                       id="select-all-tistory" onchange="toggleSelectAll('tistory')" 
                                       style="display: block !important; visibility: visible !important; opacity: 1 !important; width: 20px; height: 20px;">
                            `;
                            parent.insertBefore(checkboxContainer.firstElementChild, header);
                            console.log('âœ… Tistory í—¤ë” ì²´í¬ë°•ìŠ¤ ì¶”ê°€ë¨');
                            
                            // ëŒ€ëŸ‰ ì‘ì—… ë°” ì¶”ê°€
                            addBulkActionBar('tistory', header.closest('.card'));
                        }
                    }
                });
            }, 1000); // 1ì´ˆ í›„ ì‹¤í–‰
        });
        
        // ëŒ€ëŸ‰ ì‘ì—… ë°” ì¶”ê°€
        function addBulkActionBar(type, cardElement) {
            if (cardElement.querySelector(`#${type}-bulk-actions`)) return;
            
            const bulkActionBar = document.createElement('div');
            bulkActionBar.id = `${type}-bulk-actions`;
            bulkActionBar.className = 'bulk-actions';
            bulkActionBar.style.cssText = `
                background: linear-gradient(135deg, #667eea, #764ba2);
                color: white;
                border-radius: 10px;
                padding: 15px;
                margin-bottom: 20px;
                display: none;
                align-items: center;
                justify-content: space-between;
                box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            `;
            
            bulkActionBar.innerHTML = `
                <div class="bulk-info">
                    <div class="bulk-count" id="${type}-selected-count" style="background: rgba(255, 255, 255, 0.2); border-radius: 15px; padding: 5px 12px; font-weight: bold;">0ê°œ ì„ íƒë¨</div>
                    <span style="margin-left: 15px;">ì„ íƒëœ ${type === 'wordpress' ? 'WordPress' : 'Tistory'} ì½˜í…ì¸ ë¥¼ ê´€ë¦¬í•˜ì„¸ìš”</span>
                </div>
                <div>
                    <button class="btn btn-light btn-sm me-2" onclick="deselectAll('${type}')" style="font-weight: bold;">
                        <i class="bi bi-x"></i> ì„ íƒ í•´ì œ
                    </button>
                    <button class="btn btn-danger btn-sm" onclick="bulkDelete('${type}')" style="font-weight: bold;">
                        <i class="bi bi-trash"></i> ì„ íƒ ì‚­ì œ
                    </button>
                </div>
            `;
            
            const cardBody = cardElement.querySelector('.card-body');
            cardBody.parentNode.insertBefore(bulkActionBar, cardBody);
            console.log(`âœ… ${type} ëŒ€ëŸ‰ ì‘ì—… ë°” ì¶”ê°€ë¨`);
        }

        // ====== ìë™ ë°œí–‰ ìŠ¤ì¼€ì¤„ ê´€ë¦¬ í•¨ìˆ˜ë“¤ ======

        // ì´ë²ˆ ì£¼ ì›”ìš”ì¼ ë‚ ì§œ ê³„ì‚°
        function getThisMonday() {
            const today = new Date();
            const dayOfWeek = today.getDay();
            const diff = today.getDate() - dayOfWeek + (dayOfWeek === 0 ? -6 : 1);
            const monday = new Date(today.setDate(diff));
            return monday.toISOString().split('T')[0];
        }

        // ì „ì²´ ìŠ¤ì¼€ì¤„ ë³´ê¸° ëª¨ë‹¬ í‘œì‹œ
        function showScheduleOverview() {
            const modal = new bootstrap.Modal(document.getElementById('scheduleOverviewModal'));
            modal.show();
            
            // ëª¨ë‹¬ì´ ì—´ë¦¬ë©´ í˜„ì¬ ì£¼ ìŠ¤ì¼€ì¤„ ë¡œë“œ
            showScheduleWeek('current');
            calculateNextRunTime();
        }

        // íŠ¹ì • ì£¼ì°¨ ìŠ¤ì¼€ì¤„ í‘œì‹œ
        async function showScheduleWeek(weekType) {
            try {
                // ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ë³€ê²½
                document.querySelectorAll('.schedule-overview-controls .btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                event.target.classList.add('active');
                
                const today = new Date();
                let targetDate;
                
                if (weekType === 'current') {
                    targetDate = getThisMonday();
                } else {
                    const nextWeek = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000);
                    const dayOfWeek = nextWeek.getDay();
                    const diff = nextWeek.getDate() - dayOfWeek + (dayOfWeek === 0 ? -6 : 1);
                    targetDate = new Date(nextWeek.setDate(diff)).toISOString().split('T')[0];
                }
                
                const response = await fetch(`/api/schedule/weekly?week_start=${targetDate}`);
                const scheduleData = await response.json();
                
                displayScheduleOverview(scheduleData, weekType);
                
            } catch (error) {
                console.error('ìŠ¤ì¼€ì¤„ ë¡œë“œ ì˜¤ë¥˜:', error);
                document.getElementById('schedule-overview-content').innerHTML = 
                    '<div class="text-center text-muted">ìŠ¤ì¼€ì¤„ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
            }
        }

        // ìŠ¤ì¼€ì¤„ ì „ì²´ í‘œì‹œ
        function displayScheduleOverview(scheduleData, weekType) {
            const container = document.getElementById('schedule-overview-content');
            
            if (!scheduleData || !scheduleData.schedule) {
                container.innerHTML = `
                    <div class="text-center py-4">
                        <div class="text-muted mb-3">
                            <i class="bi bi-calendar-x" style="font-size: 2rem;"></i>
                        </div>
                        <p class="text-muted">${weekType === 'current' ? 'ì´ë²ˆ' : 'ë‹¤ìŒ'} ì£¼ ë°œí–‰ ê³„íšì´ ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤.</p>
                        <small class="text-muted">ì‹œìŠ¤í…œì´ ìë™ìœ¼ë¡œ ìŠ¤ì¼€ì¤„ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.</small>
                    </div>
                `;
                return;
            }
            
            let html = `
                <div class="schedule-header mb-4">
                    <h6 class="text-primary">
                        ğŸ“… ${weekType === 'current' ? 'ì´ë²ˆ' : 'ë‹¤ìŒ'} ì£¼ ë°œí–‰ ê³„íš 
                        <small class="text-muted">(${scheduleData.week_start} ì£¼)</small>
                    </h6>
                </div>
                <div class="row">
            `;
            
            const statusColors = {
                'planned': 'secondary',
                'generating': 'warning',
                'published': 'success',
                'failed': 'danger'
            };
            
            const statusTexts = {
                'planned': 'ë°œí–‰ ì˜ˆì •',
                'generating': 'ìƒì„± ì¤‘',
                'published': 'ë°œí–‰ ì™„ë£Œ',
                'failed': 'ì‹¤íŒ¨'
            };
            
            // ìš”ì¼ë³„ë¡œ ì¹´ë“œ í˜•íƒœë¡œ í‘œì‹œ
            for (let day = 0; day < 7; day++) {
                const dayInfo = scheduleData.schedule[day];
                if (!dayInfo) continue;
                
                html += `
                    <div class="col-md-6 col-lg-4 mb-3">
                        <div class="card schedule-day-card">
                            <div class="card-header bg-light">
                                <h6 class="mb-0">${dayInfo.day_name}</h6>
                                <small class="text-muted">${dayInfo.date}</small>
                            </div>
                            <div class="card-body p-2">
                `;
                
                // ì‚¬ì´íŠ¸ë³„ ê³„íš í‘œì‹œ
                const sites = ['unpre', 'untab', 'skewese'];
                for (const site of sites) {
                    const plan = dayInfo.sites[site];
                    if (plan) {
                        const statusClass = statusColors[plan.status] || 'secondary';
                        const statusText = statusTexts[plan.status] || plan.status;
                        
                        html += `
                            <div class="schedule-site-item mb-2">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div class="flex-grow-1">
                                        <div class="site-badge site-${site} small mb-1">${site.toUpperCase()}</div>
                                        <div class="fw-bold small" style="font-size: 0.8rem;">${plan.topic}</div>
                                        <div class="text-muted" style="font-size: 0.7rem;">
                                            ${plan.keywords ? plan.keywords.slice(0, 3).join(', ') : ''}
                                        </div>
                                    </div>
                                    <span class="badge bg-${statusClass} small">${statusText}</span>
                                </div>
                                ${plan.url ? `<div class="mt-1"><a href="${plan.url}" target="_blank" class="small text-decoration-none">ğŸ”— ë³´ê¸°</a></div>` : ''}
                            </div>
                        `;
                    }
                }
                
                html += `
                            </div>
                        </div>
                    </div>
                `;
            }
            
            html += '</div>';
            container.innerHTML = html;
        }

        // ë‹¤ìŒ ì‹¤í–‰ ì‹œê°„ ê³„ì‚°
        function calculateNextRunTime() {
            const now = new Date();
            const tomorrow = new Date(now);
            tomorrow.setDate(tomorrow.getDate() + 1);
            tomorrow.setHours(3, 0, 0, 0); // ìƒˆë²½ 3ì‹œ
            
            // ë§Œì•½ í˜„ì¬ ì‹œê°„ì´ ìƒˆë²½ 3ì‹œ ì´ì „ì´ë©´ ì˜¤ëŠ˜ 3ì‹œë¡œ ì„¤ì •
            if (now.getHours() < 3) {
                tomorrow.setDate(now.getDate());
            }
            
            const nextRunElement = document.getElementById('next-run-time');
            if (nextRunElement) {
                const options = { 
                    year: 'numeric', 
                    month: 'short', 
                    day: 'numeric', 
                    hour: '2-digit', 
                    minute: '2-digit' 
                };
                nextRunElement.textContent = tomorrow.toLocaleString('ko-KR', options);
            }
        }

        // ì¼ì£¼ì¼ì¹˜ ìŠ¤ì¼€ì¤„ ë¡œë“œ
        async function loadWeeklySchedule() {
            const weekPicker = document.getElementById('schedule-week-picker');
            const startDate = weekPicker.value || getThisMonday();
            
            try {
                const response = await fetch(`/api/schedule/weekly?week_start=${startDate}`);
                const scheduleData = await response.json();
                
                displayWeeklySchedule(scheduleData);
            } catch (error) {
                console.error('ìŠ¤ì¼€ì¤„ ë¡œë“œ ì˜¤ë¥˜:', error);
                document.getElementById('weekly-schedule-content').innerHTML = 
                    '<div class="text-center text-muted">ìŠ¤ì¼€ì¤„ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
            }
        }

        // ìŠ¤ì¼€ì¤„ í‘œì‹œ
        function displayWeeklySchedule(scheduleData) {
            const container = document.getElementById('weekly-schedule-content');
            
            if (!scheduleData || !scheduleData.schedule) {
                container.innerHTML = `
                    <div class="text-center py-4">
                        <div class="text-muted mb-3">
                            <i class="bi bi-calendar-x" style="font-size: 2rem;"></i>
                        </div>
                        <p class="text-muted">í•´ë‹¹ ì£¼ì˜ ë°œí–‰ ìŠ¤ì¼€ì¤„ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                        <button class="btn btn-primary btn-sm" onclick="createWeeklySchedule()">
                            ìŠ¤ì¼€ì¤„ ìƒì„±í•˜ê¸°
                        </button>
                    </div>
                `;
                return;
            }
            
            let html = `<div class="schedule-week mb-2">
                            <small class="text-muted">ğŸ“… ${scheduleData.week_start} ì£¼</small>
                        </div>`;
            
            const statusColors = {
                'planned': 'secondary',
                'generating': 'warning',
                'published': 'success',
                'failed': 'danger'
            };
            
            const statusTexts = {
                'planned': 'ì˜ˆì •',
                'generating': 'ìƒì„±ì¤‘',
                'published': 'ë°œí–‰ì™„ë£Œ',
                'failed': 'ì‹¤íŒ¨'
            };
            
            // ìš”ì¼ë³„ë¡œ í‘œì‹œ
            for (let day = 0; day < 7; day++) {
                const dayInfo = scheduleData.schedule[day];
                if (!dayInfo) continue;
                
                html += `
                    <div class="schedule-day mb-3 p-2 border-start border-primary border-3">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <strong>${dayInfo.day_name}</strong>
                            <small class="text-muted">${dayInfo.date}</small>
                        </div>
                `;
                
                // ì‚¬ì´íŠ¸ë³„ ê³„íš í‘œì‹œ
                const sites = ['unpre', 'untab', 'skewese'];
                for (const site of sites) {
                    const plan = dayInfo.sites[site];
                    if (plan) {
                        const statusClass = statusColors[plan.status] || 'secondary';
                        const statusText = statusTexts[plan.status] || plan.status;
                        
                        html += `
                            <div class="schedule-item mb-2 p-2 bg-light rounded">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div class="flex-grow-1">
                                        <div class="site-badge site-${site} mb-1">${site.toUpperCase()}</div>
                                        <div class="fw-bold small">${plan.topic}</div>
                                        <div class="text-muted small">
                                            ${plan.keywords ? plan.keywords.join(', ') : ''}
                                        </div>
                                    </div>
                                    <span class="badge bg-${statusClass}">${statusText}</span>
                                </div>
                                ${plan.url ? `<div class="mt-1"><a href="${plan.url}" target="_blank" class="small text-decoration-none">ğŸ”— ë°œí–‰ëœ ê¸€ ë³´ê¸°</a></div>` : ''}
                            </div>
                        `;
                    }
                }
                
                html += '</div>';
            }
            
            container.innerHTML = html;
        }

        // ìˆ˜ë™ ë°œí–‰ íŠ¸ë¦¬ê±°
        async function triggerManualPublish() {
            const today = new Date().toISOString().split('T')[0];
            
            if (!confirm('âš ï¸ ì˜¤ëŠ˜ ì˜ˆì •ëœ ëª¨ë“  ì½˜í…ì¸ ë¥¼ ì§€ê¸ˆ ìˆ˜ë™ìœ¼ë¡œ ìƒì„±í•˜ê³  ë°œí–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ìë™ ìŠ¤ì¼€ì¤„ê³¼ ë³„ê°œë¡œ ì¦‰ì‹œ ì‹¤í–‰ë©ë‹ˆë‹¤.')) {
                return;
            }
            
            showNotification('ğŸš€ ìˆ˜ë™ ë°œí–‰ì„ ì‹œì‘í•©ë‹ˆë‹¤... (3-5ë¶„ ì†Œìš”)', 'info');
            
            try {
                const response = await fetch('/api/schedule/auto_publish', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({date: today})
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification('âœ… ìˆ˜ë™ ë°œí–‰ ì™„ë£Œ!', 'success');
                    loadWeeklySchedule();
                    refreshData(); // ì „ì²´ ë°ì´í„°ë„ ìƒˆë¡œê³ ì¹¨
                } else {
                    showNotification(`âŒ ìˆ˜ë™ ë°œí–‰ ì‹¤íŒ¨: ${result.error}`, 'error');
                }
            } catch (error) {
                showNotification(`âŒ ìˆ˜ë™ ë°œí–‰ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        // í˜ì´ì§€ ë¡œë“œì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            // ë‚ ì§œ ì„ íƒê¸°ë¥¼ ì´ë²ˆ ì£¼ ì›”ìš”ì¼ë¡œ ì„¤ì •
            document.getElementById('schedule-week-picker').value = getThisMonday();
            
            // ìŠ¤ì¼€ì¤„ ë¡œë“œ
            loadWeeklySchedule();
        });
    </script>
</body>
</html>