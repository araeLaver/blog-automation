<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ïã§ÏãúÍ∞Ñ Ìä∏Î†åÎìú ÎåÄÏãúÎ≥¥Îìú - UNBLE</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-attachment: fixed;
            font-family: 'Noto Sans KR', 'Malgun Gothic', sans-serif;
        }
        
        .main-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            margin: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .trend-card {
            background: white;
            border: none;
            border-radius: 15px;
            transition: all 0.3s ease;
            cursor: pointer;
            margin-bottom: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            overflow: hidden;
        }
        
        .trend-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
        }
        
        .score-badge {
            background: linear-gradient(45deg, #FF6B6B, #FF8E8E);
            border: none;
            font-size: 0.85em;
            min-width: 60px;
            font-weight: 700;
            padding: 8px 12px;
            border-radius: 20px;
        }
        
        .source-badge {
            background: linear-gradient(45deg, #4ECDC4, #6BCF7F);
            border: none;
            font-size: 0.75em;
            padding: 6px 10px;
            border-radius: 15px;
            color: white;
            font-weight: 600;
        }
        
        .trend-title {
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 12px;
            font-size: 1.1em;
            line-height: 1.3;
        }
        
        .trend-description {
            color: #6c757d;
            font-size: 0.9em;
            line-height: 1.5;
            margin-bottom: 12px;
        }
        
        .category-section {
            margin-bottom: 3rem;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .category-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 25px;
            margin-bottom: 0;
            font-size: 1.3em;
            font-weight: 700;
            border-radius: 0;
        }
        
        .category-content {
            padding: 25px;
        }
        
        .refresh-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            color: white;
            font-size: 1.2em;
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
        }
        
        .refresh-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.6);
        }
        
        .loading-spinner {
            display: none;
            text-align: center;
            padding: 50px;
        }
        
        .loading-spinner .spinner-border {
            width: 4rem;
            height: 4rem;
            border-width: 0.4em;
        }
        
        .trend-tags {
            margin-top: 15px;
        }
        
        .trend-tags .badge {
            background: linear-gradient(45deg, #74b9ff, #a29bfe);
            border: none;
            margin-right: 8px;
            margin-bottom: 5px;
            font-size: 0.75em;
            padding: 6px 12px;
            border-radius: 20px;
            color: white;
            font-weight: 500;
        }
        
        .stats-card {
            background: linear-gradient(135deg, #74b9ff 0%, #a29bfe 100%);
            color: white;
            border: none;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(116, 185, 255, 0.3);
            transition: transform 0.3s ease;
        }
        
        .stats-card:hover {
            transform: translateY(-3px);
        }
        
        .auto-refresh-status {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        .auto-refresh-status .alert {
            border-radius: 15px;
            border: none;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .trend-timestamp {
            font-size: 0.8em;
            color: #95a5a6;
            font-weight: 500;
        }
        
        .page-title {
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 900;
            text-align: center;
            margin-bottom: 2rem;
            font-size: 2.5em;
        }
        
        .category-filters .btn {
            margin: 5px;
            border-radius: 25px;
            padding: 10px 20px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .category-filters .btn-outline-primary {
            border-color: #667eea;
            color: #667eea;
        }
        
        .category-filters .btn-outline-primary:hover,
        .category-filters .btn-outline-primary.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-color: transparent;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }
        
        @media (max-width: 768px) {
            .main-container {
                margin: 10px;
                padding: 20px;
                border-radius: 15px;
            }
            
            .page-title {
                font-size: 2em;
            }
            
            .trend-card {
                margin-bottom: 15px;
            }
            
            .refresh-btn {
                bottom: 20px;
                right: 20px;
                width: 55px;
                height: 55px;
            }
            
            .category-header {
                padding: 15px 20px;
                font-size: 1.1em;
            }
            
            .category-content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- ÏûêÎèô ÏÉàÎ°úÍ≥†Ïπ® ÏÉÅÌÉú -->
    <div class="auto-refresh-status">
        <div class="alert alert-info alert-dismissible fade show" role="alert">
            <i class="fas fa-sync-alt"></i> ÏûêÎèô ÏÉàÎ°úÍ≥†Ïπ®: <span id="refreshCountdown">60</span>Ï¥à
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    </div>

    <div class="main-container">
        <!-- Ìó§Îçî -->
        <div class="row mb-4">
            <div class="col-12">
                <h1 class="page-title">
                    üìä Ïã§ÏãúÍ∞Ñ Ìä∏Î†åÎìú ÎåÄÏãúÎ≥¥Îìú
                </h1>
                
                <!-- ÌÜµÍ≥Ñ Ïπ¥Îìú -->
                <div class="row justify-content-center mb-4">
                    <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
                        <div class="card stats-card text-center">
                            <div class="card-body py-3">
                                <h5 class="card-title" id="totalTrends">-</h5>
                                <p class="card-text mb-0">Ï¥ù Ìä∏Î†åÎìú</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
                        <div class="card stats-card text-center">
                            <div class="card-body py-3">
                                <h5 class="card-title" id="totalSources">-</h5>
                                <p class="card-text mb-0">Îç∞Ïù¥ÌÑ∞ ÏÜåÏä§</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
                        <div class="card stats-card text-center">
                            <div class="card-body py-3">
                                <h5 class="card-title" id="lastUpdate">-</h5>
                                <p class="card-text mb-0">ÎßàÏßÄÎßâ ÏóÖÎç∞Ïù¥Ìä∏</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ÌïÑÌÑ∞ Î≤ÑÌäº -->
        <div class="row mb-4">
            <div class="col-12 text-center">
                <div class="category-filters" id="categoryFilters">
                    <button type="button" class="btn btn-outline-primary active" data-category="all">üîç Ï†ÑÏ≤¥</button>
                </div>
            </div>
        </div>

        <!-- Î°úÎî© Ïä§ÌîºÎÑà -->
        <div class="row loading-spinner" id="loadingSpinner">
            <div class="col-12 text-center">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-2">Ïã§ÏãúÍ∞Ñ Ìä∏Î†åÎìú Îç∞Ïù¥ÌÑ∞Î•º ÏàòÏßë Ï§ëÏûÖÎãàÎã§...</p>
            </div>
        </div>

        <!-- Ìä∏Î†åÎìú Îç∞Ïù¥ÌÑ∞ -->
        <div id="trendsContainer">
            <!-- Ìä∏Î†åÎìú Ïπ¥ÌÖåÍ≥†Î¶¨Î≥ÑÎ°ú ÎèôÏ†Å ÏÉùÏÑ± -->
        </div>
    </div>

    <!-- ÏÉàÎ°úÍ≥†Ïπ® Î≤ÑÌäº -->
    <button class="btn btn-primary btn-lg refresh-btn" onclick="refreshTrends()">
        <i class="fas fa-sync-alt"></i>
    </button>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        let autoRefreshInterval;
        let countdownInterval;
        let refreshCountdown = 60;
        
        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ìä∏Î†åÎìú Îç∞Ïù¥ÌÑ∞ Î°úÎìú
        document.addEventListener('DOMContentLoaded', function() {
            loadTrends();
            startAutoRefresh();
        });
        
        // Ìä∏Î†åÎìú Îç∞Ïù¥ÌÑ∞ Î°úÎìú
        async function loadTrends() {
            showLoading();
            
            try {
                const response = await fetch('/api/trends/realtime');
                const data = await response.json();
                
                if (data.success) {
                    displayTrends(data.trends);
                    updateStats(data.stats);
                } else {
                    showError('Ìä∏Î†åÎìú Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®: ' + data.error);
                }
            } catch (error) {
                console.error('Ìä∏Î†åÎìú Î°úÎìú Ïò§Î•ò:', error);
                showError('Ìä∏Î†åÎìú Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.');
            } finally {
                hideLoading();
            }
        }
        
        // Ìä∏Î†åÎìú Îç∞Ïù¥ÌÑ∞ ÌëúÏãú
        function displayTrends(categorizedTrends) {
            const container = document.getElementById('trendsContainer');
            container.innerHTML = '';
            
            // Ïπ¥ÌÖåÍ≥†Î¶¨ ÌïÑÌÑ∞ Î≤ÑÌäº ÏóÖÎç∞Ïù¥Ìä∏
            updateCategoryFilters(Object.keys(categorizedTrends));
            
            // Ïπ¥ÌÖåÍ≥†Î¶¨Î≥ÑÎ°ú Ìä∏Î†åÎìú ÌëúÏãú
            Object.entries(categorizedTrends).forEach(([category, trends]) => {
                const categorySection = createCategorySection(category, trends);
                container.appendChild(categorySection);
            });
        }
        
        // Ïπ¥ÌÖåÍ≥†Î¶¨ ÏÑπÏÖò ÏÉùÏÑ±
        function createCategorySection(category, trends) {
            const section = document.createElement('div');
            section.className = 'category-section';
            section.dataset.category = category;
            
            const header = document.createElement('h3');
            header.className = 'category-header';
            header.innerHTML = `
                ${getCategoryIcon(category)} ${category} (${trends.length}Í∞ú)
            `;
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'category-content';
            
            const cardContainer = document.createElement('div');
            cardContainer.className = 'row';
            
            trends.forEach(trend => {
                const col = document.createElement('div');
                col.className = 'col-lg-6 col-md-6 col-sm-12';
                col.appendChild(createTrendCard(trend));
                cardContainer.appendChild(col);
            });
            
            contentDiv.appendChild(cardContainer);
            section.appendChild(header);
            section.appendChild(contentDiv);
            
            return section;
        }
        
        // Ìä∏Î†åÎìú Ïπ¥Îìú ÏÉùÏÑ±
        function createTrendCard(trend) {
            const card = document.createElement('div');
            card.className = 'card trend-card h-100';
            card.onclick = () => openTrendUrl(trend.url);
            
            const cardBody = document.createElement('div');
            cardBody.className = 'card-body';
            
            cardBody.innerHTML = `
                <div class="d-flex justify-content-between align-items-start mb-2">
                    <span class="badge bg-success score-badge">${Math.round(trend.score)}</span>
                    <span class="badge bg-secondary source-badge">${trend.source}</span>
                </div>
                
                <h6 class="trend-title">${escapeHtml(trend.title)}</h6>
                
                ${trend.description ? `<p class="trend-description">${escapeHtml(trend.description.substring(0, 120))}...</p>` : ''}
                
                <div class="trend-tags">
                    ${(trend.tags || []).map(tag => 
                        `<span class="badge bg-light text-dark">#${tag}</span>`
                    ).join('')}
                </div>
                
                <div class="trend-timestamp mt-2">
                    <i class="fas fa-clock"></i> ${formatTimestamp(trend.timestamp)}
                </div>
            `;
            
            card.appendChild(cardBody);
            return card;
        }
        
        // Ïπ¥ÌÖåÍ≥†Î¶¨ ÌïÑÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏
        function updateCategoryFilters(categories) {
            const filterContainer = document.getElementById('categoryFilters');
            
            // Ï†ÑÏ≤¥ Î≤ÑÌäº Ïú†ÏßÄÌïòÍ≥† Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ Î≤ÑÌäº Ï∂îÍ∞Ä
            const existingAll = filterContainer.querySelector('[data-category="all"]');
            filterContainer.innerHTML = '';
            filterContainer.appendChild(existingAll);
            
            categories.forEach(category => {
                const button = document.createElement('button');
                button.type = 'button';
                button.className = 'btn btn-outline-primary';
                button.dataset.category = category;
                button.innerHTML = `${getCategoryIcon(category)} ${category}`;
                button.onclick = () => filterByCategory(category);
                filterContainer.appendChild(button);
            });
        }
        
        // Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ ÌïÑÌÑ∞ÎßÅ
        function filterByCategory(category) {
            // Î≤ÑÌäº ÌôúÏÑ±Ìôî ÏÉÅÌÉú Î≥ÄÍ≤Ω
            document.querySelectorAll('#categoryFilters button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-category="${category}"]`).classList.add('active');
            
            // Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ ÌëúÏãú/Ïà®ÍπÄ
            document.querySelectorAll('.category-section').forEach(section => {
                if (category === 'all' || section.dataset.category === category) {
                    section.style.display = 'block';
                } else {
                    section.style.display = 'none';
                }
            });
        }
        
        // ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
        function updateStats(stats) {
            document.getElementById('totalTrends').textContent = stats.totalTrends || '-';
            document.getElementById('totalSources').textContent = stats.totalSources || '-';
            document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString('ko-KR');
        }
        
        // Ìä∏Î†åÎìú ÏÉàÎ°úÍ≥†Ïπ®
        async function refreshTrends() {
            const button = document.querySelector('.refresh-btn i');
            button.classList.add('fa-spin');
            
            await loadTrends();
            resetAutoRefresh();
            
            setTimeout(() => {
                button.classList.remove('fa-spin');
            }, 1000);
        }
        
        // ÏûêÎèô ÏÉàÎ°úÍ≥†Ïπ® ÏãúÏûë
        function startAutoRefresh() {
            autoRefreshInterval = setInterval(refreshTrends, 60000); // 1Î∂ÑÎßàÎã§
            startCountdown();
        }
        
        // Ïπ¥Ïö¥Ìä∏Îã§Ïö¥ ÏãúÏûë
        function startCountdown() {
            refreshCountdown = 60;
            countdownInterval = setInterval(() => {
                refreshCountdown--;
                document.getElementById('refreshCountdown').textContent = refreshCountdown;
                
                if (refreshCountdown <= 0) {
                    refreshCountdown = 60;
                }
            }, 1000);
        }
        
        // ÏûêÎèô ÏÉàÎ°úÍ≥†Ïπ® Î¶¨ÏÖã
        function resetAutoRefresh() {
            clearInterval(autoRefreshInterval);
            clearInterval(countdownInterval);
            startAutoRefresh();
        }
        
        // Ïú†Ìã∏Î¶¨Ìã∞ Ìï®ÏàòÎì§
        function showLoading() {
            document.getElementById('loadingSpinner').style.display = 'block';
            document.getElementById('trendsContainer').style.display = 'none';
        }
        
        function hideLoading() {
            document.getElementById('loadingSpinner').style.display = 'none';
            document.getElementById('trendsContainer').style.display = 'block';
        }
        
        function showError(message) {
            document.getElementById('trendsContainer').innerHTML = `
                <div class="alert alert-danger text-center">
                    <i class="fas fa-exclamation-triangle"></i> ${message}
                </div>
            `;
        }
        
        function openTrendUrl(url) {
            if (url) {
                window.open(url, '_blank');
            }
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function formatTimestamp(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleString('ko-KR');
        }
        
        function getCategoryIcon(category) {
            const icons = {
                'Í∏∞Ïà†': 'üíª',
                'Í≤ÄÏÉâ': 'üîç', 
                'Îâ¥Ïä§': 'üì∞',
                'ÏÉùÌôú': 'üè†',
                'Ïó∞Ïòà': 'üé≠',
                'Î¨∏Ìôî': 'üé®',
                'ÏùåÏãù': 'üçΩÔ∏è',
                'Ìå®ÏÖò': 'üëó',
                'Í±¥Í∞ï': 'üí™',
                'Í≤ΩÏ†ú': 'üí∞',
                'ÍµêÏú°': 'üìö',
                'Ïó¨Ìñâ': '‚úàÔ∏è',
                'Ïä§Ìè¨Ï∏†': '‚öΩ',
                'ÏáºÌïë': 'üõí',
                'ÏòÅÌôî': 'üé¨',
                'ÏóîÌÑ∞ÌÖåÏù∏Î®ºÌä∏': 'üé™',
                'ÏÜåÏÖú': 'üì±',
                'ÎùºÏù¥ÌîÑ': '‚ú®',
                'Ïª§ÎÆ§ÎãàÌã∞': 'üí¨',
                'Ïù∏Í∏∞': 'üî•',
                'Ï†ïÏπò': 'üèõÔ∏è',
                'ÏÉÅÏãù': 'üß†',
                'ÎÜÄÎùºÏö¥': 'üò≤',
                'ÏßúÏ¶ù': 'üò§',
                'Ïù¥Ïäà': 'üì¢',
                'Ìã±ÌÜ°': 'üéµ',
                'Ï∫êÎ¶≠ÌÑ∞': 'üë§',
                'Ìù•ÎØ∏Î°úÏö¥': 'ü§î',
                'ÌõàÌõàÌïú': 'üòä',
                'Ïú†Î®∏': 'üòÑ',
                'Í∞úÎ∞úÏûêÏú†Î®∏': 'ü§ì',
                'ÎßåÌôî': 'üìù',
                'Î∏îÎ£®Ïä§Ïπ¥Ïù¥': 'üåå',
                'Í≤åÏûÑ': 'üéÆ'
            };
            return icons[category] || 'üìå';
        }
        
        // Ï†ÑÏ≤¥ ÌïÑÌÑ∞ Î≤ÑÌäº Ïù¥Î≤§Ìä∏
        document.querySelector('[data-category="all"]').onclick = () => filterByCategory('all');
    </script>
</body>
</html>