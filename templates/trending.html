<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì£¼ê°„ íŠ¸ë Œë”© ì´ìŠˆ - Blog Automation</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .trend-card {
            transition: transform 0.2s;
            border: 1px solid #e9ecef;
        }
        .trend-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .trend-type-hot { border-left: 4px solid #dc3545; }
        .trend-type-rising { border-left: 4px solid #fd7e14; }
        .trend-type-predicted { border-left: 4px solid #198754; }
        .priority-high { background: linear-gradient(45deg, #ff6b6b, #ffa500); }
        .priority-medium { background: linear-gradient(45deg, #4ecdc4, #45b7d1); }
        .priority-low { background: linear-gradient(45deg, #95e1d3, #a8e6cf); }
        .keyword-tag {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 15px;
            padding: 2px 8px;
            font-size: 0.8em;
            margin: 2px;
            display: inline-block;
        }
        .period-tab {
            border-radius: 20px;
            padding: 8px 20px;
            margin: 0 5px;
            transition: all 0.3s;
        }
        .period-tab.active {
            background: #007bff;
            color: white;
        }
        .site-section {
            margin-bottom: 30px;
        }
        .site-header {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }
        .trend-stats {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/"><i class="fas fa-blog"></i> Blog Automation</a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/"><i class="fas fa-home"></i> ëŒ€ì‹œë³´ë“œ</a>
                <a class="nav-link" href="/keywords"><i class="fas fa-search"></i> í‚¤ì›Œë“œ ì—°êµ¬</a>
                <a class="nav-link" href="/weekly-planner"><i class="fas fa-calendar-week"></i> ì£¼ê°„ ê³„íš</a>
                <a class="nav-link active" href="/trending"><i class="fas fa-chart-line"></i> íŠ¸ë Œë”©</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2><i class="fas fa-chart-line text-primary"></i> ì£¼ê°„ íŠ¸ë Œë”© ì´ìŠˆ</h2>
                    <button class="btn btn-outline-primary" onclick="initializeTrendingData()">
                        <i class="fas fa-sync-alt"></i> ë°ì´í„° ì´ˆê¸°í™”
                    </button>
                </div>
            </div>
        </div>

        <!-- ê¸°ê°„ ì„ íƒ íƒ­ -->
        <div class="row mb-4">
            <div class="col-12 text-center">
                <div class="btn-group" role="group">
                    <button type="button" class="btn period-tab" data-period="last" onclick="selectPeriod('last')">
                        <i class="fas fa-arrow-left"></i> ì „ì£¼
                    </button>
                    <button type="button" class="btn period-tab active" data-period="current" onclick="selectPeriod('current')">
                        <i class="fas fa-clock"></i> ì´ë²ˆì£¼
                    </button>
                    <button type="button" class="btn period-tab" data-period="next" onclick="selectPeriod('next')">
                        <i class="fas fa-arrow-right"></i> ë‹¤ìŒì£¼
                    </button>
                </div>
            </div>
        </div>

        <!-- íŠ¸ë Œë“œ í†µê³„ -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="trend-stats">
                    <div class="row text-center">
                        <div class="col-md-3">
                            <h5 class="text-primary mb-1" id="total-trends">0</h5>
                            <small class="text-muted">ì´ íŠ¸ë Œë“œ</small>
                        </div>
                        <div class="col-md-3">
                            <h5 class="text-danger mb-1" id="hot-trends">0</h5>
                            <small class="text-muted">í•« ì´ìŠˆ</small>
                        </div>
                        <div class="col-md-3">
                            <h5 class="text-warning mb-1" id="rising-trends">0</h5>
                            <small class="text-muted">ìƒìŠ¹ í† í”½</small>
                        </div>
                        <div class="col-md-3">
                            <h5 class="text-success mb-1" id="predicted-trends">0</h5>
                            <small class="text-muted">ì˜ˆìƒ ì´ìŠˆ</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- íŠ¸ë Œë”© ë°ì´í„° í‘œì‹œ ì˜ì—­ -->
        <div id="trending-content">
            <!-- ë™ì ìœ¼ë¡œ ë¡œë“œë¨ -->
        </div>

        <!-- ë¡œë”© ìŠ¤í”¼ë„ˆ -->
        <div class="text-center my-5" id="loading-spinner" style="display: none;">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <div class="mt-2">íŠ¸ë Œë”© ë°ì´í„° ë¡œë”© ì¤‘...</div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let currentPeriod = 'current';

        // í˜ì´ì§€ ë¡œë“œ ì‹œ í˜„ì¬ ì£¼ íŠ¸ë Œë“œ ë¡œë“œ
        document.addEventListener('DOMContentLoaded', function() {
            loadTrendingData('current');
        });

        // ê¸°ê°„ ì„ íƒ
        function selectPeriod(period) {
            currentPeriod = period;
            
            // íƒ­ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.period-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-period="${period}"]`).classList.add('active');
            
            // ë°ì´í„° ë¡œë“œ
            loadTrendingData(period);
        }

        // íŠ¸ë Œë”© ë°ì´í„° ë¡œë“œ
        async function loadTrendingData(period) {
            showLoading();
            
            try {
                const response = await fetch(`/api/trending/${period}`);
                const result = await response.json();
                
                if (result.success) {
                    displayTrendingData(result.data);
                    updateStats(result.data);
                } else {
                    showError('íŠ¸ë Œë”© ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ' + result.error);
                }
            } catch (error) {
                showError('íŠ¸ë Œë”© ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜: ' + error.message);
            } finally {
                hideLoading();
            }
        }

        // íŠ¸ë Œë”© ë°ì´í„° í‘œì‹œ
        function displayTrendingData(data) {
            const content = document.getElementById('trending-content');
            
            if ((!data.site_trends || Object.keys(data.site_trends).length === 0) && 
                (!data.cross_category_issues || data.cross_category_issues.length === 0)) {
                content.innerHTML = `
                    <div class="text-center py-5">
                        <i class="fas fa-search fa-3x text-muted mb-3"></i>
                        <h5>íŠ¸ë Œë”© ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</h5>
                        <p class="text-muted">${data.period || 'í•´ë‹¹ ê¸°ê°„'}ì— ëŒ€í•œ íŠ¸ë Œë”© ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                    </div>
                `;
                return;
            }

            let html = `<h4 class="mb-4">${data.period} íŠ¸ë Œë”© ì´ìŠˆ <small class="text-muted">(${data.week_start}~)</small></h4>`;

            // ê³µí†µ ì‹¤ì‹œê°„ ì´ìŠˆ ì„¹ì…˜ (ìµœìƒë‹¨)
            if (data.cross_category_issues && data.cross_category_issues.length > 0) {
                html += `
                    <div class="site-section mb-5">
                        <div class="site-header" style="background: linear-gradient(45deg, #ff6b6b, #ffa500); color: white;">
                            <h5 class="mb-0">
                                <i class="fas fa-fire"></i> ì‹¤ì‹œê°„ ì£¼ìš” ì´ìŠˆ TOP ${data.cross_category_issues.length}
                                <span class="badge bg-light text-dark ms-2">ğŸ”¥ HOT</span>
                            </h5>
                            <small class="opacity-75">ì „ ë¶„ì•¼ì—ì„œ ê°€ì¥ ì£¼ëª©ë°›ëŠ” 2025ë…„ 8ì›” í•«ì´ìŠˆ</small>
                        </div>
                        <div class="row">
                `;

                data.cross_category_issues.forEach(issue => {
                    const priorityClass = issue.priority >= 9 ? 'priority-high' : 
                                         issue.priority >= 7 ? 'priority-medium' : 'priority-low';
                    
                    html += `
                        <div class="col-md-6 col-lg-4 mb-3">
                            <div class="card trend-card trend-type-${issue.trend_type} h-100">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <span class="badge ${priorityClass} text-white">${issue.category}</span>
                                    <div>
                                        <span class="badge bg-secondary">${issue.trend_type}</span>
                                        <span class="badge bg-info">${issue.priority}/10</span>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <h6 class="card-title">${issue.title}</h6>
                                    <p class="card-text text-muted small">${issue.description || 'ì„¤ëª… ì—†ìŒ'}</p>
                                    <div class="keywords-container">
                                        ${(issue.keywords || []).map(keyword => 
                                            `<span class="keyword-tag">#${keyword}</span>`
                                        ).join('')}
                                    </div>
                                </div>
                                ${issue.source_url ? `
                                    <div class="card-footer">
                                        <a href="${issue.source_url}" target="_blank" class="btn btn-sm btn-outline-primary">
                                            <i class="fas fa-external-link-alt"></i> ì†ŒìŠ¤ ë³´ê¸°
                                        </a>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    `;
                });

                html += `
                        </div>
                    </div>
                `;

                // êµ¬ë¶„ì„  ì¶”ê°€
                if (data.site_trends && Object.keys(data.site_trends).length > 0) {
                    html += `
                        <hr class="my-5" style="border-top: 3px solid #dee2e6;">
                        <div class="text-center mb-4">
                            <h4 class="text-muted">ì‚¬ì´íŠ¸ë³„ ì „ìš© íŠ¸ë Œë“œ</h4>
                            <p class="text-muted small">ê° ì‚¬ì´íŠ¸ì˜ ì „ë¬¸ ë¶„ì•¼ë³„ íŠ¸ë Œë”© ì´ìŠˆ</p>
                        </div>
                    `;
                }
            }

            // ì‚¬ì´íŠ¸ë³„ íŠ¸ë Œë“œ í‘œì‹œ
            if (data.site_trends) {
                const siteNames = {
                    'unpre': 'ê°œë°œ & IT (unpre.co.kr)',
                    'untab': 'ë¶€ë™ì‚° & ì •ì±… (untab.co.kr)',
                    'skewese': 'ì—­ì‚¬ & ë¼ì´í”„ (skewese.com)'
                };

                for (const [site, trends] of Object.entries(data.site_trends)) {
                    if (trends.length === 0) continue;
                    
                    html += `
                        <div class="site-section">
                            <div class="site-header">
                                <h5 class="mb-0">
                                    <i class="fas fa-globe"></i> ${siteNames[site] || site}
                                    <span class="badge bg-light text-dark ms-2">${trends.length}ê°œ</span>
                                </h5>
                            </div>
                            <div class="row">
                    `;
                    
                    trends.forEach(trend => {
                        const priorityClass = trend.priority >= 8 ? 'priority-high' : 
                                            trend.priority >= 6 ? 'priority-medium' : 'priority-low';
                        
                        html += `
                            <div class="col-md-6 col-lg-4 mb-3">
                                <div class="card trend-card trend-type-${trend.trend_type} h-100">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <span class="badge ${priorityClass} text-white">${trend.category}</span>
                                        <div>
                                            <span class="badge bg-secondary">${trend.trend_type}</span>
                                            <span class="badge bg-info">${trend.priority}/10</span>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <h6 class="card-title">${trend.title}</h6>
                                        <p class="card-text text-muted small">${trend.description || 'ì„¤ëª… ì—†ìŒ'}</p>
                                        <div class="keywords-container">
                                            ${(trend.keywords || []).map(keyword => 
                                                `<span class="keyword-tag">#${keyword}</span>`
                                            ).join('')}
                                        </div>
                                    </div>
                                    ${trend.source_url ? `
                                        <div class="card-footer">
                                            <a href="${trend.source_url}" target="_blank" class="btn btn-sm btn-outline-primary">
                                                <i class="fas fa-external-link-alt"></i> ì†ŒìŠ¤ ë³´ê¸°
                                            </a>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        `;
                    });
                    
                    html += `
                            </div>
                        </div>
                    `;
                }
            }
            
            content.innerHTML = html;
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats(data) {
            if (!data.site_trends && !data.cross_category_issues) return;
            
            let totalTrends = 0;
            let hotTrends = 0;
            let risingTrends = 0;
            let predictedTrends = 0;
            
            // ì‚¬ì´íŠ¸ë³„ íŠ¸ë Œë“œ ê³„ì‚°
            if (data.site_trends) {
                for (const trends of Object.values(data.site_trends)) {
                    totalTrends += trends.length;
                    
                    trends.forEach(trend => {
                        switch (trend.trend_type) {
                            case 'hot': hotTrends++; break;
                            case 'rising': risingTrends++; break;
                            case 'predicted': predictedTrends++; break;
                        }
                    });
                }
            }
            
            // ê³µí†µ ì´ìŠˆ ê³„ì‚°
            if (data.cross_category_issues) {
                totalTrends += data.cross_category_issues.length;
                
                data.cross_category_issues.forEach(issue => {
                    switch (issue.trend_type) {
                        case 'hot': hotTrends++; break;
                        case 'rising': risingTrends++; break;
                        case 'predicted': predictedTrends++; break;
                    }
                });
            }
            
            document.getElementById('total-trends').textContent = totalTrends;
            document.getElementById('hot-trends').textContent = hotTrends;
            document.getElementById('rising-trends').textContent = risingTrends;
            document.getElementById('predicted-trends').textContent = predictedTrends;
        }

        // íŠ¸ë Œë”© ë°ì´í„° ì´ˆê¸°í™”
        async function initializeTrendingData() {
            if (!confirm('íŠ¸ë Œë”© ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            showLoading();
            
            try {
                const response = await fetch('/api/trending/initialize', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showSuccess('íŠ¸ë Œë”© ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    loadTrendingData(currentPeriod);
                } else {
                    showError('ì´ˆê¸°í™” ì‹¤íŒ¨: ' + result.error);
                }
            } catch (error) {
                showError('ì´ˆê¸°í™” ì˜¤ë¥˜: ' + error.message);
            } finally {
                hideLoading();
            }
        }

        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
        function showLoading() {
            document.getElementById('loading-spinner').style.display = 'block';
            document.getElementById('trending-content').style.opacity = '0.5';
        }

        function hideLoading() {
            document.getElementById('loading-spinner').style.display = 'none';
            document.getElementById('trending-content').style.opacity = '1';
        }

        function showError(message) {
            alert('ì˜¤ë¥˜: ' + message);
        }

        function showSuccess(message) {
            alert('ì„±ê³µ: ' + message);
        }
    </script>
</body>
</html>